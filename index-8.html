<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Adumbrations of data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Visions, Voices, Data (old posts, page 8) | Visions, Voices, Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/index-8.html" rel="canonical">
<link href="." rel="prev" type="text/html">
<link href="index-7.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script><!--
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"
</script>
-->
<script async src="javascript/p5.min.js" type="text/javascript"></script>
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a> <a class="dropdown-item" href="/pages/giss/giss-yearly-anomalies-by-climate-zone">GISS Anomalies</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"> <input name="k8" type="hidden" value="#444444"> <input name="k9" type="hidden" value="#D51920"> <input name="kt" type="hidden" value="h"> <input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" type="text"> <input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/cpr-and-blood-thinners/">CPR and Blood Thinners</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/cpr-and-blood-thinners/" rel="bookmark"><time class="published dt-published" datetime="2020-10-01T18:16:06-07:00" itemprop="datePublished" title="2020-10-01 18:16">2020-10-01 18:16</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/cpr-and-blood-thinners/#org5d36b62">Beginning</a>
<ul>
<li><a href="/posts/cpr-and-blood-thinners/#org5c9f3b8">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/cpr-and-blood-thinners/#org160cc6b">Middle</a>
<ul>
<li><a href="/posts/cpr-and-blood-thinners/#org1be1100">The Study Data</a></li>
<li><a href="/posts/cpr-and-blood-thinners/#orgb59b05c">Simulation</a></li>
</ul>
</li>
<li><a href="/posts/cpr-and-blood-thinners/#org76acec1">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org5d36b62">
<h2 id="org5d36b62">Beginning</h2>
<div class="outline-text-2" id="text-org5d36b62">
<p>We want to test the hypothesis that blood thinners administered to patients that have been give CPR has <i>some</i> kind of effect (for good or for ill) on survival rates.</p>
<ul class="org-ul">
<li>\(H_0\): Bood thinners don't have an effect on survival rate - the proportions will be the same for each group (\(p_{treatment} = p_{control}\)).</li>
<li>\(H_A\): Blood thinners impact survival, either positive or negative (\(p_{treatment} - p_{control} \neq 0\)).</li>
</ul>
<p>We're going to use a significance level of 0.05.</p>
<div class="highlight">
<pre><span></span><span class="n">ALPHA</span> <span class="o">=</span> <span class="mf">0.05</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org5c9f3b8">
<h3 id="org5c9f3b8">Set Up</h3>
<div class="outline-text-3" id="text-org5c9f3b8"></div>
<div class="outline-4" id="outline-container-org8792c2d">
<h4 id="org8792c2d">Imports</h4>
<div class="outline-text-4" id="text-org8792c2d">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org89cc7f4">
<h4 id="org89cc7f4">Random Generator</h4>
<div class="outline-text-4" id="text-org89cc7f4">
<div class="highlight">
<pre><span></span><span class="n">numpy_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org052a8c6">
<h4 id="org052a8c6">The Timer</h4>
<div class="outline-text-4" id="text-org052a8c6">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgdbe6dee">
<h4 id="orgdbe6dee">Plotting</h4>
<div class="outline-text-4" id="text-orgdbe6dee">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"cpr-and-blood-thinners"</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
    <span class="n">color_cycle</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Cycle</span><span class="p">([</span><span class="s2">"#4687b7"</span><span class="p">,</span> <span class="s2">"#ce7b6d"</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org4231308">
<h4 id="org4231308">The Table Printer</h4>
<div class="outline-text-4" id="text-org4231308">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org160cc6b">
<h2 id="org160cc6b">Middle</h2>
<div class="outline-text-2" id="text-org160cc6b"></div>
<div class="outline-3" id="outline-container-org1be1100">
<h3 id="org1be1100">The Study Data</h3>
<div class="outline-text-3" id="text-org1be1100">
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="nb">dict</span><span class="p">(</span>
        <span class="n">Survived</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
        <span class="n">Died</span> <span class="o">=</span> <span class="p">[</span><span class="mi">39</span><span class="p">,</span> <span class="mi">26</span><span class="p">]))</span>
<span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Control"</span><span class="p">,</span> <span class="s2">"Treatment"</span><span class="p">]</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">row</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Total"</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">Survived</th>
<th class="org-right" scope="col">Died</th>
<th class="org-right" scope="col">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Control</td>
<td class="org-right">11</td>
<td class="org-right">39</td>
<td class="org-right">50</td>
</tr>
<tr>
<td class="org-left">Treatment</td>
<td class="org-right">14</td>
<td class="org-right">26</td>
<td class="org-right">40</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Total</td>
<td class="org-right">25</td>
<td class="org-right">65</td>
<td class="org-right">90</td>
</tr>
</tbody>
</table>
<p>The fifty people in the Control Group didn't receive blood thinners and the forty in the Treatment Group did.</p>
<p>Now I'll plot it to see what the differences look like.</p>
<div class="highlight">
<pre><span></span><span class="c1"># put the groups into a column</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># get rid of the totals</span>
<span class="k">del</span><span class="p">(</span><span class="n">plotter</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">])</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"index"</span><span class="p">],</span>
                       <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Survived"</span><span class="p">,</span> <span class="s2">"Died"</span><span class="p">])</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">"Group"</span><span class="p">,</span>
    <span class="n">variable</span><span class="o">=</span><span class="s2">"Outcome"</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">))</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Group"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">"Outcome"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Survived or Died"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"survived_or_died"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/cpr-and-blood-thinners/survived_or_died.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Hard to say, but it looks like more of the Treatment Group survived.</p>
</div>
<div class="outline-4" id="outline-container-org02d1c49">
<h4 id="org02d1c49">The Porportions</h4>
<div class="outline-text-4" id="text-org02d1c49">
<p>We are interested in the difference in survival rates so we need to calculate the proprtion that survived in each group and take the difference.</p>
<div class="highlight">
<pre><span></span><span class="n">survival_rates</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"Survived"</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">Total</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Group"</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s2">"Survival Rate"</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">survival_rates</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Group</th>
<th class="org-right" scope="col">Survival Rate</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Control</td>
<td class="org-right">0.22</td>
</tr>
<tr>
<td class="org-left">Treatment</td>
<td class="org-right">0.35</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Total</td>
<td class="org-right">0.277778</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">survival_rates</span> <span class="o">=</span> <span class="n">survival_rates</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"Group"</span><span class="p">)</span>
<span class="n">TEST_STATISTIC</span> <span class="o">=</span> <span class="n">survival_rates</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Treatment"</span><span class="p">]</span> <span class="o">-</span> <span class="n">survival_rates</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Control"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Difference: </span><span class="si">{</span><span class="n">TEST_STATISTIC</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Difference: Survival Rate    0.13
dtype: float64
</pre>
<p>It appears that 13% more people survive when they are given blood thinners than when they aren't.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb59b05c">
<h3 id="orgb59b05c">Simulation</h3>
<div class="outline-text-3" id="text-orgb59b05c">
<p>Now I'll run a simulation to build up the <b>null distribution</b> of the differences.</p>
</div>
<div class="outline-4" id="outline-container-org0885298">
<h4 id="org0885298">Set Up The Urn</h4>
<div class="outline-text-4" id="text-org0885298">
<p>The urn will be based on the total row on the contingency table. The that number survived will be represented as ones and the number that died will be represented as zeros.</p>
<div class="highlight">
<pre><span></span><span class="n">total</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">]</span>
<span class="n">survived</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">total</span><span class="o">.</span><span class="n">Survived</span><span class="p">)</span>
<span class="n">died</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">total</span><span class="o">.</span><span class="n">Died</span><span class="p">)</span>
<span class="n">urn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">survived</span><span class="p">,</span> <span class="n">died</span><span class="p">)</span>
</pre></div>
<p>Now we'll run the simulation to get the distribution.</p>
<div class="highlight">
<pre><span></span><span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
<span class="n">CONTROL_GROUP</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Control"</span><span class="p">]</span>
<span class="n">TREATMENT_GROUP</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Treatment"</span><span class="p">]</span>
<span class="n">survived</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"Survived"</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">controls</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy_random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">urn</span><span class="p">,</span>
                                                <span class="n">CONTROL_GROUP</span><span class="p">,</span>
                                                <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">)])</span>
    <span class="n">treatments</span> <span class="o">=</span> <span class="n">survived</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">]</span> <span class="o">-</span> <span class="n">controls</span>

    <span class="n">control_proportions</span> <span class="o">=</span> <span class="n">controls</span><span class="o">/</span><span class="n">CONTROL_GROUP</span>
    <span class="n">treatment_proportions</span> <span class="o">=</span> <span class="n">treatments</span><span class="o">/</span><span class="n">TREATMENT_GROUP</span>

    <span class="n">differences</span> <span class="o">=</span> <span class="n">treatment_proportions</span> <span class="o">-</span> <span class="n">control_proportions</span>
    <span class="n">differences</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">"Point Estimate"</span><span class="p">:</span> <span class="n">differences</span><span class="p">})</span>
</pre></div>
<pre class="example">
2020-10-01 19:38:55,370 graeae.timers.timer start: Started: 2020-10-01 19:38:55.370038
2020-10-01 19:39:31,437 graeae.timers.timer end: Ended: 2020-10-01 19:39:31.437364
2020-10-01 19:39:31,438 graeae.timers.timer end: Elapsed: 0:00:36.067326
</pre>
<p>Plot the distribution.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">differences</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s2">"Point Estimate"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Null Distribution of Point Estimate"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"null_distribution"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/cpr-and-blood-thinners/null_distribution.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Now we want to try a two-sided hypothesis test.</p>
<div class="highlight">
<pre><span></span><span class="n">right_side</span> <span class="o">=</span> <span class="p">(</span><span class="n">differences</span> <span class="o">&gt;=</span> <span class="n">TEST_STATISTIC</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">right_side</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"One-Sided p-value: </span><span class="si">{</span><span class="p">(</span><span class="n">right_side</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">differences</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Two-sided p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
One-Sided p-value: 0.129026
Two-sided p-value: 0.258052
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"We reject the Null Hypothesis: </span><span class="si">{</span><span class="n">p_value</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ALPHA</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
We reject the Null Hypothesis: False
</pre>
<p>Even a single-sided test wouldn't have provided enough evidence to reject the null hypothesis, but with the two-sided version it looks really like the difference was from chance.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org76acec1">
<h2 id="org76acec1">End</h2>
<div class="outline-text-2" id="text-org76acec1">
<p>Although it initially looked like the use of blood thinners after someone has been given CPR helped survival rates our data does not contain evidence to say that it does.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/opportunity-cost-neglect/">Opportunity Cost Neglect</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/opportunity-cost-neglect/" rel="bookmark"><time class="published dt-published" datetime="2020-09-26T18:34:45-07:00" itemprop="datePublished" title="2020-09-26 18:34">2020-09-26 18:34</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-orgba5fc17">
<h2 id="orgba5fc17">Citation</h2>
<div class="outline-text-2" id="text-orgba5fc17">
<ul class="org-ul">
<li>Frederick S, Novemsky N, Wang J, Dhar R, Nowlis S. Opportunity cost neglect. Journal of Consumer Research. 2009 Dec 1;36(4):553-61.</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orga34a1fb">
<h2 id="orga34a1fb">Abstract</h2>
<div class="outline-text-2" id="text-orga34a1fb"></div>
<div class="outline-3" id="outline-container-orge55c02e">
<h3 id="orge55c02e">And</h3>
<div class="outline-text-3" id="text-orge55c02e">
<p>To properly consider the opportunity costs of a purchase, consumers must actively generate the alternatives that it would displace.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org20ee340">
<h3 id="org20ee340">But</h3>
<div class="outline-text-3" id="text-org20ee340">
<p>The current research suggests that consumers often fail to do so. Even under conditions promoting cognitive effort, various cues to consider opportunity costs reduce purchase rates and increase the choice share of more affordable options. Sensitivity to such cues varies with chronic dispositional differences in spending attitudes.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org155dd3c">
<h3 id="org155dd3c">Therefore</h3>
<div class="outline-text-3" id="text-org155dd3c">
<p>We discuss the implications of these results for the marketing strategies of economy and premium brands.</p>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/opportunity-cost/">Opportunity Cost</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/opportunity-cost/" rel="bookmark"><time class="published dt-published" datetime="2020-09-26T16:07:12-07:00" itemprop="datePublished" title="2020-09-26 16:07">2020-09-26 16:07</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/opportunity-cost/#orgdd1a55f">Beginning</a>
<ul>
<li><a href="/posts/opportunity-cost/#orgd863d86">Imports</a></li>
<li><a href="/posts/opportunity-cost/#orgbeb5e77">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/opportunity-cost/#org9c6b605">Middle</a>
<ul>
<li><a href="/posts/opportunity-cost/#orgd8bc8b3">Hypotheses</a></li>
<li><a href="/posts/opportunity-cost/#orgf7eae33">The Study Data</a></li>
<li><a href="/posts/opportunity-cost/#orgf48eb9d">Point Estimate of Effect</a></li>
<li><a href="/posts/opportunity-cost/#orgc7216b7">Simulating Random Chance</a></li>
</ul>
</li>
<li><a href="/posts/opportunity-cost/#org7e0cdbc">End</a>
<ul>
<li><a href="/posts/opportunity-cost/#org7f2cfe8">In the Abstract</a></li>
<li><a href="/posts/opportunity-cost/#orgbd225a8">Source</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgdd1a55f">
<h2 id="orgdd1a55f">Beginning</h2>
<div class="outline-text-2" id="text-orgdd1a55f">
<p>We want to answer the question of whether reminding college students that spending money now deprives them of money in the future will affect their spending behavior.</p>
</div>
<div class="outline-3" id="outline-container-orgd863d86">
<h3 id="orgd863d86">Imports</h3>
<div class="outline-text-3" id="text-orgd863d86">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">equal</span><span class="p">,</span>
    <span class="n">expect</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgbeb5e77">
<h3 id="orgbeb5e77">Set Up</h3>
<div class="outline-text-3" id="text-orgbeb5e77"></div>
<div class="outline-4" id="outline-container-org62f4297">
<h4 id="org62f4297">Randomness</h4>
<div class="outline-text-4" id="text-org62f4297">
<div class="highlight">
<pre><span></span><span class="n">numpy_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3704687">
<h4 id="org3704687">Table</h4>
<div class="outline-text-4" id="text-org3704687">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9986c4e">
<h4 id="org9986c4e">Timer and Plotting</h4>
<div class="outline-text-4" id="text-org9986c4e">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"opportunity-cost"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
    <span class="n">color_cycle</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Cycle</span><span class="p">([</span><span class="s2">"#4687b7"</span><span class="p">,</span> <span class="s2">"#ce7b6d"</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org9c6b605">
<h2 id="org9c6b605">Middle</h2>
<div class="outline-text-2" id="text-org9c6b605"></div>
<div class="outline-3" id="outline-container-orgd8bc8b3">
<h3 id="orgd8bc8b3">Hypotheses</h3>
<div class="outline-text-3" id="text-orgd8bc8b3">
<ul class="org-ul">
<li>\(H_0:\) <b>Null Hypothesis.</b> Reminding students that they can save money for future purchases won't impact their spending decisions.</li>
<li>\(H_A:\) <b>Alternative Hypothesis.</b> Reminding students that they can save money for future purchases will reduce their spending.</li>
</ul>
<p>I'll us a 95% significance level.</p>
<div class="highlight">
<pre><span></span><span class="n">ALPHA</span> <span class="o">=</span> <span class="s2">"0.05"</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf7eae33">
<h3 id="orgf7eae33">The Study Data</h3>
<div class="outline-text-3" id="text-orgf7eae33">
<p>150 Students were given the following statement:</p>
<blockquote>
<p>Imagine that you have been saving some extra money on the side to make some purchases and on your most recent visit to the video store you come across a special sale on a new video. This video is one with your favorite actor or actress, and your favorite type of movie (such as comedy, drama, thriller, etc.). This particular video that you are considering is one you have been thinking about buying for a long time. It is available for a special sale price of $14.99.</p>
<p>What would you do in this situation? Please circle one of the options below.</p>
</blockquote>
<p>Video store? Are we going to have to invent a time machine to run this study? No, we'll just swipe the data published by Frederick et al. in 2009. They conducted their study at Arizona State University, which perhaps still had some DVD stores around back then. The study was building on prior work that showed that people focus exclusively on explicitly presented details and ignore the facts that the explicit statements imply but don't state. (Also, I just looked it up and there's quite a few video stores around me (here in Portland) I guess I just haven't been to one in a while).</p>
<p>The options that the subjects were given to circle depended on which group they belonged to. The control group (75 students) were given these options:</p>
<blockquote>
<p>A. Buy this entertaining video.<br>
B. Not buy this entertaining video.</p>
</blockquote>
<p>The treatment group (also 75 students) were given these options:</p>
<blockquote>
<p>A. Buy this entertaining video.<br>
B. Not buy this entertaining video. Keep the $14.99 for other purchases.</p>
</blockquote>
<p>Here's the outcome of the study.</p>
<div class="highlight">
<pre><span></span><span class="n">Outcome</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">buy</span><span class="o">=</span><span class="s2">"Buy DVD"</span><span class="p">,</span>
    <span class="n">dont_buy</span><span class="o">=</span><span class="s2">"Not Buy DVD"</span><span class="p">,</span>
    <span class="n">control</span><span class="o">=</span><span class="s2">"Control Group"</span><span class="p">,</span>
    <span class="n">treatment</span><span class="o">=</span><span class="s2">"Treatment Group"</span><span class="p">,</span>
    <span class="n">total</span><span class="o">=</span><span class="s2">"Total"</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="n">Outcome</span><span class="o">.</span><span class="n">buy</span><span class="p">:[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">41</span><span class="p">],</span>
                                   <span class="n">Outcome</span><span class="o">.</span><span class="n">dont_buy</span><span class="p">:</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span> <span class="mi">34</span><span class="p">]})</span>
<span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">control</span><span class="p">,</span> <span class="n">Outcome</span><span class="o">.</span><span class="n">treatment</span><span class="p">]</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">row</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">Outcome</span><span class="o">.</span><span class="n">total</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">Buy DVD</th>
<th class="org-right" scope="col">Not Buy DVD</th>
<th class="org-right" scope="col">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Control Group</td>
<td class="org-right">56</td>
<td class="org-right">19</td>
<td class="org-right">75</td>
</tr>
<tr>
<td class="org-left">Treatment Group</td>
<td class="org-right">41</td>
<td class="org-right">34</td>
<td class="org-right">75</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Total</td>
<td class="org-right">97</td>
<td class="org-right">53</td>
<td class="org-right">150</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">Total</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">buy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">][</span><span class="n">Outcome</span><span class="o">.</span><span class="n">buy</span><span class="p">],</span>
    <span class="n">dont_buy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">][</span><span class="n">Outcome</span><span class="o">.</span><span class="n">dont_buy</span><span class="p">],</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">control</span><span class="p">][</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">],</span>
    <span class="n">students</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">][</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
<p>Now a little plotting.</p>
<div class="highlight">
<pre><span></span><span class="c1"># put the groups into a column</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># get rid of the totals</span>
<span class="k">del</span><span class="p">(</span><span class="n">plotter</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">])</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># move the outcome headers into a column</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"index"</span><span class="p">],</span>
                       <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">buy</span><span class="p">,</span> <span class="n">Outcome</span><span class="o">.</span><span class="n">dont_buy</span><span class="p">])</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">"Group"</span><span class="p">,</span>
    <span class="n">variable</span><span class="o">=</span><span class="s2">"Outcome"</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">))</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Group"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">"Outcome"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Buy Or Don't Buy DVD"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"buy_dont_buy"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/opportunity-cost/buy_dont_buy.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It <i>looks</i> like there was a significant difference since not only did the majority of the treatment group opt not to buy the DVD, but in the control a significant majority did.</p>
<p>Now as row-proportions.</p>
<div class="highlight">
<pre><span></span><span class="n">proportions</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"rows"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">proportions</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">Buy DVD</th>
<th class="org-right" scope="col">Not Buy DVD</th>
<th class="org-right" scope="col">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Control Group</td>
<td class="org-right">0.746667</td>
<td class="org-right">0.253333</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Treatment Group</td>
<td class="org-right">0.546667</td>
<td class="org-right">0.453333</td>
<td class="org-right">1</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Total</td>
<td class="org-right">0.646667</td>
<td class="org-right">0.353333</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>Looking at the proportions it looks like quite a bit more didn't buy the DVD, but let's run the experiment and see.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgf48eb9d">
<h3 id="orgf48eb9d">Point Estimate of Effect</h3>
<div class="outline-text-3" id="text-orgf48eb9d">
<p>The thing we are interested in is whether the wording of the second option to not buy the DVD made a difference, so our statistic of interest is the difference in proportions of the control and treatment group participants who didn't buy the DVD.</p>
\begin{align} \hat{p}_{control} &amp;= \frac{\textrm{Control Group that wouldn't buy}}{\textrm{size of Control Group}}\\ \hat{p}_{treatment} &amp;= \frac{\textrm{Treatment Group that wouldn't buy}}{\textrm{size of Treament Group}}\\ \hat{p} &amp;= \hat{p}_{treatment} - \hat{p}_{control} \end{align}
<div class="highlight">
<pre><span></span><span class="n">POINT_ESTIMATE</span> <span class="o">=</span> <span class="p">(</span><span class="n">proportions</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">dont_buy</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">treatment</span><span class="p">]</span>
                  <span class="o">-</span> <span class="n">proportions</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">dont_buy</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">control</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">POINT_ESTIMATE</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %"</span><span class="p">)</span>
</pre></div>
<pre class="example">
20.00 %
</pre>
<p>About twenty percent more of the treatment group said they would abstain from the purchase than control group.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgc7216b7">
<h3 id="orgc7216b7">Simulating Random Chance</h3>
<div class="outline-text-3" id="text-orgc7216b7">
<p>In a previous post looking at <a href="/posts/gender-discrimination/">Gender Discrimination Inference</a> I split the Urn into a 50-50 split of males and females to see if there was gender bias in choosing whether to promote them. In this case it's going to work a little differently.</p>
<p>We are asking here whether our treatment had an effect. If it didn't then we would expect that the distribution of "buy" and "don't buy" that we saw represents the distribution of the underlying population of ASU students, so we need to split our urn up to match the counts in the "Buy" and "Don't Buy" columns and then randomly split it into two equal groups. If the difference we saw was the result of random chance then we would expect that the difference between "buy" and "don't buy" group would be equal most of the time. This doesn't seem as intuitive a way to set it up as the previous method, but we'll see how it goes.</p>
</div>
<div class="outline-4" id="outline-container-orgfd89351">
<h4 id="orgfd89351">Set Up the Urn</h4>
<div class="outline-text-4" id="text-orgfd89351">
<div class="highlight">
<pre><span></span><span class="n">buy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">][</span><span class="n">Outcome</span><span class="o">.</span><span class="n">buy</span><span class="p">]</span>
<span class="n">dont</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Outcome</span><span class="o">.</span><span class="n">total</span><span class="p">][</span><span class="n">Outcome</span><span class="o">.</span><span class="n">dont_buy</span><span class="p">]</span>

<span class="n">bought</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">buy</span><span class="p">)</span>
<span class="n">didnt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dont</span><span class="p">)</span>

<span class="n">URN</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bought</span><span class="p">,</span> <span class="n">didnt</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">URN</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">STUDENTS</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">buy</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">97</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">dont</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">53</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">URN</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">dont</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1b4294f">
<h4 id="org1b4294f">Simulate</h4>
<div class="outline-text-4" id="text-org1b4294f">
<p>The Process:</p>
<ol class="org-ol">
<li>Shuffle the urn</li>
<li>Split the shuffled urn in half (control and treatment)</li>
<li>Count the proportion of each half that said they would not buy the DVD</li>
<li>Record the differences between the proportions of the control that wouldn't buy and the treatment that wouldn't buy</li>
</ol>
<p>But, since I'm doing this with numpy it works a little different.</p>
<p>My process:</p>
<ol class="org-ol">
<li>Randomly choose half the urn (without replacement) to get the control group</li>
<li>Sum the choices (this gives the count of the control that said they wouldn't buy)</li>
<li>Subtract the previous sum from the total that said they wouldn't buy (to get the treatment count)</li>
<li>Calculate the proportion of each group that said they wouldn't buy</li>
<li>Find the difference in proportion for each group</li>
</ol>
<div class="highlight">
<pre><span></span><span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">controls</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy_random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">URN</span><span class="p">,</span>
                                                <span class="n">Total</span><span class="o">.</span><span class="n">group</span><span class="p">,</span>
                                                <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">)])</span>
    <span class="n">treatments</span> <span class="o">=</span> <span class="n">Total</span><span class="o">.</span><span class="n">dont_buy</span> <span class="o">-</span> <span class="n">controls</span>

    <span class="n">control_proportions</span> <span class="o">=</span> <span class="n">controls</span><span class="o">/</span><span class="n">Total</span><span class="o">.</span><span class="n">group</span>
    <span class="n">treatment_proportions</span> <span class="o">=</span> <span class="n">treatments</span><span class="o">/</span><span class="n">Total</span><span class="o">.</span><span class="n">group</span>

    <span class="n">differences</span> <span class="o">=</span> <span class="n">control_proportions</span> <span class="o">-</span> <span class="n">treatment_proportions</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span>
        <span class="s2">"Point Estimate"</span><span class="p">:</span> <span class="n">differences</span><span class="p">,</span>
        <span class="s2">"Control"</span><span class="p">:</span> <span class="n">control_proportions</span><span class="p">,</span>
        <span class="s2">"Treatment"</span><span class="p">:</span> <span class="n">treatment_proportions</span><span class="p">,</span>
    <span class="p">})</span>
</pre></div>
<pre class="example">
2020-09-26 20:02:52,224 graeae.timers.timer start: Started: 2020-09-26 20:02:52.224515
2020-09-26 20:03:29,174 graeae.timers.timer end: Ended: 2020-09-26 20:03:29.174373
2020-09-26 20:03:29,175 graeae.timers.timer end: Elapsed: 0:00:36.949858
</pre></div>
</div>
<div class="outline-4" id="outline-container-org6351179">
<h4 id="org6351179">Plot the Distribution</h4>
<div class="outline-text-4" id="text-org6351179">
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s2">"Point Estimate"</span><span class="p">,</span>
                              <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Opportunity Cost Don't Buy Difference"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"opportunity_cost_simulation"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/opportunity-cost/opportunity_cost_simulation.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>The distribution appears to be reasonably normal, if a bit peaked in the middle.</p>
<div class="highlight">
<pre><span></span><span class="n">matched</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulation</span><span class="p">[</span><span class="n">simulation</span><span class="p">[</span><span class="s2">"Point Estimate"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">POINT_ESTIMATE</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Percent of trials &gt;= Point Estimate of Study: </span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">matched</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> %"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Percent of trials &gt;= Point Estimate of Study: 0.817 %
</pre>
<p>According to our simulation, less than one percent of the time we would see a difference like the study found by random chance alone.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org2cd9c60">
<h4 id="org2cd9c60">Test Our Hypothesis</h4>
<div class="outline-text-4" id="text-org2cd9c60">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Null Hypothesis is </span><span class="si">{</span><span class="n">matched</span> <span class="o">&gt;=</span> <span class="n">POINT_ESTIMATE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Null Hypothesis is False
</pre>
<p>So we'll conclude that the Null Hypothesis is false and that the Alternative Hypothesis that telling students about the opportunity cost of buying a DVD does have an effecte in getting them to not buy the DVD.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org7e0cdbc">
<h2 id="org7e0cdbc">End</h2>
<div class="outline-text-2" id="text-org7e0cdbc">
<p>So here we have a walk through of Inference using simulation and an experiment with Control and Treatment groups. Although the conclusion reached is that reminding students of the money they would have in the future if they didn't spend it is "causal", since this was an experiment, I'm not 100% convinced that asking studnents what the</p>
</div>
<div class="outline-3" id="outline-container-org7f2cfe8">
<h3 id="org7f2cfe8">In the Abstract</h3>
<div class="outline-text-3" id="text-org7f2cfe8">
<ol class="org-ol">
<li>Create an urn where the ones and zeros are equal to the totals for each of the outcome columns</li>
<li>Sample from the urn a simulated control group and treatment group (matching the sizes of the original groups)</li>
<li>Find the difference between the proportion of the control group and the treatment group that match the "success" outcome</li>
<li>Calculate the fraction of the differences that are equal to or greater than the differences in the study</li>
<li>Check if the fraction in the simulation meets your confidence level</li>
</ol>
</div>
</div>
<div class="outline-3" id="outline-container-orgbd225a8">
<h3 id="orgbd225a8">Source</h3>
<div class="outline-text-3" id="text-orgbd225a8">
<ul class="org-ul">
<li><a href="/posts/introductory-statistics-with-randomization-and-simulation/">Introductory Statistics with Randomization and Simulation</a></li>
<li><a href="/posts/opportunity-cost-neglect/">Opportunity Cost Neglect</a></li>
</ul>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/gender-discrimination/">Gender Discrimination Inference</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/gender-discrimination/" rel="bookmark"><time class="published dt-published" datetime="2020-09-22T17:04:38-07:00" itemprop="datePublished" title="2020-09-22 17:04">2020-09-22 17:04</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/gender-discrimination/#org860f808">Beginning</a>
<ul>
<li><a href="/posts/gender-discrimination/#orgba750b2">Imports</a></li>
<li><a href="/posts/gender-discrimination/#org160c467">Randomness</a></li>
<li><a href="/posts/gender-discrimination/#orgebb1b48">Plotting, Tables, and a Timer</a></li>
</ul>
</li>
<li><a href="/posts/gender-discrimination/#org6453e31">Middle</a>
<ul>
<li><a href="/posts/gender-discrimination/#orgb04949f">The Original Study</a></li>
<li><a href="/posts/gender-discrimination/#org0e5744f">The Experiment</a></li>
<li><a href="/posts/gender-discrimination/#org9ff33a9">Looking at the Distribution</a></li>
<li><a href="/posts/gender-discrimination/#org59be2da">A Hypothesis Test</a></li>
</ul>
</li>
<li><a href="/posts/gender-discrimination/#org2bb3d95">End</a>
<ul>
<li><a href="/posts/gender-discrimination/#org96959c6">In Abstract</a></li>
<li><a href="/posts/gender-discrimination/#org91ec2ad">Source</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org860f808">
<h2 id="org860f808">Beginning</h2>
<div class="outline-text-2" id="text-org860f808"></div>
<div class="outline-3" id="outline-container-orgba750b2">
<h3 id="orgba750b2">Imports</h3>
<div class="outline-text-3" id="text-orgba750b2">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">equal</span><span class="p">,</span>
    <span class="n">expect</span><span class="p">,</span>    
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org160c467">
<h3 id="org160c467">Randomness</h3>
<div class="outline-text-3" id="text-org160c467">
<div class="highlight">
<pre><span></span><span class="n">numpy_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgebb1b48">
<h3 id="orgebb1b48">Plotting, Tables, and a Timer</h3>
<div class="outline-text-3" id="text-orgebb1b48"></div>
<div class="outline-4" id="outline-container-org7365e11">
<h4 id="org7365e11">Plotting</h4>
<div class="outline-text-4" id="text-org7365e11">
<div class="highlight">
<pre><span></span><span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="o">=</span><span class="s2">"files/posts/gender-discrimination/"</span><span class="p">)</span>
<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
    <span class="n">color_cycle</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Cycle</span><span class="p">([</span><span class="s2">"#4687b7"</span><span class="p">,</span> <span class="s2">"#ce7b6d"</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgaa9fda6">
<h4 id="orgaa9fda6">The Table</h4>
<div class="outline-text-4" id="text-orgaa9fda6">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc205969">
<h4 id="orgc205969">The Timer</h4>
<div class="outline-text-4" id="text-orgc205969">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org6453e31">
<h2 id="org6453e31">Middle</h2>
<div class="outline-text-2" id="text-org6453e31"></div>
<div class="outline-3" id="outline-container-orgb04949f">
<h3 id="orgb04949f">The Original Study</h3>
<div class="outline-text-3" id="text-orgb04949f">
<p>This starts with a study where bank managers were each given a personnel file and asked to decide if they would promote the person represented by the file to branch manager. The files were identical but half of them were filled out as male and half as female. The researchers wanted to know if these manager were biased in favor of men. There was actually two types of jobs, one described by the authors as "simple" and one as "complex". This only looks at the "simple" job. The table below shows their results.</p>
<div class="highlight">
<pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Promoted"</span><span class="p">:</span> <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
                          <span class="s2">"Not Promoted"</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]},</span>
                         <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"Male"</span><span class="p">,</span> <span class="s2">"Female"</span><span class="p">])</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">row</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Total"</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">column</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="n">study</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">study</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">Promoted</th>
<th class="org-right" scope="col">Not Promoted</th>
<th class="org-right" scope="col">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Male</td>
<td class="org-right">21</td>
<td class="org-right">3</td>
<td class="org-right">24</td>
</tr>
<tr>
<td class="org-left">Female</td>
<td class="org-right">14</td>
<td class="org-right">10</td>
<td class="org-right">24</td>
</tr>
<tr>
<td class="org-left">Total</td>
<td class="org-right">35</td>
<td class="org-right">13</td>
<td class="org-right">48</td>
</tr>
</tbody>
</table>
<p>Let's look at the values (without the totals) as a plot.</p>
<div class="highlight">
<pre><span></span><span class="n">plotter</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="k">del</span><span class="p">(</span><span class="n">plotter</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">])</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"index"</span><span class="p">],</span>
                       <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Promoted"</span><span class="p">,</span> <span class="s2">"Not Promoted"</span><span class="p">])</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">"Gender"</span><span class="p">,</span>
                                      <span class="n">value</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
                                      <span class="n">variable</span><span class="o">=</span><span class="s2">"Decision"</span><span class="p">))</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Gender"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">"Decision"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Outcome by Gender"</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"promotions_by_gender"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/gender-discrimination/promotions_by_gender.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It looks like a considerable majority of the males were promoted whereas for the females only a slight majority were promoted.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Decision"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">"Gender"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Male Vs Female by Decision"</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"decision_by_gender"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/gender-discrimination/decision_by_gender.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>This plot doesn't make the disparity look quite as extreme as the previous plot did, I think.</p>
</div>
<div class="outline-4" id="outline-container-orgdef889b">
<h4 id="orgdef889b">About the Variables</h4>
<div class="outline-text-4" id="text-orgdef889b">
<p>I started using them without explicity stating it but we have two variable here - <code>Promoted</code> and <code>Not Promoted</code> are part of the <code>decision</code> variable and <code>Male</code> and <code>Female</code> are part of the <code>gender</code> variable.</p>
<p>Anywayâ€¦ so more males were chosen for promotion than female, but by what proportion?</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">study</span><span class="o">/</span><span class="n">study</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">Promoted</th>
<th class="org-right" scope="col">Not Promoted</th>
<th class="org-right" scope="col">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Male</td>
<td class="org-right">0.6</td>
<td class="org-right">0.230769</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-left">Female</td>
<td class="org-right">0.4</td>
<td class="org-right">0.769231</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-left">Total</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>So 60% of the promoted were male and 40% of the promoted were female.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="o">.</span><span class="mi">6</span><span class="o">/.</span><span class="mi">4</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
1.50
</pre>
<p>If you were promoted you were one and a half times more likely to be male. Another way to look at it is to ask - <i>What proportion of each gender was promoted?</i></p>
<div class="highlight">
<pre><span></span><span class="n">fractions</span> <span class="o">=</span> <span class="n">study</span><span class="o">/</span><span class="n">study</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">fractions</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">Promoted</th>
<th class="org-right" scope="col">Not Promoted</th>
<th class="org-right" scope="col">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Male</td>
<td class="org-right">0.875</td>
<td class="org-right">0.125</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-left">Female</td>
<td class="org-right">0.583333</td>
<td class="org-right">0.416667</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-left">Total</td>
<td class="org-right">1.45833</td>
<td class="org-right">0.541667</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>So about 88% of the males were promoted while only 58% of the females were promoted.</p>
<div class="highlight">
<pre><span></span><span class="n">POINT_ESTIMATE</span> <span class="o">=</span> <span class="p">(</span><span class="n">fractions</span><span class="o">.</span><span class="n">Promoted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'Male'</span><span class="p">]</span>
                  <span class="o">-</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Promoted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'Female'</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">POINT_ESTIMATE</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
0.29
</pre>
<p>There was a 30% difference between the rate of male promotion and the rate of female promotion. The question we have now is - <i>could this difference have happened by random chance or is this evidence of bias?</i>.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org0e5744f">
<h3 id="org0e5744f">The Experiment</h3>
<div class="outline-text-3" id="text-org0e5744f">
<p>We have a <b>point estimate</b> of the difference of 0.29 - is this evidence of bias?</p>
</div>
<div class="outline-4" id="outline-container-orgdd97c19">
<h4 id="orgdd97c19">Our Hypotheses</h4>
<div class="outline-text-4" id="text-orgdd97c19">
<ul class="org-ul">
<li>\(H_0\): <b>Null Hypothesis.</b> The variables <code>gender</code> and =decision are independent and the observed difference was due to chance.</li>
<li>\(H_A\): <b>Alternative Hypothesis.</b> The variables <code>gender</code> and <code>decision</code> are not independent and the difference was not due to chance, but rather women were less likely to be promoted than men.</li>
</ul>
<p>I'm going to pick an arbitrary confidence interval of 0.95.</p>
<div class="highlight">
<pre><span></span><span class="n">ALPHA</span> <span class="o">=</span> <span class="mf">0.05</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgfab64c0">
<h4 id="orgfab64c0">The Simulation</h4>
<div class="outline-text-4" id="text-orgfab64c0">
<p>The basic method here is we'll create an "urn" with an equal number of "balls" for men and women (24 of each in this case) and then randomly select 35 balls representing the number that were promoted and see the difference in the fraction of males promoted vs the number of females. To make the math simple I'll run it a number of times that is a power of 10.</p>
</div>
<ul class="org-ul">
<li><a id="org7749984"></a>Some Setup<br>
<div class="outline-text-5" id="text-org7749984">
<p>To make the counting easier I'll set males to be 1 and females to be 0 (so the number of males promoted is the sum and the females is the remainder).</p>
<div class="highlight">
<pre><span></span><span class="n">NUMBER_OF_MALES</span> <span class="o">=</span> <span class="n">NUMBER_OF_FEMALES</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">MALE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">FEMALE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PROMOTED</span> <span class="o">=</span> <span class="mi">35</span>
<span class="n">MALES</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">NUMBER_OF_MALES</span><span class="p">)</span>
<span class="n">FEMALES</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NUMBER_OF_FEMALES</span><span class="p">)</span>
<span class="n">URN</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MALES</span><span class="p">,</span> <span class="n">FEMALES</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">URN</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">NUMBER_OF_MALES</span> <span class="o">+</span> <span class="n">NUMBER_OF_FEMALES</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">URN</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">NUMBER_OF_MALES</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><a id="orgdd4889a"></a>The Trials<br>
<div class="outline-text-5" id="text-orgdd4889a">
<div class="highlight">
<pre><span></span><span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">7</span>
<span class="n">males_promoted</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy_random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">URN</span><span class="p">,</span> <span class="n">PROMOTED</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                  <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">)]</span>
<span class="n">females_promoted</span> <span class="o">=</span> <span class="p">[</span><span class="n">PROMOTED</span> <span class="o">-</span> <span class="n">males</span> <span class="k">for</span> <span class="n">males</span> <span class="ow">in</span> <span class="n">males_promoted</span><span class="p">]</span>
<span class="n">proportion_males_promoted</span> <span class="o">=</span> <span class="p">[</span><span class="n">males</span><span class="o">/</span><span class="n">NUMBER_OF_MALES</span> <span class="k">for</span> <span class="n">males</span> <span class="ow">in</span> <span class="n">males_promoted</span><span class="p">]</span>
<span class="n">proportion_females_promoted</span> <span class="o">=</span> <span class="p">[</span><span class="n">females</span><span class="o">/</span><span class="n">NUMBER_OF_FEMALES</span> <span class="k">for</span> <span class="n">females</span> <span class="ow">in</span> <span class="n">females_promoted</span><span class="p">]</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">proportion_males_promoted</span><span class="p">,</span> <span class="n">proportion_females_promoted</span><span class="p">)</span>
<span class="n">differences</span> <span class="o">=</span> <span class="p">[</span><span class="n">males</span> <span class="o">-</span> <span class="n">females</span> <span class="k">for</span> <span class="n">males</span><span class="p">,</span> <span class="n">females</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org9ff33a9">
<h3 id="org9ff33a9">Looking at the Distribution</h3>
<div class="outline-text-3" id="text-org9ff33a9">
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span>
    <span class="s2">"Point Estimate"</span><span class="p">:</span> <span class="n">differences</span><span class="p">,</span>
    <span class="s2">"Males Promoted"</span><span class="p">:</span> <span class="n">males_promoted</span><span class="p">,</span>
    <span class="s2">"Females Promoted"</span><span class="p">:</span> <span class="n">females_promoted</span><span class="p">,</span>
    <span class="s2">"Proportion Males Promoted"</span><span class="p">:</span> <span class="n">proportion_males_promoted</span><span class="p">,</span>
    <span class="s2">"Proportion Females Promoted"</span><span class="p">:</span> <span class="n">proportion_females_promoted</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s2">"Point Estimate"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Distribution of Differences in Gender Promotion"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"difference_distribution"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/gender-discrimination/difference_distribution.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>The distribution looks <i>mostly</i> normal. As you might guess the distribution is centered around 0 (cases where exactly the same number of males and females were promoted - although 35 were promoted each time so the trials are never exactly 0). The cases where the difference in proportion is as great or greater than as it was in the original study are in the rightmost two bins.</p>
<p>I should note that because the sample size is so small, there's a weird distribution of the points - there's not enough variation in the differences to make a smooth curve (thus the gaps in the histogram).</p>
<div class="highlight">
<pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"Point Estimate"</span><span class="p">])</span>
<span class="n">theoretical</span><span class="p">,</span> <span class="n">actual</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">first</span> <span class="o">=</span> <span class="n">theoretical</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">last</span> <span class="o">=</span> <span class="n">theoretical</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">line</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Curve</span><span class="p">([(</span><span class="n">first</span><span class="p">,</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">first</span> <span class="o">+</span> <span class="n">intercept</span><span class="p">),</span> <span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">last</span> <span class="o">+</span> <span class="n">intercept</span><span class="p">)],</span>
                       <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>

<span class="n">qq_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span>
    <span class="s2">"Theoretical Quantiles"</span><span class="p">:</span> <span class="n">theoretical</span><span class="p">,</span>
    <span class="s2">"Differences In Hiring Rates"</span><span class="p">:</span> <span class="n">actual</span><span class="p">,</span>
<span class="p">})</span>

<span class="n">scatter</span> <span class="o">=</span> <span class="n">qq_frame</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Theoretical Quantiles"</span><span class="p">,</span>
                                  <span class="n">y</span><span class="o">=</span><span class="s2">"Differences In Hiring Rates"</span><span class="p">,</span> <span class="n">datashade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">scatter</span> <span class="o">*</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Hiring Probability Plot"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"differences_qq"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/gender-discrimination/differences_qq.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Hmmâ€¦ I'm not sure I'm doing that right. But it looks reasonable, I suppose.</p>
<div class="highlight">
<pre><span></span><span class="n">lowest</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"Point Estimate"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">data_sorted</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"Point Estimate"</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

<span class="n">max_loc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_sorted</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">)</span>
<span class="n">highest</span> <span class="o">=</span> <span class="n">data_sorted</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">max_loc</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Point Estimate: </span><span class="si">{</span><span class="n">POINT_ESTIMATE</span><span class="si">:</span><span class="s2"> 0.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="n">lowest</span><span class="si">:</span><span class="s2"> 0.3f</span><span class="si">}</span><span class="s2"> , </span><span class="si">{</span><span class="n">highest</span><span class="si">:</span><span class="s2"> 0.3f</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Point Estimate:  0.292
(-0.542 ,  0.208)
</pre>
<p>Looking at the confidence interval we can see that the original point estimate is higher than 95 % of the values, but the original book example used a hypothesis test so let's finish it up.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org59be2da">
<h3 id="org59be2da">A Hypothesis Test</h3>
<div class="outline-text-3" id="text-org59be2da">
<p>But anyway, what proportion of our simulations had as much or more of a difference than that found in the study?</p>
<div class="highlight">
<pre><span></span><span class="n">proportion</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">"Point Estimate"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">POINT_ESTIMATE</span><span class="p">])</span><span class="o">/</span><span class="n">TRIALS</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Proportion: </span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">proportion</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> %"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Proportion: 2.450 %
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Probability of our study's difference in promotion between genders by chance alone: </span><span class="si">{</span><span class="n">proportion</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Our tolerance was </span><span class="si">{</span><span class="n">ALPHA</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
</pre></div>
<pre class="example">
Probability of our study's difference in promotion between genders by chance alone: 0.02.
Our tolerance was 0.05.
</pre>
<p>So we reject the null hypothesis and conclude that there is a statistically significant chance that the number of women promoted vs men in the original study was the result of bias.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org2bb3d95">
<h2 id="org2bb3d95">End</h2>
<div class="outline-text-2" id="text-org2bb3d95">
<p>Well, that was the replication (sort of) of this problem from <a href="/posts/introductory-statistics-with-randomization-and-simulation/">Introductory Statistics with Randomization and Simulation</a>. The point of it was to both review Hypothesis Testing and see how it can be done using simulation rather than a p-test.</p>
</div>
<div class="outline-3" id="outline-container-org96959c6">
<h3 id="org96959c6">In Abstract</h3>
<div class="outline-text-3" id="text-org96959c6">
<ol class="org-ol">
<li>Is your problem that you suspect some kind of bias in outcomes for two groups?</li>
<li>Get the <b>Point Estimate</b> for the value you want to test</li>
<li>State the <b>Null Hypothesis</b> that what happened could happen by chance and the <b>Alternative Hypothesis</b> that there was bias involved.</li>
<li>Decide on a tolerance level for the probability that it happened by chance.</li>
<li>Set up your urn</li>
<li>Simulate random selections for a large number of trials.</li>
<li>Calculate the proporiton of the trials that were greater than the original studies Point Estimate.</li>
<li>Make a conclusion whether the original outcome could have happened by random chance or not.</li>
</ol>
</div>
</div>
<div class="outline-3" id="outline-container-org91ec2ad">
<h3 id="org91ec2ad">Source</h3>
<div class="outline-text-3" id="text-org91ec2ad">
<ul class="org-ul">
<li><a href="/posts/introductory-statistics-with-randomization-and-simulation/">Introductory Statistics with Randomization and Simulation</a></li>
<li>Rosen B, Jerdee TH. Influence of sex role stereotypes on personnel decisions. Journal of Applied Psychology. 1974 Feb;59(1):9 <a href="https://pdfs.semanticscholar.org/39f6/d40e907ff08af4ddd3280c2ceee55ee1ddb6.pdf">Link to PDF</a></li>
</ul>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/introductory-statistics-with-randomization-and-simulation/">Introductory Statistics with Randomization and Simulation</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/introductory-statistics-with-randomization-and-simulation/" rel="bookmark"><time class="published dt-published" datetime="2020-09-22T16:53:36-07:00" itemprop="datePublished" title="2020-09-22 16:53">2020-09-22 16:53</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-orgfe90002">
<h2 id="orgfe90002">Citation</h2>
<div class="outline-text-2" id="text-orgfe90002">
<ul class="org-ul">
<li>Diez DM, Barr CD, Ã‡etinkaya-Rundel M. Introductory statistics with randomization and simulation. OpenIntro.org; 2014. 348 p.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/oregon-covid-19-tables/">Oregon Covid-19 Tables</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/oregon-covid-19-tables/" rel="bookmark"><time class="published dt-published" datetime="2020-08-17T21:13:29-07:00" itemprop="datePublished" title="2020-08-17 21:13">2020-08-17 21:13</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/oregon-covid-19-tables/#org0f171b9">Beginning</a>
<ul>
<li><a href="/posts/oregon-covid-19-tables/#org27b4146">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/oregon-covid-19-tables/#orge231a40">Middle</a>
<ul>
<li><a href="/posts/oregon-covid-19-tables/#org5e8ec5d">Loading Some Tables</a></li>
<li><a href="/posts/oregon-covid-19-tables/#orge8c9491">By Sex</a></li>
</ul>
</li>
<li><a href="/posts/oregon-covid-19-tables/#org2218e2a">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org0f171b9">
<h2 id="org0f171b9">Beginning</h2>
<div class="outline-text-2" id="text-org0f171b9"></div>
<div class="outline-3" id="outline-container-org27b4146">
<h3 id="org27b4146">Set Up</h3>
<div class="outline-text-3" id="text-org27b4146"></div>
<div class="outline-4" id="outline-container-org2c2b949">
<h4 id="org2c2b949">Imports</h4>
<div class="outline-text-4" id="text-org2c2b949">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">tabula</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1aba00c">
<h4 id="org1aba00c">Plotting</h4>
<div class="outline-text-4" id="text-org1aba00c">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"oregon-covid-19-tables"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
    <span class="n">font_scale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color_cycle</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Cycle</span><span class="p">([</span><span class="s2">"#4687b7"</span><span class="p">,</span> <span class="s2">"#ce7b6d"</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orge231a40">
<h2 id="orge231a40">Middle</h2>
<div class="outline-text-2" id="text-orge231a40"></div>
<div class="outline-3" id="outline-container-org5e8ec5d">
<h3 id="org5e8ec5d">Loading Some Tables</h3>
<div class="outline-text-3" id="text-org5e8ec5d">
<div class="highlight">
<pre><span></span><span class="n">BASE</span> <span class="o">=</span> <span class="s2">"COVID-19-Weekly-Report-</span><span class="si">{date}</span><span class="s2">-FINAL.pdf"</span>

<span class="n">DATE</span> <span class="o">=</span> <span class="s2">"2020-05-27"</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">"~/.local/share/env"</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">())</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"OREGON_COVID"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="n">BASE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">DATE</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">filename</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">tabula</span><span class="o">.</span><span class="n">read_pdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pages</span><span class="o">=</span><span class="s2">"all"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tables</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'list'&gt;
15
</pre>
<p>Okay, so it found 15 tables, which should have been loaded as pandas DataFrames. Since a list doesn't really provide an easy way to get metadata, maybe I'll just traverse the list and see what's there.</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"*"</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org6c2bbb7">
    Sex  Cases % of total cases Cases per 10,000a  Deaths Case fatality (%)  \
0  Male  1,874            47.5%               8.7      85              4.5%   

   Hospitalized  
0           402  
********************
  Age group Cases % of total cases  Cases per 10,000a  Deaths  \
0       0-9    53             1.3%                1.1       0   

  Case fatality (%)  Hospitalized  
0                0%             6  
********************
  Unnamed: 0  Race  Cases % of total cases Cases per 10,000b  Deaths  \
0      White   NaN  1,946            49.3%               6.2   109.0   

  Case fatality (%)  Hospitalized  
0              5.6%         452.0  
********************
  Ethnicity Case count % of total cases Cases per 10,000a  Deaths  \
0  Hispanic      1,317            33.4%              23.7      14   

  Case fatality (%)  Hospitalized  
0              1.1%           178  
********************
                Facility name     County First reported  Total casesa  \
0  Healthcare at Foster Creek  Multnomah      3/24/2020         119.0   

   Total deathsa  
0           30.0  
********************
   ZIP code Number of cases Cases per 10,000
0     97002             1â€“9              n/a
********************
   97053 1â€“9  n/a
0  97054   0  0.0
********************
   97148   0  0.0
0  97201  13  8.4
********************
   97324   0   0.0
0  97325  10  15.1
********************
   97411    0  0.0
0  97415  1â€“9  n/a
********************
   97501 1â€“9  n/a
0  97502  13  4.7
********************
   97813  1â€“9  n/a
0  97814  1â€“9  n/a
********************
  Hospital                    Max Patients    Max Patients.1
0      NaN  (Both suspected and confirmed)  (Confirmed only)
********************
                               Hospital
0  Asante Rogue Regional Medical Center
********************
  Providence Newberg Medical Center
0       Providence Seaside Hospital
********************
</pre>
<p>Most of the tables appear to be either fragments or case-counts based on different categorizations.</p>
<div class="highlight">
<pre><span></span><span class="n">COLUMNS</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">sex</span><span class="o">=</span><span class="s2">"Sex"</span><span class="p">,</span>
    <span class="n">cases</span><span class="o">=</span><span class="s2">"Cases"</span><span class="p">,</span>
    <span class="n">cases_per_10000</span> <span class="o">=</span> <span class="s2">"Cases per 10,000a"</span><span class="p">,</span>
    <span class="n">percent</span> <span class="o">=</span> <span class="s2">"</span><span class="si">% o</span><span class="s2">f total cases"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orge8c9491">
<h3 id="orge8c9491">By Sex</h3>
<div class="outline-text-3" id="text-orge8c9491">
<div class="highlight">
<pre><span></span><span class="n">tables_2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sex</span><span class="o">=</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tables_2</span><span class="p">[</span><span class="s2">"sex"</span><span class="p">])</span>
</pre></div>
<pre class="example" id="org9764c3c">
             Sex  Cases % of total cases Cases per 10,000a  Deaths  \
0           Male  1,874            47.5%               8.7      85   
1         Female  2,071            52.4%               9.9      63   
2     Non-Binary      1               0%               n/a       0   
3  Not available      3             0.1%               n/a       0   
4          Total  3,949           100.0%               9.3     148   

  Case fatality (%)  Hospitalized  
0              4.5%           402  
1              3.0%           344  
2                0%             0  
3                0%             1  
4              3.7%           747  
</pre>
<p>One thing to notice is that there are "n/a", ",", and "%" strings in there that prevent some columns from being treated as numbers.</p>
<div class="highlight">
<pre><span></span><span class="n">tables_2</span><span class="p">[</span><span class="s2">"sex"</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">males_females</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
<pre class="example" id="org15217f8">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 5 entries, 0 to 4
Data columns (total 7 columns):
 #   Column             Non-Null Count  Dtype 
---  ------             --------------  ----- 
 0   Sex                5 non-null      object
 1   Cases              5 non-null      object
 2   % of total cases   5 non-null      object
 3   Cases per 10,000a  5 non-null      object
 4   Deaths             5 non-null      int64 
 5   Case fatality (%)  5 non-null      object
 6   Hospitalized       5 non-null      int64 
dtypes: int64(2), object(5)
memory usage: 408.0+ bytes
</pre>
<p>So to use most of the columns you have to do something to convert them back to numbers. I'll start by looking at male and female cases adjusted by population.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">bar_plot</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">x_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">y_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">title</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""Plot the data as a bar-plot</span>

<span class="sd">    Args:</span>
<span class="sd">     data: thing to plot</span>
<span class="sd">     x_column: name of column for the x-axis</span>
<span class="sd">     y_column: name of the column with the bar height</span>
<span class="sd">     title: Title for the plot</span>
<span class="sd">     filename: Name to save the plot</span>

<span class="sd">    Returns:</span>
<span class="sd">     html: the html to use to embed the plot into org</span>
<span class="sd">    """</span>

    <span class="n">plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_column</span><span class="p">,</span>
                           <span class="n">y</span><span class="o">=</span><span class="n">y_column</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
                               <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                               <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">font_scale</span><span class="p">,</span>
                               <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<span class="p">)</span>

    <span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">filename</span><span class="p">)()</span>
    <span class="k">return</span> <span class="n">outcome</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">gender_bar</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">bar_plot</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">males_females</span><span class="p">,</span> <span class="n">x_column</span><span class="o">=</span><span class="n">COLUMNS</span><span class="o">.</span><span class="n">sex</span><span class="p">)</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgccb246d">
<h4 id="orgccb246d">Total Cases</h4>
<div class="outline-text-4" id="text-orgccb246d">
<p>First, make the counts integers.</p>
<div class="highlight">
<pre><span></span><span class="n">males_females</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">COLUMNS</span><span class="o">.</span><span class="n">cases</span><span class="p">]</span> <span class="o">=</span> <span class="n">males_females</span><span class="p">[</span><span class="n">COLUMNS</span><span class="o">.</span><span class="n">cases</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s2">","</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
<p>Now a little bar plot.</p>
<div class="highlight">
<pre><span></span><span class="n">outcome</span> <span class="o">=</span> <span class="n">gender_bar</span><span class="p">(</span><span class="n">y_column</span><span class="o">=</span><span class="n">COLUMNS</span><span class="o">.</span><span class="n">cases</span><span class="p">,</span>
                     <span class="n">title</span><span class="o">=</span><span class="s2">"Cases by Gender"</span><span class="p">,</span>
                     <span class="n">filename</span><span class="o">=</span><span class="s2">"cases_by_gender"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/oregon-covid-19-tables/cases_by_gender.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>There were slightly more female cases than male cases.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgbbf5a61">
<h4 id="orgbbf5a61">Case Percentages</h4>
<div class="outline-text-4" id="text-orgbbf5a61">
<div class="highlight">
<pre><span></span><span class="n">males_females</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">COLUMNS</span><span class="o">.</span><span class="n">percent</span><span class="p">]</span> <span class="o">=</span> <span class="n">males_females</span><span class="p">[</span><span class="n">COLUMNS</span><span class="o">.</span><span class="n">percent</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s2">"%"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">outcome</span> <span class="o">=</span> <span class="n">gender_bar</span><span class="p">(</span><span class="n">y_column</span><span class="o">=</span><span class="n">COLUMNS</span><span class="o">.</span><span class="n">percent</span><span class="p">,</span>
                     <span class="n">title</span><span class="o">=</span><span class="s2">"Case Percentage by Gender"</span><span class="p">,</span>
                     <span class="n">filename</span><span class="o">=</span><span class="s2">"percentage_by_gender"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/oregon-covid-19-tables/percentage_by_gender.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-4" id="outline-container-org798a87d">
<h4 id="org798a87d">Cases Adjusted For Population</h4>
<div class="outline-text-4" id="text-org798a87d">
<div class="highlight">
<pre><span></span><span class="n">males_females</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">COLUMNS</span><span class="o">.</span><span class="n">cases_per_10000</span><span class="p">]</span> <span class="o">=</span> <span class="n">males_females</span><span class="p">[</span>
    <span class="n">COLUMNS</span><span class="o">.</span><span class="n">cases_per_10000</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">males_females</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">COLUMNS</span><span class="o">.</span><span class="n">sex</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">COLUMNS</span><span class="o">.</span><span class="n">cases_per_10000</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,</span>
                                <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">font_scale</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Cases per 10,000 Population by Gender"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"cases_by_sex_and_population"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/oregon-covid-19-tables/cases_by_sex_and_population.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org2218e2a">
<h2 id="org2218e2a">End</h2>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="/" rel="prev">Newer posts</a></li>
<li class="next"><a href="/index-7.html" rel="next">Older posts</a></li>
</ul>
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
</script><!--End of body content-->
<footer id="footer">Contents Â© 2021 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script> </div>
</div>
</body>
</html>
