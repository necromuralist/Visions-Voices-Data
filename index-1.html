<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Adumbrations of data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Visions, Voices, Data (old posts, page 1) | Visions, Voices, Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/index-1.html" rel="canonical">
<link href="." rel="prev" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/Visions-Voices-Data/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" style="margin-top: 4px;" type="text"><input style="visibility: hidden;" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/portland-daily-climate/portland-daily-temperatures-data/">Portland Daily Temperatures Data</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/portland-daily-climate/portland-daily-temperatures-data/" rel="bookmark"><time class="published dt-published" datetime="2019-01-21T17:31:32-08:00" itemprop="datePublished" title="2019-01-21 17:31">2019-01-21 17:31</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#orge5642a9">Introduction</a></li>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#orgd83b347">Set Up</a></li>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#org4f08676">Loading the Data</a></li>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#orga567979">Cleaning</a></li>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#orgcdc82b1">Figuring Out the Missing Date</a></li>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#orgace35a6">Pivot the Metric Column</a></li>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#org54b06bc">Updating the Columns</a></li>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#org28ad4a8">Save the Message Pack</a></li>
<li><a href="posts/portland-daily-climate/portland-daily-temperatures-data/#org59c3adc">Looking at Some Plots</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge5642a9">
<h2 id="orge5642a9">Introduction</h2>
<div class="outline-text-2" id="text-orge5642a9">
<p>I'm going to work with the Daily Temperatures data set for Portland, Oregon (measured at the airport) taken from the <a href="https://w2.weather.gov/climate/local_data.php?wfo=pqr">National Weather Service</a>. I cleaned it up a little already, removing the extra header rows and adding a missing column header (<code>Metric</code>) but the data is arranged with the year and month as a column and then each day is given its own column, which isn't how I want to work with it, so I'm going to transform it a little to make it more like what I expect it to look like.}</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgd83b347">
<h2 id="orgd83b347">Set Up</h2>
<div class="outline-text-2" id="text-orgd83b347"></div>
<div class="outline-3" id="outline-container-orga20a174">
<h3 id="orga20a174">Imports</h3>
<div class="outline-text-3" id="text-orga20a174"></div>
<div class="outline-4" id="outline-container-org2ba65ed">
<h4 id="org2ba65ed">Python</h4>
<div class="outline-text-4" id="text-org2ba65ed">/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgde9675f">
<h4 id="orgde9675f">From PyPi</h4>
<div class="outline-text-4" id="text-orgde9675f">/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org3af0861">
<h3 id="org3af0861">Plotting</h3>
<div class="outline-text-3" id="text-org3af0861">/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'matplotlib'</span><span class="p">,</span> <span class="s1">'inline'</span><span class="p">)</span>
<span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'config'</span><span class="p">,</span> <span class="s2">"InlineBackend.figure_format = 'retina'"</span><span class="p">)</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"whitegrid"</span><span class="p">,</span>
            <span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">"axes.grid"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">"font.family"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"sans-serif"</span><span class="p">],</span>
                <span class="s2">"font.sans-serif"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Open Sans"</span><span class="p">,</span> <span class="s2">"Latin Modern Sans"</span><span class="p">,</span> <span class="s2">"Lato"</span><span class="p">],</span>
                <span class="s2">"figure.figsize"</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)},</span>
            <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org4f08676">
<h2 id="org4f08676">Loading the Data</h2>
<div class="outline-text-2" id="text-org4f08676">/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"CSV"</span><span class="p">))</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
</pre></div>
<pre class="example">
/home/hades/data/datasets/necromuralist/daily-climate-data/portland_1940_to_april_2018.csv

</pre></div>
<div class="outline-3" id="outline-container-orgf270d81">
<h3 id="orgf270d81">Some Preparation</h3>
<div class="outline-text-3" id="text-orgf270d81">
<p>The first thing to work with is that there are three characters representing "missing" data (that I noticed) - <i>M</i>, <i>T</i>, and <i>-</i> - that we have to tell pandas about when we use <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">read_csv</a>.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"M"</span><span class="p">,</span> <span class="s2">"T"</span><span class="p">,</span> <span class="s2">"-"</span><span class="p">]</span>
</pre></div>
<p>I was going to load the measurement type (e.g. "TX"), but I realized that I was planning to turn those into column headers so maybe it's not a good idea.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="n">missing</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
(3756, 35)

</pre>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
<pre class="example">
Index(['YR', 'MO', 'Metric', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10',
       '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22',
       '23', '24', '25', '26', '27', '28', '29', '30', '31', 'AVG or Total'],
      dtype='object')

</pre>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
<pre class="example">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 3756 entries, 0 to 3755
Data columns (total 35 columns):
YR              3756 non-null int64
MO              3756 non-null int64
Metric          3756 non-null object
1               3602 non-null float64
2               3554 non-null float64
3               3583 non-null float64
4               3604 non-null float64
5               3599 non-null float64
6               3610 non-null float64
7               3587 non-null object
8               3590 non-null float64
9               3595 non-null float64
10              3614 non-null float64
11              3602 non-null float64
12              3600 non-null float64
13              3583 non-null float64
14              3582 non-null float64
15              3591 non-null float64
16              3604 non-null float64
17              3598 non-null float64
18              3615 non-null float64
19              3611 non-null float64
20              3588 non-null float64
21              3606 non-null float64
22              3609 non-null float64
23              3595 non-null float64
24              3605 non-null float64
25              3598 non-null float64
26              3600 non-null float64
27              3598 non-null float64
28              3593 non-null float64
29              3371 non-null float64
30              3294 non-null float64
31              2097 non-null float64
AVG or Total    3616 non-null float64
dtypes: float64(31), int64(2), object(2)
memory usage: 1.0+ MB
None
</pre>
<p>For some reason column <code>7</code> wasn't converted to a float.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"7"</span><span class="p">]):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Row: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
</pre></div>
<pre class="example">
could not convert string to float: 
Row: 1835
Value:  

</pre>
<p>It turns out that this one row also had a space (' ') for one of the values. Strange.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="n">missing</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
<pre class="example">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 3756 entries, 0 to 3755
Data columns (total 35 columns):
YR              3756 non-null int64
MO              3756 non-null int64
Metric          3756 non-null object
1               3602 non-null float64
2               3554 non-null float64
3               3583 non-null float64
4               3604 non-null float64
5               3599 non-null float64
6               3610 non-null float64
7               3586 non-null float64
8               3590 non-null float64
9               3595 non-null float64
10              3614 non-null float64
11              3602 non-null float64
12              3600 non-null float64
13              3583 non-null float64
14              3582 non-null float64
15              3591 non-null float64
16              3604 non-null float64
17              3598 non-null float64
18              3615 non-null float64
19              3611 non-null float64
20              3588 non-null float64
21              3606 non-null float64
22              3609 non-null float64
23              3595 non-null float64
24              3605 non-null float64
25              3598 non-null float64
26              3600 non-null float64
27              3598 non-null float64
28              3593 non-null float64
29              3371 non-null float64
30              3294 non-null float64
31              2097 non-null float64
AVG or Total    3616 non-null float64
dtypes: float64(32), int64(2), object(1)
memory usage: 1.0+ MB
None
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orga567979">
<h2 id="orga567979">Cleaning</h2>
<div class="outline-text-2" id="text-orga567979"></div>
<div class="outline-3" id="outline-container-org0ad4c53">
<h3 id="org0ad4c53">Drop the Last Column</h3>
<div class="outline-text-3" id="text-org0ad4c53">
<p>Besides the fact that the last column is a calculated one, the fact that it's ambiguous (I guess you can tell by how big it is whether it's a Total, but still) makes me think I should get rid of the last column (using <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.drop.html">drop</a>).</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">cleaned</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
<pre class="example">
(3756, 34)

</pre></div>
</div>
<div class="outline-3" id="outline-container-org89d2229">
<h3 id="org89d2229">Rotate the Days</h3>
<div class="outline-text-3" id="text-org89d2229">
<p>Now I'm going to move the day-columns into row-values using <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.melt.html">melt</a>.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">melted</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"YR"</span><span class="p">,</span> <span class="s2">"MO"</span><span class="p">,</span> <span class="s2">"Metric"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Day"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Value"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">melted</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
     YR  MO Metric Day  Value
0  1940  10     TX   1    NaN
1  1940  10     TN   1    NaN
2  1940  10     PR   1    NaN
3  1940  10     SN   1    NaN
4  1940  11     TX   1   52.0

</pre>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">melted</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">31</span>
</pre></div>
<pre class="example">
(116436, 5)

</pre></div>
<div class="outline-4" id="outline-container-org9f3edd2">
<h4 id="org9f3edd2">Casting the Days to Integers</h4>
<div class="outline-text-4" id="text-org9f3edd2">
<p>Although they look like integers, the <code>Day</code> column was converted from column headers so they're strings. Maybe I could have cast them at the time of the conversion, but, oh, well.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">melted</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Day</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'str'&gt;

</pre>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">melted</span><span class="p">[</span><span class="s2">"Day"</span><span class="p">]</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">Day</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">melted</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Day</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'numpy.int64'&gt;

</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org91a9a55">
<h3 id="org91a9a55">Make a Date Column</h3>
<div class="outline-text-3" id="text-org91a9a55">
<p>Now I'll make a single date column.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">melted</span><span class="p">[</span><span class="s2">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">YR</span><span class="p">,</span>
                                                   <span class="n">month</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">MO</span><span class="p">,</span>
                                                   <span class="n">day</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">Day</span><span class="p">),</span>
                              <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">melted</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<p>That raised an error..</p>
<pre class="example">
ValueError: ('day is out of range for month', 'occurred at index 105184')
</pre>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">melted</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">105184</span><span class="p">])</span>
</pre></div>
<pre class="example">
YR        1941
MO           2
Metric      TX
Day         29
Value        -
Name: 105184, dtype: object

</pre>
<p>Okay, so here we have a problem in that not all the dates exist. Also, for some reason the '-' didn't get converted to a NaN, but one thing at a time.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">to_datetime</span><span class="p">(</span><span class="n">row</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
    <span class="sd">"""Converts the row to a datetime</span>

<span class="sd">    Args:</span>
<span class="sd">     row: row in the dataframe with year, month, and day</span>
<span class="sd">    Returns:</span>
<span class="sd">     row converted to datetime or None if it isn't valid</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pandas</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">YR</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">MO</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">Day</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">return</span>    
</pre></div>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">started</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">melted</span><span class="p">[</span><span class="s2">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">to_datetime</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">melted</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Elapsed: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">started</span><span class="p">))</span>
</pre></div>
<pre class="example">
day is out of range for month
     YR  MO Metric  Day  Value       date
0  1940  10     TX    1    NaN        NaT
1  1940  10     TN    1    NaN        NaT
2  1940  10     PR    1    NaN        NaT
3  1940  10     SN    1    NaN        NaT
4  1940  11     TX    1   52.0 1940-11-01
Elapsed: 0:00:09.351053

</pre>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"Fraction Missing: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">melted</span><span class="p">[</span><span class="n">melted</span><span class="o">.</span><span class="n">Value</span><span class="o">.</span><span class="n">isnull</span><span class="p">()])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">melted</span><span class="p">)))</span>
</pre></div>
<pre class="example">
Fraction Missing: 0.06

</pre></div>
</div>
<div class="outline-3" id="outline-container-orgfbd480f">
<h3 id="orgfbd480f">Drop the Missing</h3>
<div class="outline-text-3" id="text-orgfbd480f">
<p>Here I'll drop the dates that didn't have data.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">cleaned</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">"Value"</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
     YR  MO Metric  Day  Value       date
4  1940  11     TX    1  52.00 1940-11-01
5  1940  11     TN    1  40.00 1940-11-01
6  1940  11     PR    1   0.17 1940-11-01
7  1940  11     SN    1   0.00 1940-11-01
8  1940  12     TX    1  51.00 1940-12-01

</pre></div>
</div>
<div class="outline-3" id="outline-container-org395c528">
<h3 id="org395c528">Drop the Extra Date Coulmns</h3>
<div class="outline-text-3" id="text-org395c528">
<p>Since we have a date column I'll get rid of the columns that made it up.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">cleaned</span> <span class="o">=</span> <span class="n">cleaned</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"YR"</span><span class="p">,</span> <span class="s2">"MO"</span><span class="p">,</span> <span class="s2">"Day"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
  Metric  Value       date
4     TX  52.00 1940-11-01
5     TN  40.00 1940-11-01
6     PR   0.17 1940-11-01
7     SN   0.00 1940-11-01
8     TX  51.00 1940-12-01

</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgcdc82b1">
<h2 id="orgcdc82b1">Figuring Out the Missing Date</h2>
<div class="outline-text-2" id="text-orgcdc82b1">
<p>One of the entries has values but no date.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="p">[</span><span class="n">cleaned</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isnull</span><span class="p">()])</span>
</pre></div>
<pre class="example">
       Metric  Value date
105427     SN   34.0  NaT

</pre>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">melted</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">105427</span><span class="p">])</span>
</pre></div>
<pre class="example">
YR        1946
MO           2
Metric      SN
Day         29
Value       34
date       NaT
Name: 105427, dtype: object

</pre>
<p>I looked it up and 1946 isn't a leap-year, so there's no February 29, 1946. Did something get lost in translation?</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">YR</span><span class="o">==</span><span class="mi">1946</span><span class="p">)</span> <span class="o">&</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">MO</span><span class="o">==</span><span class="mi">2</span><span class="p">)])</span>
</pre></div>
<pre class="example">
       YR  MO Metric      1      2     3      4      5      6      7  \
256  1946   2     TX  48.00  47.00  45.0  43.00  48.00  48.00  43.00   
257  1946   2     TN  44.00  35.00  32.0  32.00  37.00  39.00  33.00   
258  1946   2     PR   0.05   0.02   NaN   0.01   1.54   0.63   0.06   
259  1946   2     SN   0.00   0.00   0.0   0.00   0.00   0.00   0.00   

         ...         23     24    25     26     27     28    29  30  31  \
256      ...       58.0  52.00  53.0  49.00  53.00  55.00   NaN NaN NaN   
257      ...       43.0  40.00  39.0  35.00  44.00  40.00   NaN NaN NaN   
258      ...        0.1   0.26   NaN   0.57   0.64   0.04   NaN NaN NaN   
259      ...        0.0   0.00   0.0   0.00   0.00   0.00  34.0 NaN NaN   

     AVG or Total  
256         49.40  
257         36.00  
258          4.99  
259          0.00  

[4 rows x 35 columns]
</pre>
<p>It looks like there's something wrong with the snowfall measurement for that date, the other measurements don't have values.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">YR</span><span class="o">==</span><span class="mi">1946</span><span class="p">)</span> <span class="o">&</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">MO</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="o">&</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Metric</span><span class="o">==</span><span class="s2">"SN"</span><span class="p">)])</span>
</pre></div>
<pre class="example">
       YR  MO Metric    1    2    3    4    5    6    7      ...        23  \
259  1946   2     SN  0.0  0.0  0.0  0.0  0.0  0.0  0.0      ...       0.0   

      24   25   26   27   28    29  30  31  AVG or Total  
259  0.0  0.0  0.0  0.0  0.0  34.0 NaN NaN           0.0  

[1 rows x 35 columns]

</pre>
<p>It was just all 0's and then there's this mysterious 34 inches of snow on the 29th of February. I'm pretty sure that's a mistake. I'll have to delete that.</p>
<p>Although I have the index in the original <code>data</code> frame I've already done all this cleaning so I think it's easier just to drop the missing dates.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">cleaned</span><span class="o">.</span><span class="n">shape</span>
<span class="n">cleaned</span> <span class="o">=</span> <span class="n">cleaned</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">"date"</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgace35a6">
<h2 id="orgace35a6">Pivot the Metric Column</h2>
<div class="outline-text-2" id="text-orgace35a6">
<p>So, besides getting the dates into a column one of the points of this was to get the metric types into columns by <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.pivot.html">pivoting</a>. I guess you could argue that this is just a category, but since each date gets all four of the values I think this makes sense.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">pivoted</span> <span class="o">=</span> <span class="n">cleaned</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">"date"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">"Metric"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">"Value"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">pivoted</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
Metric        PR   SN    TN    TX
date                             
1940-10-13  0.01  0.0  57.0  75.0
1940-10-14   NaN  0.0  53.0  70.0
1940-10-15   NaN  0.0  52.0  64.0
1940-10-16  0.00  0.0  50.0  72.0
1940-10-17  0.13  0.0  58.0  72.0

</pre>
<p>It looks like there's some missing precipitation data. I don't really have a solution for that. I think decisions to imput missing values should come when the data set is being used.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"PR"</span><span class="p">,</span> <span class="s2">"SN"</span><span class="p">,</span> <span class="s2">"TN"</span><span class="p">,</span> <span class="s2">"TX"</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"{} Missing: {:,}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pivoted</span><span class="p">[</span><span class="n">pivoted</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()])))</span>
</pre></div>
<pre class="example">
PR Missing: 3,297
SN Missing: 523
TN Missing: 0
TX Missing: 0

</pre>
<p>So it looks like we're okay with the temperatures but maybe not so well off with the precipitation.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">missing</span> <span class="o">=</span> <span class="n">pivoted</span><span class="p">[</span><span class="n">pivoted</span><span class="o">.</span><span class="n">PR</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
<span class="n">missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"missing"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">monthly</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">missing</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"M"</span><span class="p">)</span>
</pre></div>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Missing Monthly Precipitation"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">monthly</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">stem</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
</pre></div>
<p><img alt="missing_pr.png" src="posts/portland-daily-climate/portland-daily-temperatures-data/missing_pr.png"> So, I was expecting this to be a problem that happened early and then died out, but it appears there's an ongoing problem with collecting precipitation - or maybe they use a symbol for 0 that I'm interpreting as missing?</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">yearly</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">missing</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"Y"</span><span class="p">)</span>
</pre></div>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Missing Yearly Precipitation"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">yearly</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">stem</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="missing_yearly_pr.png" src="posts/portland-daily-climate/portland-daily-temperatures-data/missing_yearly_pr.png"></p>
</div>
<p>This does seem problematic, if I do anything with precipitation I'll have to figure out what's going on here.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org54b06bc">
<h2 id="org54b06bc">Updating the Columns</h2>
<div class="outline-text-2" id="text-org54b06bc">
<p>The whole <code>TX</code>, <code>TN</code>, etc. encoding scheme seems like it causes too much mental overhead so I'm going to rename the metric columns.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">renamed</span> <span class="o">=</span> <span class="n">pivoted</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">PR</span><span class="o">=</span><span class="s2">"precipitation"</span><span class="p">,</span>
                              <span class="n">SN</span><span class="o">=</span><span class="s2">"snowfall"</span><span class="p">,</span>
                              <span class="n">TN</span><span class="o">=</span><span class="s2">"minimum_temperature"</span><span class="p">,</span>
                              <span class="n">TX</span><span class="o">=</span><span class="s2">"maximum_temperature"</span><span class="p">),</span>
                         <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">renamed</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
Metric      precipitation  snowfall  minimum_temperature  maximum_temperature
date                                                                         
1940-10-13           0.01       0.0                 57.0                 75.0
1940-10-14            NaN       0.0                 53.0                 70.0
1940-10-15            NaN       0.0                 52.0                 64.0
1940-10-16           0.00       0.0                 50.0                 72.0
1940-10-17           0.13       0.0                 58.0                 72.0

</pre></div>
</div>
<div class="outline-2" id="outline-container-org28ad4a8">
<h2 id="org28ad4a8">Save the Message Pack</h2>
<div class="outline-text-2" id="text-org28ad4a8">
<p>Now that we have the cleaned-up data, I'll save it as a message pack.</p>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">pack_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"MESSAGE_PACK"</span><span class="p">))</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">pack_path</span><span class="p">)</span>
</pre></div>
<pre class="example">
/home/hades/pCloudDrive/data/daily-climate-data/portland_1940_to_april_2018.msg

</pre>
/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">renamed</span><span class="o">.</span><span class="n">to_msgpack</span><span class="p">(</span><span class="n">pack_path</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">pack_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org59c3adc">
<h2 id="org59c3adc">Looking at Some Plots</h2>
<div class="outline-text-2" id="text-org59c3adc">/home/athena/.virtualenvs/Visions-Voices-Data/bin/python3: No module named virtualfish
<div class="highlight">
<pre><span></span><span class="n">maximum_temperature</span> <span class="o">=</span> <span class="n">renamed</span><span class="o">.</span><span class="n">maximum_temperature</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"Y"</span><span class="p">)</span>
<span class="n">medians</span> <span class="o">=</span> <span class="n">maximum_temperature</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">maxes</span> <span class="o">=</span> <span class="n">maximum_temperature</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">mins</span> <span class="o">=</span> <span class="n">maximum_temperature</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Portland, OR Yearly Maximum Daily Temperatures"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">maxes</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">maxes</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s2">"ro"</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">"Maximum"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">mins</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">mins</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s2">"go"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Minimum"</span><span class="p">)</span>
<span class="n">stem</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">medians</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">medians</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Median"</span><span class="p">)</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
<div class="figure">
<p><img alt="median_yearly_temperature.png" src="posts/portland-daily-climate/portland-daily-temperatures-data/median_yearly_temperature.png"></p>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/tutorials/kaggle-on-time-series-visualization/">Kaggle On Time-Series Visualization</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/tutorials/kaggle-on-time-series-visualization/" rel="bookmark"><time class="published dt-published" datetime="2019-01-20T13:12:55-08:00" itemprop="datePublished" title="2019-01-20 13:12">2019-01-20 13:12</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org806bf51">Introduction</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#orgd6c52b5">Set Up</a>
<ul>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org9c2d9c5">Imports</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org69c897d">Plotting</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#orgf9b7bda">Setup Libraries</a></li>
</ul>
</li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#orgb24afa4">The Data</a>
<ul>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#orge4a982a">New York Stock Exchange Prices</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org210002a">Shelter Outcomes</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org7a65e6f">Cryptocurrency</a></li>
</ul>
</li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#orgffe2e5a">Grouping</a>
<ul>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org1a73eaa">Birth Dates</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org9d45fdc">Outcomes</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#orgde0c4e3">Trading Volume</a></li>
</ul>
</li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org773c39d">Lag Plots</a>
<ul>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org74c7c78">NYSE</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org76330e0">UPS</a></li>
</ul>
</li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org424c6a1">Autcorrelation Plot</a>
<ul>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org1ed9bb2">UPS</a></li>
</ul>
</li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#orgf6e7937">Cryptocurrency</a>
<ul>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#org1b356de">Lag Plot</a></li>
<li><a href="posts/tutorials/kaggle-on-time-series-visualization/#orgbca338b">Autocorrelation Plot</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org806bf51">
<h2 id="org806bf51">Introduction</h2>
<div class="outline-text-2" id="text-org806bf51">
<p>This is a walk-through of the kaggle notebook on <a href="https://www.kaggle.com/residentmario/time-series-plotting-optional">Time-Series Plotting</a> by Aleksey Bilogur.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgd6c52b5">
<h2 id="orgd6c52b5">Set Up</h2>
<div class="outline-text-2" id="text-orgd6c52b5"></div>
<div class="outline-3" id="outline-container-org9c2d9c5">
<h3 id="org9c2d9c5">Imports</h3>
<div class="outline-text-3" id="text-org9c2d9c5"></div>
<div class="outline-4" id="outline-container-orgfe7b97b">
<h4 id="orgfe7b97b">From Python</h4>
<div class="outline-text-4" id="text-orgfe7b97b">
<div class="highlight">
<pre><span></span>from datetime import datetime
from functools import partial
from pathlib import Path
import os
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc091065">
<h4 id="orgc091065">From PyPi</h4>
<div class="outline-text-4" id="text-orgc091065">
<div class="highlight">
<pre><span></span>from dotenv import load_dotenv
from pandas.plotting import autocorrelation_plot, lag_plot
from tabulate import tabulate
import matplotlib
import matplotlib.pyplot as pyplot
import pandas
import seaborn
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org69c897d">
<h3 id="org69c897d">Plotting</h3>
<div class="outline-text-3" id="text-org69c897d">
<div class="highlight">
<pre><span></span>get_ipython().run_line_magic('matplotlib', 'inline')
get_ipython().run_line_magic('config', "InlineBackend.figure_format = 'retina'")
seaborn.set(style="whitegrid",
            rc={"axes.grid": False,
                "font.family": ["sans-serif"],
                "font.sans-serif": ["Open Sans", "Latin Modern Sans", "Lato"],
                "figure.figsize": (8, 6)},
            font_scale=1)
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf9b7bda">
<h3 id="orgf9b7bda">Setup Libraries</h3>
<div class="outline-text-3" id="text-orgf9b7bda">
<div class="highlight">
<pre><span></span>load_dotenv()
table = partial(tabulate, headers="keys", tablefmt="orgtbl")
kaggle_path = Path(os.environ.get("KAGGLE")).expanduser()
assert kaggle_path.is_dir()
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb24afa4">
<h2 id="orgb24afa4">The Data</h2>
<div class="outline-text-2" id="text-orgb24afa4"></div>
<div class="outline-3" id="outline-container-orge4a982a">
<h3 id="orge4a982a">New York Stock Exchange Prices</h3>
<div class="outline-text-3" id="text-orge4a982a">
<div class="highlight">
<pre><span></span>nyse_path = kaggle_path.joinpath("nyse/prices.csv")
assert nyse_path.is_file()
nyse = pandas.read_csv(nyse_path, parse_dates=["date"])
</pre></div>
<div class="highlight">
<pre><span></span>nyse.info()
</pre></div>
<pre class="example">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 851264 entries, 0 to 851263
Data columns (total 7 columns):
date      851264 non-null datetime64[ns]
symbol    851264 non-null object
open      851264 non-null float64
close     851264 non-null float64
low       851264 non-null float64
high      851264 non-null float64
volume    851264 non-null float64
dtypes: datetime64[ns](1), float64(5), object(1)
memory usage: 45.5+ MB
</pre>
<div class="highlight">
<pre><span></span>nyse = nyse.set_index("date")
print(table(nyse.head()))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">date</th>
<th class="org-left" scope="col">symbol</th>
<th class="org-right" scope="col">open</th>
<th class="org-right" scope="col">close</th>
<th class="org-right" scope="col">low</th>
<th class="org-right" scope="col">high</th>
<th class="org-right" scope="col">volume</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">2016-01-05 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">123.43</td>
<td class="org-right">125.84</td>
<td class="org-right">122.31</td>
<td class="org-right">126.25</td>
<td class="org-right">2.1636e+06</td>
</tr>
<tr>
<td class="org-left">2016-01-06 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">125.24</td>
<td class="org-right">119.98</td>
<td class="org-right">119.94</td>
<td class="org-right">125.54</td>
<td class="org-right">2.3864e+06</td>
</tr>
<tr>
<td class="org-left">2016-01-07 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">116.38</td>
<td class="org-right">114.95</td>
<td class="org-right">114.93</td>
<td class="org-right">119.74</td>
<td class="org-right">2.4895e+06</td>
</tr>
<tr>
<td class="org-left">2016-01-08 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">115.48</td>
<td class="org-right">116.62</td>
<td class="org-right">113.5</td>
<td class="org-right">117.44</td>
<td class="org-right">2.0063e+06</td>
</tr>
<tr>
<td class="org-left">2016-01-11 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">117.01</td>
<td class="org-right">114.97</td>
<td class="org-right">114.09</td>
<td class="org-right">117.33</td>
<td class="org-right">1.4086e+06</td>
</tr>
</tbody>
</table>
<p>The notebook describes this as an example of a "strong" date case because the dates act as an explicit index for the data and are, in this case, an aggregate for a day of trading.</p>
</div>
<div class="outline-4" id="outline-container-org0e5293a">
<h4 id="org0e5293a">UPS</h4>
<div class="outline-text-4" id="text-org0e5293a">
<p>Some of the correlational plots don't show anything meaningful when you use the market as a whole (I guess because different stocks are moving in different directions) so I'm going to pull out the UPS stock information to use later.</p>
<div class="highlight">
<pre><span></span>ups = nyse[nyse.symbol=="UPS"]
print(ups.shape)
</pre></div>
<pre class="example">
(1762, 6)

</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org210002a">
<h3 id="org210002a">Shelter Outcomes</h3>
<div class="outline-text-3" id="text-org210002a">
<div class="highlight">
<pre><span></span>shelter_path = kaggle_path.joinpath(
    "austin-animal-center-shelter-outcomes/aac_shelter_outcomes.csv")
assert shelter_path.is_file()
shelter = pandas.read_csv(shelter_path, parse_dates=["datetime", "date_of_birth"])
</pre></div>
<div class="highlight">
<pre><span></span>shelter.info()
</pre></div>
<pre class="example">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 78256 entries, 0 to 78255
Data columns (total 12 columns):
age_upon_outcome    78248 non-null object
animal_id           78256 non-null object
animal_type         78256 non-null object
breed               78256 non-null object
color               78256 non-null object
date_of_birth       78256 non-null datetime64[ns]
datetime            78256 non-null datetime64[ns]
monthyear           78256 non-null object
name                54370 non-null object
outcome_subtype     35963 non-null object
outcome_type        78244 non-null object
sex_upon_outcome    78254 non-null object
dtypes: datetime64[ns](2), object(10)
memory usage: 7.2+ MB
</pre>
<p>Some of the columns are only identifiers (like a name) so we'll drop them to make it easier to inspect the data (although we aren't really going to do anything with it here anyway).</p>
<div class="highlight">
<pre><span></span>shelter = shelter[["outcome_type", "age_upon_outcome", "datetime",
                   "animal_type", "breed", "color", "sex_upon_outcome",
                   "date_of_birth"]]
print(table(shelter.head(), showindex=False))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">outcome_type</th>
<th class="org-left" scope="col">age_upon_outcome</th>
<th class="org-left" scope="col">datetime</th>
<th class="org-left" scope="col">animal_type</th>
<th class="org-left" scope="col">breed</th>
<th class="org-left" scope="col">color</th>
<th class="org-left" scope="col">sex_upon_outcome</th>
<th class="org-left" scope="col">date_of_birth</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Transfer</td>
<td class="org-left">2 weeks</td>
<td class="org-left">2014-07-22 16:04:00</td>
<td class="org-left">Cat</td>
<td class="org-left">Domestic Shorthair Mix</td>
<td class="org-left">Orange Tabby</td>
<td class="org-left">Intact Male</td>
<td class="org-left">2014-07-07 00:00:00</td>
</tr>
<tr>
<td class="org-left">Transfer</td>
<td class="org-left">1 year</td>
<td class="org-left">2013-11-07 11:47:00</td>
<td class="org-left">Dog</td>
<td class="org-left">Beagle Mix</td>
<td class="org-left">White/Brown</td>
<td class="org-left">Spayed Female</td>
<td class="org-left">2012-11-06 00:00:00</td>
</tr>
<tr>
<td class="org-left">Adoption</td>
<td class="org-left">1 year</td>
<td class="org-left">2014-06-03 14:20:00</td>
<td class="org-left">Dog</td>
<td class="org-left">Pit Bull</td>
<td class="org-left">Blue/White</td>
<td class="org-left">Neutered Male</td>
<td class="org-left">2013-03-31 00:00:00</td>
</tr>
<tr>
<td class="org-left">Transfer</td>
<td class="org-left">9 years</td>
<td class="org-left">2014-06-15 15:50:00</td>
<td class="org-left">Dog</td>
<td class="org-left">Miniature Schnauzer Mix</td>
<td class="org-left">White</td>
<td class="org-left">Neutered Male</td>
<td class="org-left">2005-06-02 00:00:00</td>
</tr>
<tr>
<td class="org-left">Euthanasia</td>
<td class="org-left">5 months</td>
<td class="org-left">2014-07-07 14:04:00</td>
<td class="org-left">Other</td>
<td class="org-left">Bat Mix</td>
<td class="org-left">Brown</td>
<td class="org-left">Unknown</td>
<td class="org-left">2014-01-07 00:00:00</td>
</tr>
</tbody>
</table>
<p>The notebook describes this as an example of a "weak" date case because the dates are only there for record-keeping and, while they might be significant for modeling, aren't acting as an index for the records.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org7a65e6f">
<h3 id="org7a65e6f">Cryptocurrency</h3>
<div class="outline-text-3" id="text-org7a65e6f">
<div class="highlight">
<pre><span></span>currency_path = kaggle_path.joinpath("all-crypto-currencies/crypto-markets.csv")
assert currency_path.is_file()
currency = pandas.read_csv(currency_path, parse_dates=["date"])
currency = currency.set_index("date")
</pre></div>
<div class="highlight">
<pre><span></span>print(table(currency.head(), showindex=True))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">date</th>
<th class="org-left" scope="col">slug</th>
<th class="org-left" scope="col">symbol</th>
<th class="org-left" scope="col">name</th>
<th class="org-right" scope="col">ranknow</th>
<th class="org-right" scope="col">open</th>
<th class="org-right" scope="col">high</th>
<th class="org-right" scope="col">low</th>
<th class="org-right" scope="col">close</th>
<th class="org-right" scope="col">volume</th>
<th class="org-right" scope="col">market</th>
<th class="org-right" scope="col">close_ratio</th>
<th class="org-right" scope="col">spread</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">2013-04-28 00:00:00</td>
<td class="org-left">bitcoin</td>
<td class="org-left">BTC</td>
<td class="org-left">Bitcoin</td>
<td class="org-right">1</td>
<td class="org-right">135.3</td>
<td class="org-right">135.98</td>
<td class="org-right">132.1</td>
<td class="org-right">134.21</td>
<td class="org-right">0</td>
<td class="org-right">1.48857e+09</td>
<td class="org-right">0.5438</td>
<td class="org-right">3.88</td>
</tr>
<tr>
<td class="org-left">2013-04-29 00:00:00</td>
<td class="org-left">bitcoin</td>
<td class="org-left">BTC</td>
<td class="org-left">Bitcoin</td>
<td class="org-right">1</td>
<td class="org-right">134.44</td>
<td class="org-right">147.49</td>
<td class="org-right">134</td>
<td class="org-right">144.54</td>
<td class="org-right">0</td>
<td class="org-right">1.60377e+09</td>
<td class="org-right">0.7813</td>
<td class="org-right">13.49</td>
</tr>
<tr>
<td class="org-left">2013-04-30 00:00:00</td>
<td class="org-left">bitcoin</td>
<td class="org-left">BTC</td>
<td class="org-left">Bitcoin</td>
<td class="org-right">1</td>
<td class="org-right">144</td>
<td class="org-right">146.93</td>
<td class="org-right">134.05</td>
<td class="org-right">139</td>
<td class="org-right">0</td>
<td class="org-right">1.54281e+09</td>
<td class="org-right">0.3843</td>
<td class="org-right">12.88</td>
</tr>
<tr>
<td class="org-left">2013-05-01 00:00:00</td>
<td class="org-left">bitcoin</td>
<td class="org-left">BTC</td>
<td class="org-left">Bitcoin</td>
<td class="org-right">1</td>
<td class="org-right">139</td>
<td class="org-right">139.89</td>
<td class="org-right">107.72</td>
<td class="org-right">116.99</td>
<td class="org-right">0</td>
<td class="org-right">1.29895e+09</td>
<td class="org-right">0.2882</td>
<td class="org-right">32.17</td>
</tr>
<tr>
<td class="org-left">2013-05-02 00:00:00</td>
<td class="org-left">bitcoin</td>
<td class="org-left">BTC</td>
<td class="org-left">Bitcoin</td>
<td class="org-right">1</td>
<td class="org-right">116.38</td>
<td class="org-right">125.6</td>
<td class="org-right">92.28</td>
<td class="org-right">105.21</td>
<td class="org-right">0</td>
<td class="org-right">1.16852e+09</td>
<td class="org-right">0.3881</td>
<td class="org-right">33.32</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgffe2e5a">
<h2 id="orgffe2e5a">Grouping</h2>
<div class="outline-text-2" id="text-orgffe2e5a"></div>
<div class="outline-3" id="outline-container-org1a73eaa">
<h3 id="org1a73eaa">Birth Dates</h3>
<div class="outline-text-3" id="text-org1a73eaa">
<p>Here's a plot of the birth dates of the animals in the shelter.</p>
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
figure.suptitle("Count of Births By Date", weight="bold")
axe.set_xlabel("Date of Birth")
births = shelter.date_of_birth.value_counts().sort_values().plot.line(ax=axe)
</pre></div>
<div class="figure">
<p><img alt="births.png" src="posts/tutorials/kaggle-on-time-series-visualization/births.png"></p>
</div>
<p>It lools like there was an upward trend until about 2016 when it started to taper off, but since we're counting by days there's a lot of variance so we're going to group the data using pandas' <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.resample.html">resample</a> method.</p>
<p>There's a couple of different ways to do this, but the simplest way is to take the count for each date using <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.value_counts.html">value_counts</a>. This will leave us with a <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.html">Series</a> with the dates in the index and the counts as values. Once we have this we can aggregate the dates by year and then count how many births there were per year.</p>
<div class="highlight">
<pre><span></span>counts = shelter.date_of_birth.value_counts()
print(table(counts.head().reset_index(), showindex=False))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">index</th>
<th class="org-right" scope="col">date_of_birth</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">2014-05-05 00:00:00</td>
<td class="org-right">112</td>
</tr>
<tr>
<td class="org-left">2015-09-01 00:00:00</td>
<td class="org-right">110</td>
</tr>
<tr>
<td class="org-left">2014-04-21 00:00:00</td>
<td class="org-right">105</td>
</tr>
<tr>
<td class="org-left">2015-04-28 00:00:00</td>
<td class="org-right">104</td>
</tr>
<tr>
<td class="org-left">2016-05-01 00:00:00</td>
<td class="org-right">102</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span>year_counts = counts.resample("Y")
print(year_counts)
</pre></div>
<pre class="example">
DatetimeIndexResampler [freq=&lt;YearEnd: month=12&gt;, axis=0, closed=right, label=right, convention=start, base=0]

</pre>
<p>Note that this is an aggregator, we don't get what we want until we call a method (like <code>count</code>) on it. In this case since we have value counts we want to sum all of the counts for a year (so we need <code>sum</code>).</p>
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
sums = year_counts.sum()
first = counts.index.min()
last = counts.index.max()
figure.suptitle("Births Per Year ({} - {})".format(first.year,
                                                   last.year),
                weight="bold")
axe.set_xlim((first, last))
peak = sums.idxmax()
axe.axvline(peak, color="r", linestyle=":", label=peak.year)

plotted = sums.plot.line(ax=axe, label="_")
axe.legend()
lim = axe.set_ylim(bottom=0)
</pre></div>
<div class="figure">
<p><img alt="births_by_year.png" src="posts/tutorials/kaggle-on-time-series-visualization/births_by_year.png"></p>
</div>
<p>An alternative way to look at this would be a lollipop plot.</p>
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
figure.suptitle("Births Per Year ({} - {})".format(first.year,
                                                   last.year),
                weight="bold")

x_labels = pandas.Series([x.year for x in sums.index])
peak_index = int(x_labels[x_labels==peak.year])
axe.axvline(peak_index, color="r", linestyle=":", label="{} (Peak Year)".format(peak.year))
stems = axe.stem(x_labels, sums)
axe.set_xlim(left=first.year)
figure.autofmt_xdate()
legend = axe.legend()
</pre></div>
<div class="figure">
<p><img alt="births_lollipop.png" src="posts/tutorials/kaggle-on-time-series-visualization/births_lollipop.png"></p>
</div>
<p>There's something funny going on with the dates, passing in the index instead of a list of years shifts all the years to the left by one (what's 2015 on the plot above would be 2016). I don't know what's doing this.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org9d45fdc">
<h3 id="org9d45fdc">Outcomes</h3>
<div class="outline-text-3" id="text-org9d45fdc">
<p>While knowing the birthdates of the animals in the shelter is interesting, what about the dates when their cases were resolved?</p>
<div class="highlight">
<pre><span></span>outcome_counts = shelter.datetime.value_counts()
outcomes = outcome_counts.resample("Y").sum()
print(table(outcome_counts.head().reset_index(), showindex=False))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">index</th>
<th class="org-right" scope="col">datetime</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">2016-04-18 00:00:00</td>
<td class="org-right">39</td>
</tr>
<tr>
<td class="org-left">2015-08-11 00:00:00</td>
<td class="org-right">25</td>
</tr>
<tr>
<td class="org-left">2017-10-17 00:00:00</td>
<td class="org-right">25</td>
</tr>
<tr>
<td class="org-left">2015-11-17 00:00:00</td>
<td class="org-right">22</td>
</tr>
<tr>
<td class="org-left">2015-07-02 00:00:00</td>
<td class="org-right">22</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
x_labels = pandas.Series([x.year for x in sums.index])
figure.suptitle("Outcomes Per Year", weight="bold")
stems = axe.stem(outcomes.index, outcomes, label="Outcome")
axe.plot(sums.index, sums, "r.", label="Births")
# axe.set_xticklabels(x_labels)
figure.autofmt_xdate()
legend = axe.legend()
</pre></div>
<div class="figure">
<p><img alt="outcomes.png" src="posts/tutorials/kaggle-on-time-series-visualization/outcomes.png"></p>
</div>
<p>So, I've re-introduced the messed up dates on the x-axis (I kind of tried to fix it but gave up), but, ignoring the actual years you can see that there are only six years of adoption outcomes although there are sixteen years of birth dates.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgde0c4e3">
<h3 id="orgde0c4e3">Trading Volume</h3>
<div class="outline-text-3" id="text-orgde0c4e3">
<p>The previous plot was a count-plot. You can also use other summary-statistics like a mean to see how things changed over time.</p>
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
volume = nyse.volume.resample("Y")
means = volume.mean()
figure.suptitle("Mean NYSE Trading Volume Per Year", weight="bold")
stem = axe.stem(means.index, means)
</pre></div>
<div class="figure">
<p><img alt="volume.png" src="posts/tutorials/kaggle-on-time-series-visualization/volume.png"></p>
</div>
<p>I tried putting standard deviations in there too but the values are so big it squashed the means.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org773c39d">
<h2 id="org773c39d">Lag Plots</h2>
<div class="outline-text-2" id="text-org773c39d">
<p>The <a href="https://pandas.pydata.org/pandas-docs/stable/visualization.html#lag-plot">Lag Plot</a> helps you check if there is a significance to the ordering of the data. You are plotting the value in the inputs vs the next value (e.g. one day against the following day). If there is no significance to the ordering then the plot will look random.</p>
</div>
<div class="outline-3" id="outline-container-org74c7c78">
<h3 id="org74c7c78">NYSE</h3>
<div class="outline-text-3" id="text-org74c7c78">
<div class="highlight">
<pre><span></span>volume = nyse.volume.resample("D")
</pre></div>
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
figure.suptitle("NYSE Volume Lag Plot", weight="bold")
subplot = lag_plot(volume.sum().tail(365), ax=axe)
</pre></div>
<div class="figure">
<p><img alt="lag_plot.png" src="posts/tutorials/kaggle-on-time-series-visualization/lag_plot.png"></p>
</div>
<p>So, the center points do seem to show a relationship, as the next-days volume goes up along with the previous day's volume, but I don't know what those bands around 0 are. One thing I noticed is that there are holidays in the data.</p>
<div class="highlight">
<pre><span></span>print(volume.sum().index[-6])
</pre></div>
<pre class="example">
2016-12-25 00:00:00

</pre>
<p>And there are also weekends in there.</p>
<div class="highlight">
<pre><span></span>print(volume.sum().index[-13].strftime("%a"))
</pre></div>
<pre class="example">
Sun

</pre>
<p>So it's likely that there are days in there where there was no trading and so they won't correlate with the days that preceded the start of a break or the ones that followed the end of a break. I think. I don't really know if there's trading all year round.</p>
<div class="highlight">
<pre><span></span>volume_sums = volume.sum()
for day in volume_sums[volume_sums==0][-9:].index:
    print("{} {}".format(day.strftime("%a"), day))
</pre></div>
<pre class="example">
Sat 2016-12-03 00:00:00
Sun 2016-12-04 00:00:00
Sat 2016-12-10 00:00:00
Sun 2016-12-11 00:00:00
Sat 2016-12-17 00:00:00
Sun 2016-12-18 00:00:00
Sat 2016-12-24 00:00:00
Sun 2016-12-25 00:00:00
Mon 2016-12-26 00:00:00

</pre>
<p>So it does look like the zeros are weekends and holidays.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org76330e0">
<h3 id="org76330e0">UPS</h3>
<div class="outline-text-3" id="text-org76330e0">
<p>Here's what just the UPS trading volumes look like.</p>
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
figure.suptitle("UPS Trading Volume Lag Plot", weight="bold")
subplot = lag_plot(ups.volume, ax=axe)
</pre></div>
<div class="figure">
<p><img alt="ups_lag_plot.png" src="posts/tutorials/kaggle-on-time-series-visualization/ups_lag_plot.png"></p>
</div>
<p>I don't know why but that makes it look better. I guess the market as a whole doesn't move quite so well together day by day as a single stock does.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org424c6a1">
<h2 id="org424c6a1">Autcorrelation Plot</h2>
<div class="outline-text-2" id="text-org424c6a1"></div>
<div class="outline-3" id="outline-container-org1ed9bb2">
<h3 id="org1ed9bb2">UPS</h3>
<div class="outline-text-3" id="text-org1ed9bb2">
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
figure.suptitle("UPS Trading Volume Daily Autocorrelation", weight="bold")
subplot = autocorrelation_plot(ups.volume, ax=axe)
</pre></div>
<div class="figure">
<p><img alt="autocorrelation.png" src="posts/tutorials/kaggle-on-time-series-visualization/autocorrelation.png"></p>
</div>
<p>This plot shows the lag in relationship to correlation over different lag intervals. It looks like up to about 500 days of lag the correlation is positive but it starts to become more negative after that. The horizontal lines are the confidence intervals - the solid grey lines are the 95 % interval and the dashed grey lines are the 99% interval. The points that fall outside of these intervals are statistically significant.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf6e7937">
<h2 id="orgf6e7937">Cryptocurrency</h2>
<div class="outline-text-2" id="text-orgf6e7937"></div>
<div class="outline-3" id="outline-container-org1b356de">
<h3 id="org1b356de">Lag Plot</h3>
<div class="outline-text-3" id="text-org1b356de">
<div class="highlight">
<pre><span></span>crypto_daily = currency.volume.resample("D")
figure, axe = pyplot.subplots()
figure.suptitle("Cryptocurrency Volume Lag Plot", weight="bold")
subplot = lag_plot(crypto_daily.sum(), ax=axe)
</pre></div>
<div class="figure">
<p><img alt="crypto_lag.png" src="posts/tutorials/kaggle-on-time-series-visualization/crypto_lag.png"></p>
</div>
<p>Unlike the stock-exchange, the cryptocurrencies seem to move together and don't take days off.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgbca338b">
<h3 id="orgbca338b">Autocorrelation Plot</h3>
<div class="outline-text-3" id="text-orgbca338b">
<div class="highlight">
<pre><span></span>figure, axe = pyplot.subplots()
figure.suptitle("Dogecoin Auto Correlation", weight="bold")
dogecoin = currency[currency.name=="Dogecoin"]
subplot = autocorrelation_plot(dogecoin.volume, ax=axe)
</pre></div>
<div class="figure">
<p><img alt="currency_autocorrelation.png" src="posts/tutorials/kaggle-on-time-series-visualization/currency_autocorrelation.png"></p>
</div>
<p>If my understanding of how this plot works is correct, there is some kind of significance to lags of 125 and 250 days. Is this really true? Possibly.</p>
</div>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="." rel="prev">Newer posts</a></li>
</ul>
<!--End of body content-->
<footer id="footer">Contents Â© 2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="assets/js/all-nocdn.js">
</script>
<script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
