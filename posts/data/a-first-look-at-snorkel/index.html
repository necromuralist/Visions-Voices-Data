<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Walking through the Snorkel Get Started tutorial." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>A First Look At Snorkel | Visions, Voices, Data</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/posts/data/a-first-look-at-snorkel/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script><!--
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"
</script>
-->
<script async src="../../../assets/javascript/p5.min.js" type="text/javascript"></script>
<meta content="Cloistered Monkey" name="author">
<link href="/posts/sql/sql-module-3/" rel="prev" title="SQL Module 3" type="text/html">
<link href="/posts/libraries/a-first-look-at-dabest/" rel="next" title="A First Look At DABEST" type="text/html">
<meta content="Visions, Voices, Data" property="og:site_name">
<meta content="A First Look At Snorkel" property="og:title">
<meta content="https://necromuralist.github.io/Visions-Voices-Data/posts/data/a-first-look-at-snorkel/" property="og:url">
<meta content="Walking through the Snorkel Get Started tutorial." property="og:description">
<meta content="article" property="og:type">
<meta content="2019-09-26T14:47:16-07:00" property="article:published_time">
<meta content="data" property="article:tag">
<meta content="labeling" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Give-The-Fish/">Give the Fish</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"> <input name="k8" type="hidden" value="#444444"> <input name="k9" type="hidden" value="#D51920"> <input name="kt" type="hidden" value="h"> <input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"> <input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="/posts/data/a-first-look-at-snorkel/index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="/posts/data/a-first-look-at-snorkel/">A First Look At Snorkel</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/data/a-first-look-at-snorkel/" rel="bookmark"><time class="published dt-published" datetime="2019-09-26T14:47:16-07:00" itemprop="datePublished" title="2019-09-26 14:47">2019-09-26 14:47</time></a></p>
<p class="sourceline"><a class="sourcelink" href="/posts/data/a-first-look-at-snorkel/index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="/posts/data/a-first-look-at-snorkel/#org2baa710">Beginning</a>
<ul>
<li><a href="/posts/data/a-first-look-at-snorkel/#org73b1a1d">Imports</a>
<ul>
<li><a href="/posts/data/a-first-look-at-snorkel/#org3e6e24a">Python</a></li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org9c2eec2">PyPi</a></li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org13a5856">Others</a></li>
</ul>
</li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org3a53973">Set Up</a>
<ul>
<li><a href="/posts/data/a-first-look-at-snorkel/#orgda78184">Some Constants</a></li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org3ceb267">The Plotting</a></li>
<li><a href="/posts/data/a-first-look-at-snorkel/#orga91a69e">The Data Set</a></li>
<li><a href="/posts/data/a-first-look-at-snorkel/#orga08630d">Rename the Columns</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org96a393f">Middle</a>
<ul>
<li><a href="/posts/data/a-first-look-at-snorkel/#orgde665aa">Setting Up the Training and Testing Sets</a></li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org9715293">Looking at the Data</a>
<ul>
<li><a href="/posts/data/a-first-look-at-snorkel/#orgc6a31b3">Spam and Ham</a></li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org9975cd2">The Dates</a></li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org3ca2a8c">Some Samples</a></li>
</ul>
</li>
<li><a href="/posts/data/a-first-look-at-snorkel/#org21ecd90">Labeling Functions</a></li>
</ul>
</li>
<li><a href="/posts/data/a-first-look-at-snorkel/#orgb558577">End</a>
<ul>
<li><a href="/posts/data/a-first-look-at-snorkel/#org968577c">Citations</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org2baa710">
<h2 id="org2baa710">Beginning</h2>
<div class="outline-text-2" id="text-org2baa710">
<p>This is a walk-through of Snorkel's <a href="https://www.snorkel.org/get-started/">Get Started</a> page.</p>
</div>
<div class="outline-3" id="outline-container-org73b1a1d">
<h3 id="org73b1a1d">Imports</h3>
<div class="outline-text-3" id="text-org73b1a1d"></div>
<div class="outline-4" id="outline-container-org3e6e24a">
<h4 id="org3e6e24a">Python</h4>
<div class="outline-text-4" id="text-org3e6e24a">
<div class="highlight">
<pre><span></span>from argparse import Namespace
from datetime import datetime
from functools import partial
from pathlib import Path
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9c2eec2">
<h4 id="org9c2eec2">PyPi</h4>
<div class="outline-text-4" id="text-org9c2eec2">
<div class="highlight">
<pre><span></span>from sklearn.model_selection import train_test_split
import hvplot.pandas
import pandas
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org13a5856">
<h4 id="org13a5856">Others</h4>
<div class="outline-text-4" id="text-org13a5856">
<div class="highlight">
<pre><span></span>from graeae import CountPercentage, EmbedHoloviews
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org3a53973">
<h3 id="org3a53973">Set Up</h3>
<div class="outline-text-3" id="text-org3a53973"></div>
<div class="outline-4" id="outline-container-orgda78184">
<h4 id="orgda78184">Some Constants</h4>
<div class="outline-text-4" id="text-orgda78184">
<p>There are two classes in the data set - <i>spam</i> and <i>not spam</i>, and for the labeling that we're going to do we also need a third value for the cases where the code can't give it a label.</p>
<div class="highlight">
<pre><span></span>classified_as = Namespace(
    not_spam = 0,
    spam = 1,
    unknown = -1,
)
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3ceb267">
<h4 id="org3ceb267">The Plotting</h4>
<div class="outline-text-4" id="text-org3ceb267">
<div class="highlight">
<pre><span></span>path = "../../files/posts/data/a-first-look-at-snorkel"
Embed = partial(EmbedHoloviews, folder_path=path)
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orga91a69e">
<h4 id="orga91a69e">The Data Set</h4>
<div class="outline-text-4" id="text-orga91a69e">
<p>This dataset is a set of comments taken from you-tube videos and hosted on <a href="http://www.dt.fee.unicamp.br/~tiago//youtubespamcollection/">this site</a>. The comments are for music videos by five artists.</p>
<div class="highlight">
<pre><span></span>path = Path("~/data/datasets/texts/you_tube_comments/").expanduser()
assert path.is_dir()

parts = []
for name in path.glob("*csv"):
    data = pandas.read_csv(name)    
    data["artist"] = name.name.split()[-1].split(".")[0]
    parts.append(data)

data = pandas.concat(parts)
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orga08630d">
<h4 id="orga08630d">Rename the Columns</h4>
<div class="outline-text-4" id="text-orga08630d">
<p>This just makes it easier for me since it matches my style.</p>
<div class="highlight">
<pre><span></span>Column = Namespace(
    comment_id = "comment_id",
    author = "author",
    datetime = "datetime",
    text = "text",
    label = "label",
    artist = "artist",
)
renames = {"COMMENT_ID": Column.comment_id,
           "AUTHOR": Column.author,
           "DATE": Column.datetime,
           "CONTENT": Column.text,
           "CLASS": Column.label}
data = data.rename(columns=renames)
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org96a393f">
<h2 id="org96a393f">Middle</h2>
<div class="outline-text-2" id="text-org96a393f"></div>
<div class="outline-3" id="outline-container-orgde665aa">
<h3 id="orgde665aa">Setting Up the Training and Testing Sets</h3>
<div class="outline-text-3" id="text-orgde665aa">
<div class="highlight">
<pre><span></span>x_train, x_test, y_train, y_test = train_test_split(data[Column.comment_id,
                                                         Column.author,
                                                         Column.datetime,
                                                         Column.text,
                                                         Column.artist],
                                                    data[Column.label],
                                                    test_size=0.2)
x_train, x_dev, y_train, y_dev = train_test_split(x_train, y_train,
                                                  test_size=0.1)
x_test, x_validation, y_test, y_validation = train_test_split(x_test, y_test,
                                                              test_size=0.1)

print(f"Training Size: {len(x_train):,}")
print(f"Development Size: {len(x_dev):,}")
print(f"Validation Size: {len(x_validation):,}")
print(f"Test Size: {len(x_test):,}")
</pre></div>
<pre class="example">
Training Size: 1,407
Development Size: 157
Validation Size: 40
Test Size: 352
</pre></div>
</div>
<div class="outline-3" id="outline-container-org9715293">
<h3 id="org9715293">Looking at the Data</h3>
<div class="outline-text-3" id="text-org9715293">
<div class="highlight">
<pre><span></span>print(x_dev.sample().iloc[0])
</pre></div>
<pre class="example">
If I get 100 subscribers, I will summon Freddy Mercury's ghost to whipe  from the face of earth One Direction and Miley Cirus.﻿
</pre>
<div class="highlight">
<pre><span></span>print(f"{len(data):,}")
</pre></div>
<pre class="example">
1,956
</pre></div>
<div class="outline-4" id="outline-container-orgc6a31b3">
<h4 id="orgc6a31b3">Spam and Ham</h4>
<div class="outline-text-4" id="text-orgc6a31b3">
<p>There are two classes in the dataset - SPAM (1) and not-spam (0), sometimes called HAM.</p>
<div class="highlight">
<pre><span></span>counter = CountPercentage(data.label)
counter()
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Value</th>
<th class="org-left" scope="col">Count</th>
<th class="org-right" scope="col">Percent (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">1,005</td>
<td class="org-right">51.38</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-left">951</td>
<td class="org-right">48.62</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span>grouped = data.groupby([Column.artist]).agg({Column.label: "sum", Column.comment_id: "count"}).reset_index().rename(
    columns={Column.label: "spam", Column.comment_id: "total"})
grouped["ham"] = grouped.total - grouped.spam
plotter = grouped[[Column.artist, "spam", "ham"]]
plot = plotter.hvplot.bar(x=Column.artist, stacked=True, legend=True,).opts(
    title="Spam Counts",
    width=1000, height=800)
Embed(plot=plot, file_name="spam_counts")()
</pre></div>
<object data="/posts/data/a-first-look-at-snorkel/spam_counts.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-4" id="outline-container-org9975cd2">
<h4 id="org9975cd2">The Dates</h4>
<div class="outline-text-4" id="text-org9975cd2">
<p>I'll look at when the comments were made, just to see.</p>
<div class="highlight">
<pre><span></span>print(len(data[data[Column.datetime].isna()]))
</pre></div>
<pre class="example">
245
</pre>
<div class="highlight">
<pre><span></span>with_date = data[~data[Column.datetime].isna()]
with_date.loc[:, Column.datetime] = pandas.to_datetime(with_date[Column.datetime])
</pre></div>
<div class="highlight">
<pre><span></span>with_date.loc[:, "Month"] = with_date[Column.datetime].apply(lambda date: datetime(date.year, date.month, 1))
group = with_date.groupby(["Month", Column.artist, Column.label]).agg(
    {Column.comment_id: "count"}).reset_index().rename(
        columns={Column.comment_id: "Count",
                 Column.artist: "Artist"})
</pre></div>
<div class="highlight">
<pre><span></span>spam = group[group[Column.label] == classified_as.spam]
ham = group[group[Column.label] == classified_as.not_spam]
spam_plot = spam.hvplot(x="Month", y="Count", by="Artist", label="Spam")
plot = spam_plot.opts(title="Monthly Spam By Artist", width=1000, height=800)
Embed(plot=plot, file_name="monthly_spam_by_artist")()
</pre></div>
<object data="/posts/data/a-first-look-at-snorkel/monthly_spam_by_artist.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-4" id="outline-container-org3ca2a8c">
<h4 id="org3ca2a8c">Some Samples</h4>
<div class="outline-text-4" id="text-org3ca2a8c"></div>
<ul class="org-ul">
<li><a id="orgfee00b0"></a>SPAM<br>
<div class="outline-text-5" id="text-orgfee00b0">
<div class="highlight">
<pre><span></span>spam = data[data[Column.label]==classified_as.spam].sample(5)
for index in range(len(spam)):
    print(f"({spam.iloc[index][Column.artist]}): {spam.iloc[index][Column.text]}")
</pre></div>
<pre class="example">
(Eminem): Do you need more instagram followers or photo likes? Check out IGBlast.com and get em in minutes!
(Eminem): Check out my channel im 15 year old rapper!
(Shakira): Part 5. Comforter of the afflicted, pray for us Help of Christians, pray for us Queen of Angels, pray for us Queen of Patriarchs, pray for us Queen of Prophets, pray for us Queen of Apostles, pray for us Queen of Martyrs, pray for us Queen of Confessors, pray for us Queen of Virgins, pray for us Queen of all Saints, pray for us Queen conceived without original sin, pray for us Queen of the most holy Rosary, pray for us Queen of the family, pray for us Queen of peace, pray for us 
(Eminem): Hey guys I&amp;#39;m 87 cypher im 11 years old and Rap is my life I recently made my second album desire ep . please take a moment to check out my album on YouTube thank you very much for reading every like comment and subscription counts
(Eminem): Check out this video on YouTube:﻿
</pre></div>
</li>
<li><a id="org122b732"></a>Ham<br>
<div class="outline-text-5" id="text-org122b732">
<div class="highlight">
<pre><span></span>ham = data[data[Column.label]==classified_as.not_spam].sample(5)
for index in range(len(ham)):
    print(f"({ham.iloc[index][Column.artist]}): {ham.iloc[index][Column.text]}")
</pre></div>
<pre class="example">
(Eminem): charlieee :DDDD (Those who saw Lost only will understand)﻿
(LMFAO): BEST PARTY SONG LITERALLY PARTY ROCK IS IN THE HOUSEE TONIGHT!!!!﻿
(LMFAO): I like how the robot shuffles he shuffles good﻿
(KatyPerry): ROAAAAARRRRRR 🐯🐯🐯﻿
(Shakira): like me﻿
</pre></div>
</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org21ecd90">
<h3 id="org21ecd90">Labeling Functions</h3>
</div>
</div>
<div class="outline-2" id="outline-container-orgb558577">
<h2 id="orgb558577">End</h2>
<div class="outline-text-2" id="text-orgb558577"></div>
<div class="outline-3" id="outline-container-org968577c">
<h3 id="org968577c">Citations</h3>
<div class="outline-text-3" id="text-org968577c">
<ul class="org-ul">
<li>Alberto, T.C., Lochter J.V., Almeida, T.A. TubeSpam: Comment Spam Filtering on YouTube. Proceedings of the 14th IEEE International Conference on Machine Learning and Applications (ICMLA'15), 1-6, Miami, FL, USA, December, 2015. (preprint)</li>
</ul>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="/categories/data/" rel="tag">data</a></li>
<li><a class="tag p-category" href="/categories/labeling/" rel="tag">labeling</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="/posts/sql/sql-module-3/" rel="prev" title="SQL Module 3">Previous post</a></li>
<li class="next"><a href="/posts/libraries/a-first-look-at-dabest/" rel="next" title="A First Look At DABEST">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2023 <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="/assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script> 
</body>
</html>
