<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>GeoPandas and Portland Neighborhoods | Visions, Voices, Data</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/posts/geopandas-and-portland-neighborhoods/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script><!--
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"
</script>
-->
<script async src="../../javascript/p5.min.js" type="text/javascript"></script>
<meta content="Cloistered Monkey" name="author">
<link href="/posts/looking-at-portland-crime-data/" rel="prev" title="Looking at Portland Crime Data" type="text/html">
<link href="/posts/nyc-with-geopandas/" rel="next" title="NYC With GeoPandas" type="text/html">
<meta content="Visions, Voices, Data" property="og:site_name">
<meta content="GeoPandas and Portland Neighborhoods" property="og:title">
<meta content="https://necromuralist.github.io/Visions-Voices-Data/posts/geopandas-and-portland-neighborhoods/" property="og:url">
<meta content="Table of Contents Prelude: The Lastest GeoPandas Debacle Beginning Imports Set Up Plotting Configurations The Neighborhoods Plot Try Altair Some Stuff To Check Out Portland Open Data Other" property="og:description">
<meta content="article" property="og:type">
<meta content="2021-12-29T12:57:26-08:00" property="article:published_time">
<meta content="geopandas" property="article:tag">
<meta content="maps" property="article:tag">
<meta content="portland" property="article:tag">
<meta content="visualization" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Give-The-Fish/">Give the Fish</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"> <input name="k8" type="hidden" value="#444444"> <input name="k9" type="hidden" value="#D51920"> <input name="kt" type="hidden" value="h"> <input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"> <input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="/posts/geopandas-and-portland-neighborhoods/index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="/posts/geopandas-and-portland-neighborhoods/">GeoPandas and Portland Neighborhoods</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/geopandas-and-portland-neighborhoods/" rel="bookmark"><time class="published dt-published" datetime="2021-12-29T12:57:26-08:00" itemprop="datePublished" title="2021-12-29 12:57">2021-12-29 12:57</time></a></p>
<p class="sourceline"><a class="sourcelink" href="/posts/geopandas-and-portland-neighborhoods/index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#orgc0a94d9">Prelude: The Lastest GeoPandas Debacle</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#orga7c815f">Beginning</a>
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org3a0ae8a">Imports</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org8b2aef7">Set Up</a>
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org7994486">Plotting</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org831160b">Configurations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#orgc0c1000">The Neighborhoods</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org6077eb0">Plot</a>
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org93dc578">Try Altair</a></li>
</ul>
</li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org900acdc">Some Stuff To Check Out</a>
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org09a6f45">Portland Open Data</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org06005a9">Other Interesting Sites</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgc0a94d9">
<h2 id="orgc0a94d9">Prelude: The Lastest GeoPandas Debacle</h2>
<div class="outline-text-2" id="text-orgc0a94d9">
<p>As I noted in a <a href="/posts/geopandas-revisited/">previous post</a> you can't just install <a href="https://geopandas.org/">geopandas</a> and <a href="https://geoviews.org/#">geoviews</a> you also need to install <a href="https://scitools.org.uk/cartopy/docs/v0.17/index.html">cartopy</a>, but <code>cartopy</code> <a href="https://github.com/SciTools/cartopy/issues/1879">currently requires version 8</a> of <a href="https://proj.org/">proj</a> while the stable versions of <code>debian</code> and <code>ubuntu</code> both have version 7.2. I originally tried to download the (unstable) <code>.deb</code> files and install them, but <code>libproj-dev</code> requires <code>libproj22</code> which requires a newer version of the C++ libraries than is currently in debian-stable… and at that point I decided to give up on it and run everything on <a href="https://wiki.debian.org/DebianBookworm">debian bookworm</a> (currently in testing) which has the newer versions of the stuff you need for cartopy.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orga7c815f">
<h2 id="orga7c815f">Beginning</h2>
<div class="outline-text-2" id="text-orga7c815f">
<p>This is going to be a simple plot of Portland neighborhods using GeoPandas/GeoJSON. I started doing this post to get Portland Crime Data mapped to the neighborhoods, which is what they (the Portland Police Bureau) uses, but it wasn't as straightforward as I though it'd be so I'm pulling it out here to see if I can keep it simpler for future reference.</p>
</div>
<div class="outline-3" id="outline-container-org3a0ae8a">
<h3 id="org3a0ae8a">Imports</h3>
<div class="outline-text-3" id="text-org3a0ae8a">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">geoviews</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org8b2aef7">
<h3 id="org8b2aef7">Set Up</h3>
<div class="outline-text-3" id="text-org8b2aef7"></div>
<div class="outline-4" id="outline-container-org7994486">
<h4 id="org7994486">Plotting</h4>
<div class="outline-text-4" id="text-org7994486">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"geopandas-and-portland-neighborhoods"</span>
<span class="n">OUTPUT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">OUTPUT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org831160b">
<h4 id="org831160b">Configurations</h4>
<div class="outline-text-4" id="text-org831160b">
<p>This holds were the data files are (or their URLs).</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"configurations/data.yaml"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">configuration</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">reader</span><span class="p">)[</span><span class="s2">"portland"</span><span class="p">][</span><span class="s2">"neighborhoods"</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgc0c1000">
<h2 id="orgc0c1000">The Neighborhoods</h2>
<div class="outline-text-2" id="text-orgc0c1000">
<p>Now we can load the data.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">configuration</span><span class="p">[</span><span class="s2">"folder"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">geojson_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="n">configuration</span><span class="p">[</span><span class="s2">"geojson"</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

<span class="k">if</span> <span class="n">geojson_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
    <span class="n">neighborhoods</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geojson_file</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">neighborhoods</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">configuration</span><span class="p">[</span><span class="s2">"geojson-url"</span><span class="p">])</span>
    <span class="n">neighborhoods</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">geojson_file</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">"GeoJSON"</span><span class="p">)</span>
</pre></div>
<p>Since I'm going to use the names of the neighborhoods I'll rename the column that holds them to something clearer (to me).</p>
<div class="highlight">
<pre><span></span><span class="n">neighborhoods</span> <span class="o">=</span> <span class="n">neighborhoods</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">MAPLABEL</span><span class="o">=</span><span class="s2">"Neighborhood"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org6077eb0">
<h2 id="org6077eb0">Plot</h2>
<div class="outline-text-2" id="text-org6077eb0">
<p>Now we'll do the actual plot.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">neighborhoods</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">hover_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">"Neighborhood"</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Portland Neighborhoods"</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">"hover"</span><span class="p">])</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"neighborhood_plot"</span><span class="p">)()</span>
</pre></div>
<object data="/posts/geopandas-and-portland-neighborhoods/neighborhood_plot.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
<div class="outline-3" id="outline-container-org93dc578">
<h3 id="org93dc578">Try Altair</h3>
<div class="outline-text-3" id="text-org93dc578">
<p>This was taken from <a href="https://stackoverflow.com/questions/55923300/how-can-i-make-a-map-using-geojson-data-in-altair">this Stack Overflow post</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">configuration</span><span class="p">[</span><span class="s2">"geojson-url"</span><span class="p">],</span>
                   <span class="nb">format</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">(</span><span class="nb">property</span><span class="o">=</span><span class="s2">"features"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"json"</span><span class="p">))</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">neighborhoods</span><span class="p">)</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Neighborhood:N"</span>
 <span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span> <span class="n">reflectY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
     <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
     <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
     <span class="n">title</span><span class="o">=</span><span class="s2">"Portland Neighborhoods (Altair)"</span><span class="p">,</span>
 <span class="p">)</span>

<span class="n">chart</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">OUTPUT</span><span class="o">/</span><span class="s2">"portland_neighborhoods_altair.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/geopandas-and-portland-neighborhoods/portland_neighborhoods_altair.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Looking at <a href="https://github.com/altair-viz/altair/issues/679">this bug report</a> for altair, it appears that vega-lite doesn't support an interactive map so it seems like it'd be better to stick with GeoPandas for now.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org900acdc">
<h2 id="org900acdc">Some Stuff To Check Out</h2>
<div class="outline-text-2" id="text-org900acdc">
<p>I ran into these while looking for the neighborhood data, maybe I'll check them out later.</p>
</div>
<div class="outline-3" id="outline-container-org09a6f45">
<h3 id="org09a6f45">Portland Open Data</h3>
<div class="outline-text-3" id="text-org09a6f45">
<p>To get the boundary information, click on the Boundaries Icon and find the dataset you want in the list that comes up. Once you're on the map, to get the dataset you need to click on a little bar at the bottom-left that says "I want to use this" which will change the user-interface. Click on the "View API Resources" tab and it will bring up two URLs, one of which is a GeoJSON link.</p>
<ul class="org-ul">
<li><a href="https://gis-pdx.opendata.arcgis.com/">Portland Open Data</a>: has the links to different map data.</li>
<li><a href="https://gis-pdx.opendata.arcgis.com/datasets/PDX::pbot-equity-index/about">Portland Equity Index</a>: Has census population, income, and ethnicity information. See the <code>configurations.yaml</code> file for some of the URLs I picked out.</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org06005a9">
<h3 id="org06005a9">Other Interesting Sites</h3>
<div class="outline-text-3" id="text-org06005a9">
<ul class="org-ul">
<li><a href="https://guides.library.pdx.edu/c.php?g=271294&amp;p=1811001">PSU Library's Page With Links</a> to Statistical and Census Data</li>
<li><a href="https://www.pdx.edu/population-research/census-data-oregon">PSU's Population Research Census Data</a></li>
</ul>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="/categories/geopandas/" rel="tag">geopandas</a></li>
<li><a class="tag p-category" href="/categories/maps/" rel="tag">maps</a></li>
<li><a class="tag p-category" href="/categories/portland/" rel="tag">portland</a></li>
<li><a class="tag p-category" href="/categories/visualization/" rel="tag">visualization</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="/posts/looking-at-portland-crime-data/" rel="prev" title="Looking at Portland Crime Data">Previous post</a></li>
<li class="next"><a href="/posts/nyc-with-geopandas/" rel="next" title="NYC With GeoPandas">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2023 <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="/assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script> 
</body>
</html>
