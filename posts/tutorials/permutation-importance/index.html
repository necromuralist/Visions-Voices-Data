<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Selecting features using Permutation Importance." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Permutation Importance | Visions, Voices, Data</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/posts/tutorials/permutation-importance/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script><!--
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"
</script>
-->
<script async src="../../../assets/javascript/p5.min.js" type="text/javascript"></script>
<meta content="Cloistered Monkey" name="author">
<link href="/posts/machine-learning/decision-trees/" rel="prev" title="Decision Trees" type="text/html">
<link href="/posts/tutorials/exercise-in-permutation-importance/" rel="next" title="Exercise in Permutation Importance" type="text/html">
<meta content="Visions, Voices, Data" property="og:site_name">
<meta content="Permutation Importance" property="og:title">
<meta content="https://necromuralist.github.io/Visions-Voices-Data/posts/tutorials/permutation-importance/" property="og:url">
<meta content="Selecting features using Permutation Importance." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-02-05T12:33:20-08:00" property="article:published_time">
<meta content="feature importance" property="article:tag">
<meta content="kaggle" property="article:tag">
<meta content="tutorial" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a> <a class="dropdown-item" href="/pages/giss/giss-yearly-anomalies-by-climate-zone">GISS Anomalies</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"> <input name="k8" type="hidden" value="#444444"> <input name="k9" type="hidden" value="#D51920"> <input name="kt" type="hidden" value="h"> <input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"> <input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="/posts/tutorials/permutation-importance/index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="/posts/tutorials/permutation-importance/">Permutation Importance</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/tutorials/permutation-importance/" rel="bookmark"><time class="published dt-published" datetime="2020-02-05T12:33:20-08:00" itemprop="datePublished" title="2020-02-05 12:33">2020-02-05 12:33</time></a></p>
<p class="sourceline"><a class="sourcelink" href="/posts/tutorials/permutation-importance/index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/tutorials/permutation-importance/#org5d0a2fd">Beginning</a>
<ul>
<li><a href="/posts/tutorials/permutation-importance/#org7411612">Imports</a>
<ul>
<li><a href="/posts/tutorials/permutation-importance/#orgb720784">Python</a></li>
<li><a href="/posts/tutorials/permutation-importance/#orgc481c09">PyPi</a></li>
<li><a href="/posts/tutorials/permutation-importance/#org39df39b">Others</a></li>
</ul>
</li>
<li><a href="/posts/tutorials/permutation-importance/#orgc3aa01f">Set Up</a>
<ul>
<li><a href="/posts/tutorials/permutation-importance/#orgf7d5bee">Plotting</a></li>
<li><a href="/posts/tutorials/permutation-importance/#org4474474">The Environment</a></li>
<li><a href="/posts/tutorials/permutation-importance/#org17323ac">The Table Printer</a></li>
<li><a href="/posts/tutorials/permutation-importance/#orga470fcf">The Data</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/tutorials/permutation-importance/#org68b48e4">Middle</a>
<ul>
<li><a href="/posts/tutorials/permutation-importance/#org9cc4004">Looking at the Dataset</a>
<ul>
<li><a href="/posts/tutorials/permutation-importance/#org982a168">The Target</a></li>
</ul>
</li>
<li><a href="/posts/tutorials/permutation-importance/#org8ffc5a2">The Features</a></li>
<li><a href="/posts/tutorials/permutation-importance/#org8e2457f">Build and Train the Model</a></li>
<li><a href="/posts/tutorials/permutation-importance/#org862ffa3">Permutation Importance</a>
<ul>
<li><a href="/posts/tutorials/permutation-importance/#org4fa8a31">Plotting the Importance</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/tutorials/permutation-importance/#org1ae7eee">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org5d0a2fd">
<h2 id="org5d0a2fd">Beginning</h2>
<div class="outline-text-2" id="text-org5d0a2fd">
<p>This is some notes on the kaggle tutorial on <a href="https://www.kaggle.com/dansbecker/permutation-importance">Permutation Importance</a>. <i>Permutation Importance</i> is a form of feature selection where you ask - <i>If you randomly shuffle the values one column in the dataset and leave the others in place, how does this affect the performance of the model?</i>. The idea is that if the column is important, then shuffling the values should make the model perform worse, so you can measure how much it degrades after you shuffle each column and figure out which columns are contributing to the model. Here's the rough process:</p>
<ol class="org-ol">
<li>Start with a trained model and a labeled dataset.</li>
<li>Shuffle a single column</li>
<li>Measure how much worse the model does predicting the target.</li>
<li>Restore the column and move on to the next column, repeating the steps until you have covered all the columns.</li>
</ol>
</div>
<div class="outline-3" id="outline-container-org7411612">
<h3 id="org7411612">Imports</h3>
<div class="outline-text-3" id="text-org7411612"></div>
<div class="outline-4" id="outline-container-orgb720784">
<h4 id="orgb720784">Python</h4>
<div class="outline-text-4" id="text-orgb720784">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc481c09">
<h4 id="orgc481c09">PyPi</h4>
<div class="outline-text-4" id="text-orgc481c09"></div>
<ul class="org-ul">
<li><a id="org744beb1"></a>eli5<br>
<div class="outline-text-5" id="text-org744beb1">
<p><a href="https://eli5.readthedocs.io/en/latest/">eli5</a> (which is presumably short for <a href="https://www.dictionary.com/e/slang/eli5/">explain it like I'm five</a>) is a library to help with machine learning model debugging and visualization. You can read about the PermutationImportance class <a href="https://eli5.readthedocs.io/en/latest/autodocs/sklearn.html#eli5.sklearn.permutation_importance.PermutationImportance">here</a>.</p>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">eli5.sklearn</span> <span class="kn">import</span> <span class="n">PermutationImportance</span>
<span class="kn">import</span> <span class="nn">eli5</span>
</pre></div>
</div>
</li>
<li><a id="orga823768"></a>sklearn<br>
<div class="outline-text-5" id="text-orga823768">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org39df39b">
<h4 id="org39df39b">Others</h4>
<div class="outline-text-4" id="text-org39df39b">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">CountPercentage</span><span class="p">,</span> <span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">EnvironmentLoader</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc3aa01f">
<h3 id="orgc3aa01f">Set Up</h3>
<div class="outline-text-3" id="text-orgc3aa01f"></div>
<div class="outline-4" id="outline-container-orgf7d5bee">
<h4 id="orgf7d5bee">Plotting</h4>
<div class="outline-text-4" id="text-orgf7d5bee">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"permutation-importance"</span>
<span class="n">PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"../../files/posts/tutorials/"</span><span class="p">)</span><span class="o">/</span><span class="n">SLUG</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org4474474">
<h4 id="org4474474">The Environment</h4>
<div class="outline-text-4" id="text-org4474474">
<div class="highlight">
<pre><span></span><span class="n">ENVIRONMENT</span> <span class="o">=</span> <span class="n">EnvironmentLoader</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org17323ac">
<h4 id="org17323ac">The Table Printer</h4>
<div class="outline-text-4" id="text-org17323ac">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orga470fcf">
<h4 id="orga470fcf">The Data</h4>
<div class="outline-text-4" id="text-orga470fcf">
<p>The dataset here is the <a href="https://www.kaggle.com/mathan/fifa-2018-match-statistics">Predict FIFA 2018 Man of the Match</a> dataset from kaggle.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">ENVIRONMENT</span><span class="p">[</span><span class="s2">"FIFA-2018"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org68b48e4">
<h2 id="org68b48e4">Middle</h2>
<div class="outline-text-2" id="text-org68b48e4"></div>
<div class="outline-3" id="outline-container-org9cc4004">
<h3 id="org9cc4004">Looking at the Dataset</h3>
<div class="outline-text-3" id="text-org9cc4004">
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"Column Value"</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column</th>
<th class="org-right" scope="col">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Date</td>
<td class="org-right">20-06-2018</td>
</tr>
<tr>
<td class="org-left">Team</td>
<td class="org-right">Uruguay</td>
</tr>
<tr>
<td class="org-left">Opponent</td>
<td class="org-right">Saudi Arabia</td>
</tr>
<tr>
<td class="org-left">Goal Scored</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Ball Possession %</td>
<td class="org-right">47</td>
</tr>
<tr>
<td class="org-left">Attempts</td>
<td class="org-right">13</td>
</tr>
<tr>
<td class="org-left">On-Target</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-left">Off-Target</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">Blocked</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Corners</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Offsides</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Free Kicks</td>
<td class="org-right">15</td>
</tr>
<tr>
<td class="org-left">Saves</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Pass Accuracy %</td>
<td class="org-right">88</td>
</tr>
<tr>
<td class="org-left">Passes</td>
<td class="org-right">521</td>
</tr>
<tr>
<td class="org-left">Distance Covered (Kms)</td>
<td class="org-right">101</td>
</tr>
<tr>
<td class="org-left">Fouls Committed</td>
<td class="org-right">10</td>
</tr>
<tr>
<td class="org-left">Yellow Card</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Yellow & Red</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Red</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Man of the Match</td>
<td class="org-right">Yes</td>
</tr>
<tr>
<td class="org-left">1st Goal</td>
<td class="org-right">23.0</td>
</tr>
<tr>
<td class="org-left">Round</td>
<td class="org-right">Group Stage</td>
</tr>
<tr>
<td class="org-left">PSO</td>
<td class="org-right">No</td>
</tr>
<tr>
<td class="org-left">Goals in PSO</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Own goals</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-left">Own goal Time</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
<p>#+end_example</p>
</div>
<div class="outline-4" id="outline-container-org982a168">
<h4 id="org982a168">The Target</h4>
<div class="outline-text-4" id="text-org982a168">
<p>The target is "Man of the Match".</p>
<div class="highlight">
<pre><span></span><span class="n">CountPercentage</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"Man of the Match"</span><span class="p">])()</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Value</th>
<th class="org-right" scope="col">Count</th>
<th class="org-right" scope="col">Percent (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">No</td>
<td class="org-right">64</td>
<td class="org-right">50.00</td>
</tr>
<tr>
<td class="org-left">Yes</td>
<td class="org-right">64</td>
<td class="org-right">50.00</td>
</tr>
</tbody>
</table>
<p>Not a particularly large dataset, but we aren't really interested in it per-se but rather how to use permutation importance with it.</p>
<p>We want it to be a True/False value rather than a string value so let's change it.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"Man of the Match"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"Man of the Match"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"Yes"</span>
<span class="n">CountPercentage</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"Man of the Match"</span><span class="p">])()</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Value</th>
<th class="org-right" scope="col">Count</th>
<th class="org-right" scope="col">Percent (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">True</td>
<td class="org-right">64</td>
<td class="org-right">50.00</td>
</tr>
<tr>
<td class="org-left">False</td>
<td class="org-right">64</td>
<td class="org-right">50.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org8ffc5a2">
<h3 id="org8ffc5a2">The Features</h3>
<div class="outline-text-3" id="text-org8ffc5a2">
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
<pre class="example">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 128 entries, 0 to 127
Data columns (total 27 columns):
Date                      128 non-null object
Team                      128 non-null object
Opponent                  128 non-null object
Goal Scored               128 non-null int64
Ball Possession %         128 non-null int64
Attempts                  128 non-null int64
On-Target                 128 non-null int64
Off-Target                128 non-null int64
Blocked                   128 non-null int64
Corners                   128 non-null int64
Offsides                  128 non-null int64
Free Kicks                128 non-null int64
Saves                     128 non-null int64
Pass Accuracy %           128 non-null int64
Passes                    128 non-null int64
Distance Covered (Kms)    128 non-null int64
Fouls Committed           128 non-null int64
Yellow Card               128 non-null int64
Yellow & Red              128 non-null int64
Red                       128 non-null int64
Man of the Match          128 non-null bool
1st Goal                  94 non-null float64
Round                     128 non-null object
PSO                       128 non-null object
Goals in PSO              128 non-null int64
Own goals                 12 non-null float64
Own goal Time             12 non-null float64
dtypes: bool(1), float64(3), int64(18), object(5)
memory usage: 26.2+ KB
None
</pre>
<p>As you can see there's both numeric and non-numeric columns. For illustration purposes let's use just the integer columns.</p>
<div class="highlight">
<pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">" * {column}"</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>

<span class="n">x_train</span><span class="p">,</span> <span class="n">x_validate</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_validate</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">"Man of the Match"</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
<pre class="example">
* Attempts
* Ball Possession %
* Blocked
* Corners
* Distance Covered (Kms)
* Fouls Committed
* Free Kicks
* Goal Scored
* Goals in PSO
* Off-Target
* Offsides
* On-Target
* Pass Accuracy %
* Passes
* Red
* Saves
* Yellow & Red
* Yellow Card
</pre></div>
</div>
<div class="outline-3" id="outline-container-org8e2457f">
<h3 id="org8e2457f">Build and Train the Model</h3>
<div class="outline-text-3" id="text-org8e2457f">
<div class="highlight">
<pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Training Accuracy: {model.score(x_train, y_train)}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Validation Accuracy: {model.score(x_validate, y_validate)}"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Training Accuracy: 1.0
Validation Accuracy: 0.6875
</pre>
<p>It didn't do particularly well on the validation set.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org862ffa3">
<h3 id="org862ffa3">Permutation Importance</h3>
<div class="outline-text-3" id="text-org862ffa3">
<p>As I noted previously, you can read about the <code>PermutationImportance</code> class <a href="https://eli5.readthedocs.io/en/latest/autodocs/sklearn.html#eli5.sklearn.permutation_importance.PermutationImportance">here</a>. If you read the documentation you'll see that you don't have to pass it a prefit model, and in some cases you don't want to but for our purposes we will.</p>
<div class="highlight">
<pre><span></span><span class="n">permutor</span> <span class="o">=</span> <span class="n">PermutationImportance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_validate</span><span class="p">,</span> <span class="n">y_validate</span><span class="p">)</span>
</pre></div>
<p>Now we can print out a table of the outcome.</p>
<div class="highlight">
<pre><span></span><span class="n">ipython_html</span> <span class="o">=</span> <span class="n">eli5</span><span class="o">.</span><span class="n">show_weights</span><span class="p">(</span><span class="n">permutor</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">x_validate</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">jupyter</span><span class="o">-</span><span class="n">python_html</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Weight</th>
<th class="org-left" scope="col">Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">0.1750 ± 0.0848</td>
<td class="org-left">Goal Scored</td>
</tr>
<tr>
<td class="org-left">0.0500 ± 0.0637</td>
<td class="org-left">Distance Covered (Kms)</td>
</tr>
<tr>
<td class="org-left">0.0437 ± 0.0637</td>
<td class="org-left">Yellow Card</td>
</tr>
<tr>
<td class="org-left">0.0187 ± 0.0500</td>
<td class="org-left">Off-Target</td>
</tr>
<tr>
<td class="org-left">0.0187 ± 0.0637</td>
<td class="org-left">Free Kicks</td>
</tr>
<tr>
<td class="org-left">0.0187 ± 0.0637</td>
<td class="org-left">Fouls Committed</td>
</tr>
<tr>
<td class="org-left">0.0125 ± 0.0637</td>
<td class="org-left">Pass Accuracy %</td>
</tr>
<tr>
<td class="org-left">0.0125 ± 0.0306</td>
<td class="org-left">Blocked</td>
</tr>
<tr>
<td class="org-left">0.0063 ± 0.0612</td>
<td class="org-left">Saves</td>
</tr>
<tr>
<td class="org-left">0.0063 ± 0.0250</td>
<td class="org-left">Ball Possession %</td>
</tr>
<tr>
<td class="org-left">0 ± 0.0000</td>
<td class="org-left">Red</td>
</tr>
<tr>
<td class="org-left">0 ± 0.0000</td>
<td class="org-left">Yellow & Red</td>
</tr>
<tr>
<td class="org-left">0.0000 ± 0.0559</td>
<td class="org-left">On-Target</td>
</tr>
<tr>
<td class="org-left">-0.0063 ± 0.0729</td>
<td class="org-left">Offsides</td>
</tr>
<tr>
<td class="org-left">-0.0063 ± 0.0919</td>
<td class="org-left">Corners</td>
</tr>
<tr>
<td class="org-left">-0.0063 ± 0.0250</td>
<td class="org-left">Goals in PSO</td>
</tr>
<tr>
<td class="org-left">-0.0187 ± 0.0306</td>
<td class="org-left">Attempts</td>
</tr>
<tr>
<td class="org-left">-0.0500 ± 0.0637</td>
<td class="org-left">Passes</td>
</tr>
</tbody>
</table>
<p>The table is ranked from most important feature to least important (based on the accuracy after shuffling the column). Anything with 0 or less essenttially contributed nothing to the model - although that doesn't mean that they might not be useful for more feature engineering.</p>
<p>The data is for the team as a whole, not an individual, so the "Man of the Match" column is telling you if any player on the team was awarded the "Budweiser Man of the Match".</p>
</div>
<div class="outline-4" id="outline-container-org4fa8a31">
<h4 id="org4fa8a31">Plotting the Importance</h4>
<div class="outline-text-4" id="text-org4fa8a31">
<p>The numbers are okay, but let's take a look at a plot of the weights.</p>
<div class="highlight">
<pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="s2">"weights"</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Feature"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"weights"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Permutation Importance (by Accuracy)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">xrotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"permutation_importance"</span><span class="p">)()</span>
</pre></div>
<object data="/posts/tutorials/permutation-importance/permutation_importance.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1ae7eee">
<h2 id="org1ae7eee">End</h2>
<div class="outline-text-2" id="text-org1ae7eee">
<p>So that's a quick look at getting a sense of the importance of a feature using <code>eli5</code> and permutation importance. There's a more in-depth look at it on their site, but next is another look at it with a different data set.</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="/categories/feature-importance/" rel="tag">feature importance</a></li>
<li><a class="tag p-category" href="/categories/kaggle/" rel="tag">kaggle</a></li>
<li><a class="tag p-category" href="/categories/tutorial/" rel="tag">tutorial</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="/posts/machine-learning/decision-trees/" rel="prev" title="Decision Trees">Previous post</a></li>
<li class="next"><a href="/posts/tutorials/exercise-in-permutation-importance/" rel="next" title="Exercise in Permutation Importance">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2020 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="/assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script> 
</body>
</html>
