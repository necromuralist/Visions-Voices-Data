<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="An introductiton to creating and manipulating graphs in networkx." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Company Movie Night | Visions, Voices, Data</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/posts/networks/company-moving-night/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<meta content="Cloistered Monkey" name="author">
<link href="../../libraries/prophet/getting-started-with-prophet/" rel="prev" title="Getting Started With Prophet" type="text/html">
<link href="../some-networkx-examples/" rel="next" title="Some Networkx Examples" type="text/html">
<meta content="Visions, Voices, Data" property="og:site_name">
<meta content="Company Movie Night" property="og:title">
<meta content="https://necromuralist.github.io/Visions-Voices-Data/posts/networks/company-moving-night/" property="og:url">
<meta content="An introductiton to creating and manipulating graphs in networkx." property="og:description">
<meta content="article" property="og:type">
<meta content="2019-04-11T13:04:23-07:00" property="article:published_time">
<meta content="networks" property="article:tag">
<meta content="networkx" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/Visions-Voices-Data/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a> <a class="dropdown-item" href="../../../pages/giss/giss-yearly-anomalies-by-climate-zone">GISS Anomalies</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"><input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Company Movie Night</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2019-04-11T13:04:23-07:00" itemprop="datePublished" title="2019-04-11 13:04">2019-04-11 13:04</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orge1aa908">The Departure</a>
<ul>
<li><a href="#org9e6f0b0">Imports</a></li>
<li><a href="#org56d4f3a">Set Up</a></li>
<li><a href="#orgfc9ce6f">The Plotting</a></li>
</ul>
</li>
<li><a href="#org139f799">The Initiation</a>
<ul>
<li><a href="#org60aaf34">The Data</a></li>
<li><a href="#org437cd95">Plot Graph</a></li>
<li><a href="#org0cd50e6">The Employee Movie Choices Graph</a></li>
<li><a href="#org834f7c4">Question 2</a></li>
<li><a href="#orgd8adb4a">Question 3</a></li>
<li><a href="#orgd1a39bc">Question 4</a></li>
</ul>
</li>
<li><a href="#org7f33992">The Return</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge1aa908">
<h2 id="orge1aa908">The Departure</h2>
<div class="outline-text-2" id="text-orge1aa908">
<p>This is a look at working with networks using <a href="https://networkx.github.io">networkx</a>. Our scene - eight employees are trying to choose three movies to watch. We have two sources of data - the candidate movies and the <i>relationship</i> between pairs of employees. The relationships are on a scale from -100 to 100, with -100 being the strongest of enemies and 100 meaning they are best of friends. Zero either means they have no relationship (don't interact) or are indifferent about the other person.</p>
</div>
<div class="outline-3" id="outline-container-org9e6f0b0">
<h3 id="org9e6f0b0">Imports</h3>
<div class="outline-text-3" id="text-org9e6f0b0"></div>
<div class="outline-4" id="outline-container-org1abe5f0">
<h4 id="org1abe5f0">From Python</h4>
<div class="outline-text-4" id="text-org1abe5f0">
<div class="highlight">
<pre><span></span>from functools import partial
from pathlib import Path
import os
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org03e8981">
<h4 id="org03e8981">From PyPi</h4>
<div class="outline-text-4" id="text-org03e8981">
<div class="highlight">
<pre><span></span>from dotenv import load_dotenv
from bokeh.models import HoverTool
import holoviews
import hvplot.pandas
import networkx
import pandas
import numpy
from networkx.algorithms import bipartite
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3232c7b">
<h4 id="org3232c7b">My Stuff</h4>
<div class="outline-text-4" id="text-org3232c7b">
<div class="highlight">
<pre><span></span>from graeae.visualization import EmbedHoloview
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org56d4f3a">
<h3 id="org56d4f3a">Set Up</h3>
<div class="outline-text-3" id="text-org56d4f3a"></div>
<div class="outline-4" id="outline-container-orgb3c6ac1">
<h4 id="orgb3c6ac1">Load Dotenv</h4>
<div class="outline-text-4" id="text-orgb3c6ac1">
<div class="highlight">
<pre><span></span>load_dotenv(".env", override=True)
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgfc9ce6f">
<h3 id="orgfc9ce6f">The Plotting</h3>
<div class="outline-text-3" id="text-orgfc9ce6f">
<div class="highlight">
<pre><span></span>SLUG = 'company-movie-night'
OUTPUT = Path("../../files/posts/networks/" + SLUG)
Embed = partial(EmbedHoloview, folder_path=OUTPUT)
holoviews.extension("bokeh")
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org139f799">
<h2 id="org139f799">The Initiation</h2>
<div class="outline-text-2" id="text-org139f799"></div>
<div class="outline-3" id="outline-container-org60aaf34">
<h3 id="org60aaf34">The Data</h3>
<div class="outline-text-3" id="text-org60aaf34"></div>
<div class="outline-4" id="outline-container-org7730834">
<h4 id="org7730834">This Is the Set Of Employee-Relationships</h4>
<div class="outline-text-4" id="text-org7730834">
<div class="highlight">
<pre><span></span>employee_relationships_path = Path(os.environ.get("EMPLOYEE_RELATIONSHIPS"))
relationships_data = pandas.read_csv(
    employee_relationships_path, 
    delimiter="\t", 
    header=None,
    names="employee_1 employee_2 relationship".split())
</pre></div>
<div class="highlight">
<pre><span></span>table = holoviews.Table(relationships_data)
Embed(plot=table, file_name="relationships_data")()
</pre></div>
<object data="relationships_data.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span>employees = set(relationships_data.employee_1.unique()) | set(relationships_data.employee_2.unique())
print(employees)
</pre></div>
<pre class="example">
{'Claude', 'Pablo', 'Lee', 'Andy', 'Vincent', 'Joan', 'Frida', 'Georgia'}

</pre>
<div class="highlight">
<pre><span></span>print(len(employees))
</pre></div>
<pre class="example">
8

</pre>
<div class="highlight">
<pre><span></span>print(len(relationships_data))
</pre></div>
<pre class="example">
28

</pre>
<p>We have eight employees and twenty-eight links. Is this a fully connected graph? The handshake problem says that the amount of links in a fully-connected network is:</p>
<p>\[ links = \frac{n(n-1)}{2} \]</p>
<div class="highlight">
<pre><span></span>print(len(employees) * (len(employees) - 1)/2)
</pre></div>
<pre class="example">
28.0

</pre>
<p>It looks like our relationships data creates a fully-connected network (unless there is a duplicate which would be an error).</p>
</div>
</div>
<div class="outline-4" id="outline-container-org653b217">
<h4 id="org653b217">This Is the Movie Choices</h4>
<div class="outline-text-4" id="text-org653b217">
<div class="highlight">
<pre><span></span>employee_movies_path = Path(os.environ.get("EMPLOYEE_MOVIE_CHOICES"))
movies_data = pandas.read_csv(
    employee_movies_path, 
    delimiter="\t", 
    header=None,
    skiprows=1,
    names="employee movie".split())
print(movies_data.head())
</pre></div>
<pre class="example">
  employee                            movie
0     Andy                         Anaconda
1     Andy                       Mean Girls
2     Andy                       The Matrix
3   Claude                         Anaconda
4   Claude  Monty Python and the Holy Grail

</pre>
<div class="highlight">
<pre><span></span>movies = set(movies_data.movie.unique())
print(movies)
print(len(movies))
</pre></div>
<p>The eight employees chose 11 movies between them.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org437cd95">
<h3 id="org437cd95">Plot Graph</h3>
<div class="outline-text-3" id="text-org437cd95">
<p>You can use the following function to plot graphs.</p>
<div class="highlight">
<pre><span></span>def plot_graph(graph, file_name, plot_title, weight_name=None, directed=False):
    """Plots an interactive graph using the spring-layout

    Args:
     graph: a networkx graph
     file_name: name to store the plot (without extension)
     plot_title: name to give the plot
     weight_name: name of the attribute for plotting edge weights (if G is weighted)
     directed: whether it is a directed graph
    """
    plot = holoviews.Graph.from_networkx(graph,
                                         networkx.spring_layout).opts(
                                             cmap="Set1",                                             
                                             fontsize=Plot.fontsize,
                                             width=Plot.width,
                                             height=Plot.height,
                                             edge_line_color=Plot.edge_color,
                                             title=plot_title,
                                             xaxis=None, yaxis=None, directed=directed)
    Embed(plot=plot, file_name=file_name)()
    return
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org0cd50e6">
<h3 id="org0cd50e6">The Employee Movie Choices Graph</h3>
<div class="outline-text-3" id="text-org0cd50e6">
<p>The employee-movie network consists of employees and movies as nodes and the edges indicate an employee chose a movie. Not every movie is chosen by every employee, so it isn't a complete graph.</p>
<div class="highlight">
<pre><span></span>expected_edges = len(movies_data)
expected_nodes = len(employees) + len(movies)
print("Expected Edges: {}".format(expected_edges))
print("Expected Nodes: {}".format(expected_nodes))
</pre></div>
<pre class="example">
Expected Edges: 24
Expected Nodes: 19

</pre>
<div class="highlight">
<pre><span></span>plot = holoviews.Graph.from_networkx(friendship_graph,
                                     networkx.circular_layout).opts(
                                         node_color=dim("gender"), cmap="Set1",
                                         tools=[hover],
                                         fontsize=Plot.fontsize,
                                         width=800,
                                         height=800,
                                         edge_line_color=Plot.edge_color,
                                         title="Friendship Network by Gender",
                                         xaxis=None, yaxis=None, directed=True)
Embed(plot=plot, file_name="employee_movie_choices_plot")()
</pre></div>
<div class="highlight">
<pre><span></span>def answer_one():
    """Loads the Employee Movie Choices

    Returns:
     Graph: graph with movie and employees as nodes
    """
    movie_choices = pandas.read_table('Employee_Movie_Choices.txt')
    movie_choices = networkx.from_pandas_dataframe(movie_choices, "#Employee", "Movie")
    return movie_choices
</pre></div>
<div class="highlight">
<pre><span></span>movie_choices = answer_one()
edges = movie_choices.edges()
assert len(edges) == 24
assert len(movie_choices.nodes()) == 19
assert networkx.is_bipartite(movie_choices)
positions = networkx.spring_layout(movie_choices)

networkx.draw_networkx(movie_choices, positions, edges=edges)
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org834f7c4">
<h3 id="org834f7c4">Question 2</h3>
<div class="outline-text-3" id="text-org834f7c4">
<p>Using the graph from the previous question, add nodes attributes named `'type'` where movies have the value `'movie'` and employees have the value `'employee'` and return that graph.</p>
<p><b>This function should return a networkx graph with node attributes `{'type': 'movie'}` or `{'type': 'employee'}`</b></p>
<div class="highlight">
<pre><span></span>def answer_two():
    """Adds 'type' to nodes from movie-graph

    Returns:
     Graph: answer_one with 'type' attribute added (employee or movie)
    """
    graph = answer_one()
    new_graph = networkx.Graph()
    nodes = graph.nodes()
    employee_nodes = [node for node in nodes if node in employees]
    movie_nodes = [node for node in nodes if node in movies]
    new_graph.add_nodes_from(employee_nodes, bipartite=0, type='employee')
    new_graph.add_nodes_from(movie_nodes, bipartite=1, type="movie")
    new_graph.add_edges_from(graph.edges())
    return new_graph
</pre></div>
<div class="highlight">
<pre><span></span>two = answer_two()
two.nodes(data=True)
</pre></div>
<div class="highlight">
<pre><span></span>plot_graph(two)
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd8adb4a">
<h3 id="orgd8adb4a">Question 3</h3>
<div class="outline-text-3" id="text-orgd8adb4a">
<p>Find a weighted projection of the graph from `answer<sub>two</sub>` which tells us how many movies different pairs of employees have in common.</p>
<p><b>This function should return a weighted projected graph.</b></p>
<div class="highlight">
<pre><span></span>def answer_three():
    graph = answer_two()
    assert networkx.is_bipartite(graph)
    return bipartite.weighted_projected_graph(graph, employees)
</pre></div>
<div class="highlight">
<pre><span></span>three = answer_three()
plot_graph(three)
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd1a39bc">
<h3 id="orgd1a39bc">Question 4</h3>
<div class="outline-text-3" id="text-orgd1a39bc">
<p>Suppose you'd like to find out if people that have a high relationship score also like the same types of movies.</p>
<p>Find the Pearson correlation ( using `DataFrame.corr()` ) between employee relationship scores and the number of movies they have in common. If two employees have no movies in common it should be treated as a 0, not a missing value, and should be included in the correlation calculation.</p>
<p><b>This function should return a float.</b></p>
<div class="highlight">
<pre><span></span>def answer_four():
    """calculates the pearson correlation for data

    Returns:
     float: Pearson correlation for weight and relationship_score
    """
    three = answer_three()
    relationships = pandas.read_table(
        "Employee_Relationships.txt",
        names="employee_left employee_right relationship_score".split())
    relationships["employees"] = relationships.apply(
        lambda row: tuple(sorted((row["employee_left"],
                                  row['employee_right']))), axis=1)

    weights = pandas.DataFrame(
        three.edges(data=True),
        columns="employee_left employee_right weight".split())
    weights["weight"] = weights.weight.map(lambda row: row["weight"])
    weights["employees"] = weights.apply(lambda row: tuple(sorted(
        (row["employee_left"],
         row["employee_right"]))),
                                         axis=1)

    joined = pandas.merge(relationships, weights, how="outer", 
                          on=['employees'])
    assert len(joined) == len(relationships)
    joined['weight'] = joined["weight"].fillna(0)

    data = joined[["relationship_score", "weight"]]
    correlation = data.corr()
    return correlation.relationship_score.weight
</pre></div>
<div class="highlight">
<pre><span></span>print(answer_four())
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org7f33992">
<h2 id="org7f33992">The Return</h2>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/networks/" rel="tag">networks</a></li>
<li><a class="tag p-category" href="../../../categories/networkx/" rel="tag">networkx</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../../libraries/prophet/getting-started-with-prophet/" rel="prev" title="Getting Started With Prophet">Previous post</a></li>
<li class="next"><a href="../some-networkx-examples/" rel="next" title="Some Networkx Examples">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js">
</script><!-- fancy dates -->
<script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
</script><!-- end fancy dates -->
<script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
