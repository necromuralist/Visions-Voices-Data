<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Selecting a Dataset subset." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Selecting Tabular Data | Visions, Voices, Data</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/selecting-tabular-data/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<meta content="Cloistered Monkey" name="author">
<link href="../holoviews-tabular-data-take-two/" rel="prev" title="HoloViews Tabular Data Take Two" type="text/html">
<link href="../aggregating-tabular-data/" rel="next" title="Aggregating Tabular Data" type="text/html">
<meta content="Visions, Voices, Data" property="og:site_name">
<meta content="Selecting Tabular Data" property="og:title">
<meta content="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/selecting-tabular-data/" property="og:url">
<meta content="Selecting a Dataset subset." property="og:description">
<meta content="article" property="og:type">
<meta content="2019-03-02T16:25:15-08:00" property="article:published_time">
<meta content="example" property="article:tag">
<meta content="holoviews" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/Visions-Voices-Data/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a> <a class="dropdown-item" href="../../../pages/giss/giss-yearly-anomalies-by-climate-zone">GISS Anomalies</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"><input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Selecting Tabular Data</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2019-03-02T16:25:15-08:00" itemprop="datePublished" title="2019-03-02 16:25">2019-03-02 16:25</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf47ec95">Set Up</a>
<ul>
<li><a href="#org96b77a3">Imports</a></li>
<li><a href="#orgce571a7">Holoviews Bokeh</a></li>
<li><a href="#org54d566c">The Embedder</a></li>
<li><a href="#org1db1398">Dotenv</a></li>
</ul>
</li>
<li><a href="#org1edcfef">Load the Data</a></li>
<li><a href="#orgf51fb17">Convert the DataFrame to a Dataset</a></li>
<li><a href="#orgf5ba30e">Aggregate The Data</a></li>
<li><a href="#orgbb41cbd">Plot a Subset</a></li>
<li><a href="#orgfbb53b7">Facets</a></li>
<li><a href="#orgef9add6">Overlays</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgf47ec95">
<h2 id="orgf47ec95">Set Up</h2>
<div class="outline-text-2" id="text-orgf47ec95"></div>
<div class="outline-3" id="outline-container-org96b77a3">
<h3 id="org96b77a3">Imports</h3>
<div class="outline-text-3" id="text-org96b77a3"></div>
<div class="outline-4" id="outline-container-orgb0a4ebb">
<h4 id="orgb0a4ebb">Python</h4>
<div class="outline-text-4" id="text-orgb0a4ebb">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf4e0b45">
<h4 id="orgf4e0b45">PyPi</h4>
<div class="outline-text-4" id="text-orgf4e0b45">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">holoviews</span> <span class="kn">import</span> <span class="n">opts</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgd25891e">
<h4 id="orgd25891e">My Projects</h4>
<div class="outline-text-4" id="text-orgd25891e">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bartleby_the_penguin.tangles.embed_bokeh</span> <span class="kn">import</span> <span class="n">EmbedBokeh</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgce571a7">
<h3 id="orgce571a7">Holoviews Bokeh</h3>
<div class="outline-text-3" id="text-orgce571a7">
<p>I don't know why but you have to specify that you're using <code>bokeh</code>, even though it looks like it's working when you don't.</p>
<div class="highlight">
<pre><span></span><span class="n">holoviews</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="s2">"bokeh"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org54d566c">
<h3 id="org54d566c">The Embedder</h3>
<div class="outline-text-3" id="text-org54d566c">
<div class="highlight">
<pre><span></span><span class="n">files_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"../../files/posts/libraries/selecting-tabular-data/"</span><span class="p">)</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">EmbedBokeh</span><span class="p">,</span>
    <span class="n">folder_path</span><span class="o">=</span><span class="n">files_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org1db1398">
<h3 id="org1db1398">Dotenv</h3>
<div class="outline-text-3" id="text-org1db1398">
<p>I have the path to the data-set in a <code>.env</code> file so I'll load it into the environment dictionary.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">".env"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1edcfef">
<h2 id="org1edcfef">Load the Data</h2>
<div class="outline-text-2" id="text-org1edcfef">
<p>This is the same measles/pertusis data that I used before.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"DISEASES"</span><span class="p">))</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">diseases</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">orgtable</span><span class="p">(</span><span class="n">diseases</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Year</th>
<th class="org-right" scope="col">Week</th>
<th class="org-left" scope="col">State</th>
<th class="org-right" scope="col">measles</th>
<th class="org-right" scope="col">pertussis</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1928</td>
<td class="org-right">1</td>
<td class="org-left">Alabama</td>
<td class="org-right">3.67</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">2</td>
<td class="org-left">Alabama</td>
<td class="org-right">6.25</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">3</td>
<td class="org-left">Alabama</td>
<td class="org-right">7.95</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">4</td>
<td class="org-left">Alabama</td>
<td class="org-right">12.58</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">5</td>
<td class="org-left">Alabama</td>
<td class="org-right">8.03</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-2" id="outline-container-orgf51fb17">
<h2 id="orgf51fb17">Convert the DataFrame to a Dataset</h2>
<div class="outline-text-2" id="text-orgf51fb17">
<div class="highlight">
<pre><span></span><span class="n">key_dimensions</span> <span class="o">=</span> <span class="s2">"Year State"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">value_dimensions</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">"measles"</span><span class="p">,</span> <span class="s2">"Measles Incidence"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"pertussis"</span><span class="p">,</span> <span class="s2">"Pertusis Incidence"</span><span class="p">)]</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">diseases</span><span class="p">,</span> <span class="n">key_dimensions</span><span class="p">,</span> <span class="n">value_dimensions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf5ba30e">
<h2 id="orgf5ba30e">Aggregate The Data</h2>
<div class="outline-text-2" id="text-orgf5ba30e">
<div class="highlight">
<pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
:Dataset   [Year,State]   (measles,pertussis)
(4284, 4)

</pre></div>
</div>
<div class="outline-2" id="outline-container-orgbb41cbd">
<h2 id="orgbb41cbd">Plot a Subset</h2>
<div class="outline-text-2" id="text-orgbb41cbd">
<div class="highlight">
<pre><span></span><span class="n">northwest</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Oregon"</span><span class="p">,</span> <span class="s2">"Washington"</span><span class="p">,</span> <span class="s2">"Idaho"</span><span class="p">]</span>
<span class="n">bars</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">State</span><span class="o">=</span><span class="n">northwest</span><span class="p">,</span> <span class="n">Year</span><span class="o">=</span><span class="p">(</span><span class="mi">1928</span><span class="p">,</span> <span class="mi">1938</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
    <span class="n">holoviews</span><span class="o">.</span><span class="n">Bars</span><span class="p">,</span> <span class="p">[</span><span class="s2">"Year"</span><span class="p">,</span> <span class="s2">"State"</span><span class="p">],</span> <span class="s2">"measles"</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">bars</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">Bars</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">"hover"</span><span class="p">],</span> <span class="n">xrotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s2">"northwest_measles"</span><span class="p">)()</span>
</pre></div>
<script id="9711b5b4-83ef-4e9e-b406-5fe3859f6bf3" src="northwest_measles.js">
</script>
<p>As with all things HoloViews, there are many things that are unclear here - but the one that really tripped me up was the selection of years. Although I passed in a tuple it used it as a range (start, stop) so my original plot had a century instead of two years. Oh, well.</p>
<p>Interesting how Oregon spiked up in 1935 and 1936 then dropped down in 1937. According to <a href="https://www.cdc.gov/measles/about/history.html">the CDC</a>, the measles vaccine didn't come out until 1963, so I guess those ebb-and-flows are just the normal way diseases cycle through populations. Oregon and Washington probably had more immigrants than Idaho, as well as higher population densities in their main cities, which might account for their higher rates. Hard to say without corellating data.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgfbb53b7">
<h2 id="orgfbb53b7">Facets</h2>
<div class="outline-text-2" id="text-orgfbb53b7">
<p>The bar-plot is okay for comparing the cities within any given year but they are hard to get trends from. Here's how to use selecting to plot lines for each city.</p>
<div class="highlight">
<pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">State</span><span class="o">=</span><span class="n">northwest</span><span class="p">,</span> <span class="n">Year</span><span class="o">=</span><span class="p">(</span><span class="mi">1928</span><span class="p">,</span> <span class="mi">2011</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">holoviews</span><span class="o">.</span><span class="n">Curve</span><span class="p">,</span> <span class="s2">"Year"</span><span class="p">,</span> <span class="s2">"measles"</span><span class="p">)</span>
<span class="n">gridspace</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s2">"State"</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">gridspace</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">"hover"</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s2">"northwest_measles_grid"</span><span class="p">)()</span>
</pre></div>
<script id="e0183ad8-47df-4d67-befe-c2c4ba24e369" src="northwest_measles_grid.js">
</script></div>
</div>
<div class="outline-2" id="outline-container-orgef9add6">
<h2 id="orgef9add6">Overlays</h2>
<div class="outline-text-2" id="text-orgef9add6">
<p>While the side-by-side plots are clearer than the bar-plots, it's harder to compare the cities year-by-year, so it might be better to plot them over each other.</p>
<div class="highlight">
<pre><span></span><span class="n">overlay</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="s2">"State"</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">holoviews</span><span class="o">.</span><span class="n">Cycle</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">"crimson"</span><span class="p">,</span> <span class="s2">"slateblue"</span><span class="p">,</span> <span class="s2">"cadetblue"</span><span class="p">]))</span>
<span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s2">"northwest_measles_overlay"</span><span class="p">)()</span>
</pre></div>
<script id="a78fd3e5-9234-410a-b6f3-267875eab6aa" src="northwest_measles_overlay.js">
</script></div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/example/" rel="tag">example</a></li>
<li><a class="tag p-category" href="../../../categories/holoviews/" rel="tag">holoviews</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../holoviews-tabular-data-take-two/" rel="prev" title="HoloViews Tabular Data Take Two">Previous post</a></li>
<li class="next"><a href="../aggregating-tabular-data/" rel="next" title="Aggregating Tabular Data">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js">
</script>
<script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
