<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Copying the PyViz Workflow example." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Walking Through the Pyviz Workflow Example | Visions, Voices, Data</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<meta content="Cloistered Monkey" name="author">
<link href="../../giss/giss-zone-anomalies/" rel="prev" title="GISS Zone Anomalies" type="text/html">
<meta content="Visions, Voices, Data" property="og:site_name">
<meta content="Walking Through the Pyviz Workflow Example" property="og:title">
<meta content="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/" property="og:url">
<meta content="Copying the PyViz Workflow example." property="og:description">
<meta content="article" property="og:type">
<meta content="2019-03-14T12:48:04-07:00" property="article:published_time">
<meta content="pyviz" property="article:tag">
<meta content="tutorial" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/Visions-Voices-Data/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"><input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Walking Through the Pyviz Workflow Example</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2019-03-14T12:48:04-07:00" itemprop="datePublished" title="2019-03-14 12:48">2019-03-14 12:48</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgbb0c300">Beginning</a>
<ul>
<li><a href="#orgb1b5cf8">Set Up</a></li>
</ul>
</li>
<li><a href="#orgb09cf35">Middle</a>
<ul>
<li><a href="#org0a5d50a">Looking at Measles</a></li>
<li><a href="#org3d89007">Bar Chart</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgbb0c300">
<h2 id="orgbb0c300">Beginning</h2>
<div class="outline-text-2" id="text-orgbb0c300">
<p>This is a replication of (most of) the <a href="http://pyviz.org/tutorial/01_Workflow_Introduction.html">pyviz workflow introduction</a> to see if I can replicate it. Nothing new here.</p>
</div>
<div class="outline-3" id="outline-container-orgb1b5cf8">
<h3 id="orgb1b5cf8">Set Up</h3>
<div class="outline-text-3" id="text-orgb1b5cf8"></div>
<div class="outline-4" id="outline-container-org598847e">
<h4 id="org598847e">Imports</h4>
<div class="outline-text-4" id="text-org598847e">
<p>From Python.</p>
<div class="highlight">
<pre><span></span>from functools import partial
from pathlib import Path
import os
</pre></div>
<p>From PyPi.</p>
<div class="highlight">
<pre><span></span>from bokeh.models import CrosshairTool, HoverTool
from dotenv import load_dotenv
from tabulate import tabulate

import holoviews
import hvplot.pandas
import numpy
import pandas
</pre></div>
<p>My Stuff.</p>
<div class="highlight">
<pre><span></span>from graeae.visualization import EmbedBokeh
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3b1b45b">
<h4 id="org3b1b45b">Presets</h4>
<div class="outline-text-4" id="text-org3b1b45b">
<p>Load the dotenv.</p>
<div class="highlight">
<pre><span></span>load_dotenv(".env")
</pre></div>
<p>Set up the bokeh.</p>
<div class="highlight">
<pre><span></span>OUTPUT_FOLDER = Path("../../files/posts/libraries/walking-through-the-pyviz-workflow-example/")
Embed = partial(EmbedBokeh, folder_path=OUTPUT_FOLDER)
holoviews.extension("bokeh", width=800)
</pre></div>
<p>Set up the table printer.</p>
<div class="highlight">
<pre><span></span>TABLE = partial(tabulate, tablefmt="orgtbl", headers="keys", showindex=False)
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orga4cdf98">
<h4 id="orga4cdf98">Load Some Data</h4>
<div class="outline-text-4" id="text-orga4cdf98">
<p>Measles and pertusis by state.</p>
<div class="highlight">
<pre><span></span>diseases = pandas.read_csv(Path(os.environ.get("DISEASES")))
</pre></div>
<div class="highlight">
<pre><span></span>print(TABLE(diseases.head()))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Year</th>
<th class="org-right" scope="col">Week</th>
<th class="org-left" scope="col">State</th>
<th class="org-right" scope="col">measles</th>
<th class="org-right" scope="col">pertussis</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1928</td>
<td class="org-right">1</td>
<td class="org-left">Alabama</td>
<td class="org-right">3.67</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">2</td>
<td class="org-left">Alabama</td>
<td class="org-right">6.25</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">3</td>
<td class="org-left">Alabama</td>
<td class="org-right">7.95</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">4</td>
<td class="org-left">Alabama</td>
<td class="org-right">12.58</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">5</td>
<td class="org-left">Alabama</td>
<td class="org-right">8.03</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org06f885c">
<h4 id="org06f885c">Constants</h4>
<div class="outline-text-4" id="text-org06f885c">
<div class="highlight">
<pre><span></span>class Plots:
    width = 800
    height = 600
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb09cf35">
<h2 id="orgb09cf35">Middle</h2>
<div class="outline-text-2" id="text-orgb09cf35"></div>
<div class="outline-3" id="outline-container-org0a5d50a">
<h3 id="org0a5d50a">Looking at Measles</h3>
<div class="outline-text-3" id="text-org0a5d50a"></div>
<div class="outline-4" id="outline-container-orgf2610d9">
<h4 id="orgf2610d9">By Year</h4>
<div class="outline-text-4" id="text-orgf2610d9">
<div class="highlight">
<pre><span></span>hover = HoverTool(
    tooltips=[
        ("Measles", "@measles{0,0}"),
        ("Year", "@Year"),
    ],
    formatters={"measles": "numeral"},
    mode="vline",
)

measles_by_year = diseases[["Year", "measles"]].groupby("Year").agg(numpy.sum)
plot = measles_by_year.hvplot(title="Measles In the U.S. by Year", 
                              xlabel="Year", 
                              ylabel="Cases", 
                              width=1000,
                              tools=[hover])
Embed(plot, "measles_by_year")()
</pre></div>
<script id="0c1bd4a3-5b3c-4fcb-ac1d-a58707c55220" src="measles_by_year.js">
</script>
<p>You can see from the plot that cases of measles have dropped dramatically over the years, with a particularly sharp drop in the 1960's.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org08f2c54">
<h4 id="org08f2c54">Vaccines Enter The Picture</h4>
<div class="outline-text-4" id="text-org08f2c54">
<p>According to the <a href="https://www.cdc.gov/measles/about/history.html">CDC</a>, the Edmonston-D vaccine was released in the United States in 1963 and the Edmonston-Enders vaccine (which is still currently in use) was released in 1968.</p>
<div class="highlight">
<pre><span></span>first = holoviews.VLine(1963).opts(color="black", alpha=0.5)
first_label = holoviews.Text(1963 - 1, 27000, "Vaccine Introduced", halign="right")
current = holoviews.VLine(1968).opts(color="black", alpha=0.5)
current_label = holoviews.Text(1968 + 1, 27000, "Newer Vaccine", halign="left")
highest = holoviews.VLine(int(measles_by_year.idxmax())).opts(color="red")
highest_label = holoviews.Text(int(measles_by_year.idxmax()) + 1, 27000, "Year of the Most Cases", halign="left")
lowest = holoviews.VLine(int(measles_by_year.idxmin())).opts(color="blue", alpha=0.5)
lowest_label = holoviews.Text(int(measles_by_year.idxmin()) - 1, 27000, "Zero Cases", halign="right")

plot_2 = (plot 
          * first * first_label 
          * current * current_label 
          * highest * highest_label 
          * lowest * lowest_label)
Embed(plot_2, "measles_with_landmarks")()
</pre></div>
<script id="332e76e1-349f-46d7-980d-2436faa41ad9" src="measles_with_landmarks.js">
</script></div>
</div>
<div class="outline-4" id="outline-container-org9865249">
<h4 id="org9865249">Measles By State</h4>
<div class="outline-text-4" id="text-org9865249">
<p>This creates a dropdown menu so we can see the states' measles cases separately. It doesn't work in this template so I'm saving it as a separate page.</p>
<div class="highlight">
<pre><span></span>measles_by_state = diseases.groupby(["Year", "State"])["measles"].sum()
states_plot = measles_by_state.hvplot(x="Year", groupby="State", width=800, dynamic=False)
file_name = "measles_by_state.html"
holoviews.save(states_plot, OUTPUT_FOLDER.joinpath(file_name))
print("[[file:{}][Link to plot]]".format(file_name))
</pre></div>
<p><a href="measles_by_state.html">Link to plot</a></p>
</div>
</div>
<div class="outline-4" id="outline-container-org4668cc5">
<h4 id="org4668cc5">Oregon Vs Hawaii</h4>
<div class="outline-text-4" id="text-org4668cc5">
<p>The addition sign is used to make plots next to each other.</p>
<div class="highlight">
<pre><span></span>oregon_plot = states_plot["Oregon"].relabel("Oregon")
hawaii_plot = states_plot["Hawaii"].relabel("Hawaii")
plot = (oregon_plot * first * first_label * current * current_label
        + hawaii_plot * first * first_label * current * current_label)
Embed(plot, "oregon_vs_hawaii")()
</pre></div>
<script id="a5948eff-5cd0-4d97-89b6-53601ea84509" src="oregon_vs_hawaii.js">
</script>
<p>I don't know why but the labels don't work. Surprisingly (to me), Hawaii had more cases and with huge swings. Perhaps since it's an island the sailors and other travelers introduced epidemics. Or maybe they weren't as good at keeping records back then.</p>
<p>According to the <a href="https://en.wikipedia.org/wiki/List_of_U.S._states_and_territories_by_historical_population">Census Count</a> Oregon was quite a bit more populous than Hawaii.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org95b2ac3">
<h4 id="org95b2ac3">Four States</h4>
<div class="outline-text-4" id="text-org95b2ac3">
<p>The four states nearest to Hawaii in population are (in descending order):</p>
<ul class="org-ul">
<li>Montana</li>
<li>Idaho</li>
<li>Hawaii</li>
<li>North Dakota</li>
</ul>
<div class="highlight">
<pre><span></span>hover = HoverTool(
    tooltips=[
        ("Measles", "@measles{0,0}"),
        ("Year", "@Year"),
        ("State", "@State"),
    ],
    formatters={"measles": "numeral"},
)

states = ["Montana", "Idaho", "Hawaii", "North Dakota"]
start_year, end_year = 1930, 2005
plot = (measles_by_state.loc[start_year:end_year, states].hvplot(
    by="State",
    title="Measles 1930 - 2005",
    tools=[hover],
    width=800) 
        * first * first_label 
        * current * current_label)
Embed(plot, "four_states_measles")()
</pre></div>
<script id="0b88e38d-e38c-40b0-81ca-02eca28f6273" src="four_states_measles.js">
</script>
<p>Surprisingly Hawaii had the highest values in 1951 and 1955.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org30bd243">
<h4 id="org30bd243">Faceting</h4>
<div class="outline-text-4" id="text-org30bd243">
<p>Another way to compare the states is to plot them side-by side.</p>
<div class="highlight">
<pre><span></span>hover = HoverTool(
    tooltips=[
        ("Measles", "@measles{0,0}"),
        ("Year", "@Year"),
    ],
    formatters={"measles": "numeral"},
)

crosshairs = CrosshairTool()
plot = (measles_by_state.loc[start_year:end_year, states].hvplot(
    title="Measles By Year",
    x="Year", col="State", width=300, height=200, rot=90, tools=[crosshairs])
        * first * first_label * current * current_label)
Embed(plot, "faceted_measles_states")()
</pre></div>
<script id="cfb60145-6b0a-4e8b-b461-ea75dcdb8397" src="faceted_measles_states.js">
</script></div>
</div>
</div>
<div class="outline-3" id="outline-container-org3d89007">
<h3 id="org3d89007">Bar Chart</h3>
<div class="outline-text-3" id="text-org3d89007">
<div class="highlight">
<pre><span></span>plot = measles_by_state.loc[1960:1970, states].hvplot.bar(
    "Year",
    height=500,
    by="State", 
    rot=90)
Embed(plot, "measles_bar_chart")()
</pre></div>
<script id="7f9bdc94-8a69-4a66-b39c-50cecdf70d15" src="measles_bar_chart.js">
</script></div>
<div class="outline-4" id="outline-container-org8377c53">
<h4 id="org8377c53">Nationwide Mean With Error Bars</h4>
<div class="outline-text-4" id="text-org8377c53">
<div class="highlight">
<pre><span></span>error = diseases.groupby("Year").agg({"measles": [numpy.mean, numpy.std]}).xs(
    "measles", axis=1)
plot = (error.hvplot(y="mean", title="Mean National Measles Cases By Year") 
        * holoviews.ErrorBars(error, "Year").redim.range(mean=(0, None)) 
        * first * first_label * current * current_label)
Embed(plot, "error_bars")()
</pre></div>
<script id="8078fe82-39bb-44e9-9f24-79d8ddb8ee1b" src="error_bars.js">
</script></div>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/pyviz/" rel="tag">pyviz</a></li>
<li><a class="tag p-category" href="../../../categories/tutorial/" rel="tag">tutorial</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../../giss/giss-zone-anomalies/" rel="prev" title="GISS Zone Anomalies">Previous post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js">
</script>
<script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
