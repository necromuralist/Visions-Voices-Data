<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Walking through the HoloViews' Getting Started - Tabular Dataset example." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>HoloViews Tabular Datasets | Visions, Voices, Data</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/holoviews-tabular-datasets/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<meta content="Cloistered Monkey" name="author">
<link href="../../giss/giss-globalhemispheric-temperatures/" rel="prev" title="GISS Global/Hemispheric Temperatures" type="text/html">
<link href="../holoviews-tabular-data-take-two/" rel="next" title="HoloViews Tabular Data Take Two" type="text/html">
<meta content="Visions, Voices, Data" property="og:site_name">
<meta content="HoloViews Tabular Datasets" property="og:title">
<meta content="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/holoviews-tabular-datasets/" property="og:url">
<meta content="Walking through the HoloViews' Getting Started - Tabular Dataset example." property="og:description">
<meta content="article" property="og:type">
<meta content="2019-03-01T12:54:10-08:00" property="article:published_time">
<meta content="bokeh" property="article:tag">
<meta content="holoviews" property="article:tag">
<meta content="tutorial" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/Visions-Voices-Data/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a> <a class="dropdown-item" href="../../../pages/giss/giss-yearly-anomalies-by-climate-zone">GISS Anomalies</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"><input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">HoloViews Tabular Datasets</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2019-03-01T12:54:10-08:00" itemprop="datePublished" title="2019-03-01 12:54">2019-03-01 12:54</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org10604a7">Introduction</a></li>
<li><a href="#orgfbdc19e">Set Up</a>
<ul>
<li><a href="#orgcf2fa7c">Imports</a></li>
<li><a href="#orgbc47545">Holoviews Bokeh</a></li>
<li><a href="#org8d4f80b">The Embedder</a></li>
<li><a href="#orgfc27cbc">Dotenv</a></li>
<li><a href="#org560f8bf">Tabulate</a></li>
</ul>
</li>
<li><a href="#org589cad7">Load the Data</a></li>
<li><a href="#orgaa14009">Create a Dataset</a>
<ul>
<li><a href="#orga2d4768">Aggregate The Data</a></li>
<li><a href="#orgd36747c">Save the HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org10604a7">
<h2 id="org10604a7">Introduction</h2>
<div class="outline-text-2" id="text-org10604a7">
<p>This is a walk through the <a href="https://holoviews.org/getting_started/Tabular_Datasets.html">HoloViews page on Tabular Datasets</a>. The data-set was created by the Wall Street Journal using Project Tycho, but I'm getting it from the <a href="https://github.com/pyviz/holoviews">HoloViews github repository</a>. The Wall Street Journal page is <a href="https://graphics.wsj.com/infectious-diseases-and-vaccines/#b02g20t20w15">here</a>. Unfortunately it has mixed content types (https and http) as well as some other problems which prevent Firefox and Chrome-based browsers from rendering it the visualization so I don't know what it actually looks like. Given that it's a commercial site I'm assuming it's an old page that they don't care about anymore.</p>
<p><b>Warning:</b> I originally did this with <code>modin</code> and it wouldn't plot correctly. Save it for pre-processing and just use the real <code>pandas</code> when plotting.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgfbdc19e">
<h2 id="orgfbdc19e">Set Up</h2>
<div class="outline-text-2" id="text-orgfbdc19e"></div>
<div class="outline-3" id="outline-container-orgcf2fa7c">
<h3 id="orgcf2fa7c">Imports</h3>
<div class="outline-text-3" id="text-orgcf2fa7c"></div>
<div class="outline-4" id="outline-container-org75a96ac">
<h4 id="org75a96ac">Python</h4>
<div class="outline-text-4" id="text-org75a96ac">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1de0db4">
<h4 id="org1de0db4">PyPi</h4>
<div class="outline-text-4" id="text-org1de0db4">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">holoviews</span> <span class="kn">import</span> <span class="n">opts</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9bda96f">
<h4 id="org9bda96f">My Projects</h4>
<div class="outline-text-4" id="text-org9bda96f">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bartleby_the_penguin.tangles.embed_bokeh</span> <span class="kn">import</span> <span class="n">EmbedBokeh</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgbc47545">
<h3 id="orgbc47545">Holoviews Bokeh</h3>
<div class="outline-text-3" id="text-orgbc47545">
<p>I don't know why but you have to specify that you're using <code>bokeh</code>, even though it looks like it's working when you don't.</p>
<div class="highlight">
<pre><span></span><span class="n">holoviews</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="s2">"bokeh"</span><span class="p">)</span>
<span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org8d4f80b">
<h3 id="org8d4f80b">The Embedder</h3>
<div class="outline-text-3" id="text-org8d4f80b">
<div class="highlight">
<pre><span></span><span class="n">files_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"../../files/posts/libraries/holoviews-tabular-datasets/"</span><span class="p">)</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">EmbedBokeh</span><span class="p">,</span>
    <span class="n">folder_path</span><span class="o">=</span><span class="n">files_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgfc27cbc">
<h3 id="orgfc27cbc">Dotenv</h3>
<div class="outline-text-3" id="text-orgfc27cbc">
<p>I have the path to the data-set in a <code>.env</code> file so I'll load it into the environment dictionary.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">".env"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org560f8bf">
<h3 id="org560f8bf">Tabulate</h3>
<div class="outline-text-3" id="text-org560f8bf">
<p>This will print a table that org knows how to render.</p>
<div class="highlight">
<pre><span></span><span class="n">orgtable</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> 
                   <span class="n">showindex</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org589cad7">
<h2 id="org589cad7">Load the Data</h2>
<div class="outline-text-2" id="text-org589cad7">
<p>The data comes from <a href="https://www.tycho.pitt.edu/">Project Tycho</a>, which provides health-related data sets for research. The <code>.env</code> file assumes that I cloned the <code>HoloViews</code> repository so that I can load the data from it.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"DISEASES"</span><span class="p">))</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">diseases</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">orgtable</span><span class="p">(</span><span class="n">diseases</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Year</th>
<th class="org-right" scope="col">Week</th>
<th class="org-left" scope="col">State</th>
<th class="org-right" scope="col">measles</th>
<th class="org-right" scope="col">pertussis</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1928</td>
<td class="org-right">1</td>
<td class="org-left">Alabama</td>
<td class="org-right">3.67</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">2</td>
<td class="org-left">Alabama</td>
<td class="org-right">6.25</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">3</td>
<td class="org-left">Alabama</td>
<td class="org-right">7.95</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">4</td>
<td class="org-left">Alabama</td>
<td class="org-right">12.58</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">1928</td>
<td class="org-right">5</td>
<td class="org-left">Alabama</td>
<td class="org-right">8.03</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diseases</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diseases</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="n">diseases</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">diseases</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">diseases</span><span class="o">.</span><span class="n">Week</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
<pre class="example">
222768
51
1928
2011
[ 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48
 49 50 51 52]

</pre>
<p>The <code>State</code> column includes Washington D.C., which is why there are 51 states. It has 52 weeks of data for each year from 1928 through 2011. Since <i>measles</i> and <i>pertussis</i> are greater than 1 I assume that this is some kind of rate (like incidence per million), but the page doesn't say and I the article they link to doesn't seem to render in my browser (and I don't have an account to download a dataset).</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgaa14009">
<h2 id="orgaa14009">Create a Dataset</h2>
<div class="outline-text-2" id="text-orgaa14009">
<p>HoloViews has a class called a Dataset that lets you declare the dependent (<i>value dimensions (vdims)</i>) and independent variables (<i>key dimensions (kdims)</i>).</p>
<div class="highlight">
<pre><span></span><span class="n">key_dimensions</span> <span class="o">=</span> <span class="s2">"Year State"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">value_dimensions</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">"measles"</span><span class="p">,</span> <span class="s2">"Measles Incidence"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"pertussis"</span><span class="p">,</span> <span class="s2">"Pertusis Incidence"</span><span class="p">)]</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">diseases</span><span class="p">,</span> <span class="n">key_dimensions</span><span class="p">,</span> <span class="n">value_dimensions</span><span class="p">)</span>
</pre></div>
<p>The <code>value_dimensions</code> list has tuples - these take the form <code>(&lt;column-name&gt;, &lt;output-name&gt;)</code> so when you make a plot it will use the <code>&lt;output-name&gt;</code> for any labels that are created.</p>
</div>
<div class="outline-3" id="outline-container-orga2d4768">
<h3 id="orga2d4768">Aggregate The Data</h3>
<div class="outline-text-3" id="text-orga2d4768">
<p>The one column that I didn't add is the <code>Week</code> column. The <code>Dataset</code> has a rather confusing <code>aggregate</code> method (confusing because you only pass in the function to aggregate with) that apparently knows how to use the <code>key_dimensions</code> variables we passed in to figure out what to aggregate.</p>
<div class="highlight">
<pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
:Dataset   [Year,State]   (measles,pertussis)
(4284, 4)

</pre>
<div class="highlight">
<pre><span></span><span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">holoviews</span><span class="o">.</span><span class="n">Curve</span><span class="p">,</span> <span class="s2">"Year"</span><span class="p">,</span> <span class="s2">"measles"</span><span class="p">)</span>
          <span class="o">+</span> <span class="n">dataset</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">holoviews</span><span class="o">.</span><span class="n">Curve</span><span class="p">,</span> <span class="s2">"Year"</span><span class="p">,</span> <span class="s2">"pertussis"</span><span class="p">))</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">framewise</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">"hover"</span><span class="p">]))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Embed</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="s2">"measles_pertusis"</span><span class="p">)()</span>
</pre></div>
<script id="e0b8360d-329e-4304-bd8b-0b14a6a80f57" src="measles_pertusis.js">
</script>
<p>Two things to note. One is that HoloViews picked up the nicer names without us having to specify them. Another is that only Alabama is displayed. In the demonstration HoloViews created a drop-down menu to select a state but it didn't do it here. Maybe you need to run it in a jupyter notebook…</p>
<p>Actually, I think it might be a conflict with <code>nikola</code>, this is a page saved from a jupyter notebook without any nikola pre-processing:</p>
<p><a href="diseases.html">diseases.html</a></p>
</div>
</div>
<div class="outline-3" id="outline-container-orgd36747c">
<h3 id="orgd36747c">Save the HTML</h3>
<div class="outline-text-3" id="text-orgd36747c">
<p>I'll see if you can do it directly here without using jupyter.</p>
<div class="highlight">
<pre><span></span><span class="n">save_file</span> <span class="o">=</span> <span class="s2">"diseases_2.html"</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">files_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">save_file</span><span class="p">)</span>
<span class="n">holoviews</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"[[file:{}][This is the plot.]]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_file</span><span class="p">))</span>
</pre></div>
<p><a href="diseases_2.html">This is the plot.</a></p>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/bokeh/" rel="tag">bokeh</a></li>
<li><a class="tag p-category" href="../../../categories/holoviews/" rel="tag">holoviews</a></li>
<li><a class="tag p-category" href="../../../categories/tutorial/" rel="tag">tutorial</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../../giss/giss-globalhemispheric-temperatures/" rel="prev" title="GISS Global/Hemispheric Temperatures">Previous post</a></li>
<li class="next"><a href="../holoviews-tabular-data-take-two/" rel="next" title="HoloViews Tabular Data Take Two">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js">
</script>
<script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
