<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Testing whether CPR helps or hurts survival rates for people given blood thinners." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>CPR and Blood Thinners | Visions, Voices, Data</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/posts/cpr-and-blood-thinners/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script><!--
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"
</script>
-->
<script async src="../../javascript/p5.min.js" type="text/javascript"></script>
<meta content="Cloistered Monkey" name="author">
<link href="/posts/opportunity-cost-neglect/" rel="prev" title="Opportunity Cost Neglect" type="text/html">
<link href="/posts/think-complexity/" rel="next" title="Bibliography for Think Complexity" type="text/html">
<meta content="Visions, Voices, Data" property="og:site_name">
<meta content="CPR and Blood Thinners" property="og:title">
<meta content="https://necromuralist.github.io/Visions-Voices-Data/posts/cpr-and-blood-thinners/" property="og:url">
<meta content="Testing whether CPR helps or hurts survival rates for people given blood thinners." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-10-01T18:16:06-07:00" property="article:published_time">
<meta content="inference" property="article:tag">
<meta content="simulation" property="article:tag">
<meta content="statistics" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Give-The-Fish/">Give the Fish</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"> <input name="k8" type="hidden" value="#444444"> <input name="k9" type="hidden" value="#D51920"> <input name="kt" type="hidden" value="h"> <input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" type="text"> <input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="/posts/cpr-and-blood-thinners/index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="/posts/cpr-and-blood-thinners/">CPR and Blood Thinners</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/cpr-and-blood-thinners/" rel="bookmark"><time class="published dt-published" datetime="2020-10-01T18:16:06-07:00" itemprop="datePublished" title="2020-10-01 18:16">2020-10-01 18:16</time></a></p>
<p class="sourceline"><a class="sourcelink" href="/posts/cpr-and-blood-thinners/index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="/posts/cpr-and-blood-thinners/#org92edbfb">Beginning</a>
<ul>
<li><a href="/posts/cpr-and-blood-thinners/#org604f061">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/cpr-and-blood-thinners/#orgaf85371">Middle</a>
<ul>
<li><a href="/posts/cpr-and-blood-thinners/#org2529500">The Study Data</a></li>
<li><a href="/posts/cpr-and-blood-thinners/#org89a4574">Simulation</a></li>
</ul>
</li>
<li><a href="/posts/cpr-and-blood-thinners/#org53b8aad">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org92edbfb">
<h2 id="org92edbfb">Beginning</h2>
<div class="outline-text-2" id="text-org92edbfb">
<p>We want to test the hypothesis that blood thinners administered to patients that have been give CPR has <i>some</i> kind of effect (for good or for ill) on survival rates.</p>
<ul class="org-ul">
<li>\(H_0\): Bood thinners don't have an effect on survival rate - the proportions will be the same for each group (\(p_{treatment} = p_{control}\)).</li>
<li>\(H_A\): Blood thinners impact survival, either positive or negative (\(p_{treatment} - p_{control} \neq 0\)).</li>
</ul>
<p>We're going to use a significance level of 0.05.</p>
<div class="highlight">
<pre><span></span><span class="n">ALPHA</span> <span class="o">=</span> <span class="mf">0.05</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org604f061">
<h3 id="org604f061">Set Up</h3>
<div class="outline-text-3" id="text-org604f061"></div>
<div class="outline-4" id="outline-container-orgfdcef79">
<h4 id="orgfdcef79">Imports</h4>
<div class="outline-text-4" id="text-orgfdcef79">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org8f72c80">
<h4 id="org8f72c80">Random Generator</h4>
<div class="outline-text-4" id="text-org8f72c80">
<div class="highlight">
<pre><span></span><span class="n">numpy_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf1faf58">
<h4 id="orgf1faf58">The Timer</h4>
<div class="outline-text-4" id="text-orgf1faf58">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org0244773">
<h4 id="org0244773">Plotting</h4>
<div class="outline-text-4" id="text-org0244773">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"cpr-and-blood-thinners"</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
    <span class="n">color_cycle</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Cycle</span><span class="p">([</span><span class="s2">"#4687b7"</span><span class="p">,</span> <span class="s2">"#ce7b6d"</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org0bfc223">
<h4 id="org0bfc223">The Table Printer</h4>
<div class="outline-text-4" id="text-org0bfc223">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgaf85371">
<h2 id="orgaf85371">Middle</h2>
<div class="outline-text-2" id="text-orgaf85371"></div>
<div class="outline-3" id="outline-container-org2529500">
<h3 id="org2529500">The Study Data</h3>
<div class="outline-text-3" id="text-org2529500">
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="nb">dict</span><span class="p">(</span>
        <span class="n">Survived</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
        <span class="n">Died</span> <span class="o">=</span> <span class="p">[</span><span class="mi">39</span><span class="p">,</span> <span class="mi">26</span><span class="p">]))</span>
<span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Control"</span><span class="p">,</span> <span class="s2">"Treatment"</span><span class="p">]</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">row</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Total"</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">Survived</th>
<th class="org-right" scope="col">Died</th>
<th class="org-right" scope="col">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Control</td>
<td class="org-right">11</td>
<td class="org-right">39</td>
<td class="org-right">50</td>
</tr>
<tr>
<td class="org-left">Treatment</td>
<td class="org-right">14</td>
<td class="org-right">26</td>
<td class="org-right">40</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Total</td>
<td class="org-right">25</td>
<td class="org-right">65</td>
<td class="org-right">90</td>
</tr>
</tbody>
</table>
<p>The fifty people in the Control Group didn't receive blood thinners and the forty in the Treatment Group did.</p>
<p>Now I'll plot it to see what the differences look like.</p>
<div class="highlight">
<pre><span></span><span class="c1"># put the groups into a column</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># get rid of the totals</span>
<span class="k">del</span><span class="p">(</span><span class="n">plotter</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">])</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"index"</span><span class="p">],</span>
                       <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Survived"</span><span class="p">,</span> <span class="s2">"Died"</span><span class="p">])</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">"Group"</span><span class="p">,</span>
    <span class="n">variable</span><span class="o">=</span><span class="s2">"Outcome"</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">))</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Group"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">"Outcome"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Survived or Died"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"survived_or_died"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/cpr-and-blood-thinners/survived_or_died.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Hard to say, but it looks like more of the Treatment Group survived.</p>
</div>
<div class="outline-4" id="outline-container-orgb7a679d">
<h4 id="orgb7a679d">The Porportions</h4>
<div class="outline-text-4" id="text-orgb7a679d">
<p>We are interested in the difference in survival rates so we need to calculate the proprtion that survived in each group and take the difference.</p>
<div class="highlight">
<pre><span></span><span class="n">survival_rates</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"Survived"</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">Total</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Group"</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s2">"Survival Rate"</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">survival_rates</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Group</th>
<th class="org-right" scope="col">Survival Rate</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Control</td>
<td class="org-right">0.22</td>
</tr>
<tr>
<td class="org-left">Treatment</td>
<td class="org-right">0.35</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Total</td>
<td class="org-right">0.277778</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">survival_rates</span> <span class="o">=</span> <span class="n">survival_rates</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"Group"</span><span class="p">)</span>
<span class="n">TEST_STATISTIC</span> <span class="o">=</span> <span class="n">survival_rates</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Treatment"</span><span class="p">]</span> <span class="o">-</span> <span class="n">survival_rates</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Control"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Difference: </span><span class="si">{</span><span class="n">TEST_STATISTIC</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Difference: Survival Rate    0.13
dtype: float64
</pre>
<p>It appears that 13% more people survive when they are given blood thinners than when they aren't.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org89a4574">
<h3 id="org89a4574">Simulation</h3>
<div class="outline-text-3" id="text-org89a4574">
<p>Now I'll run a simulation to build up the <b>null distribution</b> of the differences.</p>
</div>
<div class="outline-4" id="outline-container-org7c3528f">
<h4 id="org7c3528f">Set Up The Urn</h4>
<div class="outline-text-4" id="text-org7c3528f">
<p>The urn will be based on the total row on the contingency table. The that number survived will be represented as ones and the number that died will be represented as zeros.</p>
<div class="highlight">
<pre><span></span><span class="n">total</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">]</span>
<span class="n">survived</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">total</span><span class="o">.</span><span class="n">Survived</span><span class="p">)</span>
<span class="n">died</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">total</span><span class="o">.</span><span class="n">Died</span><span class="p">)</span>
<span class="n">urn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">survived</span><span class="p">,</span> <span class="n">died</span><span class="p">)</span>
</pre></div>
<p>Now we'll run the simulation to get the distribution.</p>
<div class="highlight">
<pre><span></span><span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
<span class="n">CONTROL_GROUP</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Control"</span><span class="p">]</span>
<span class="n">TREATMENT_GROUP</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Treatment"</span><span class="p">]</span>
<span class="n">survived</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"Survived"</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">controls</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy_random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">urn</span><span class="p">,</span>
                                                <span class="n">CONTROL_GROUP</span><span class="p">,</span>
                                                <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">)])</span>
    <span class="n">treatments</span> <span class="o">=</span> <span class="n">survived</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Total"</span><span class="p">]</span> <span class="o">-</span> <span class="n">controls</span>

    <span class="n">control_proportions</span> <span class="o">=</span> <span class="n">controls</span><span class="o">/</span><span class="n">CONTROL_GROUP</span>
    <span class="n">treatment_proportions</span> <span class="o">=</span> <span class="n">treatments</span><span class="o">/</span><span class="n">TREATMENT_GROUP</span>

    <span class="n">differences</span> <span class="o">=</span> <span class="n">treatment_proportions</span> <span class="o">-</span> <span class="n">control_proportions</span>
    <span class="n">differences</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">"Point Estimate"</span><span class="p">:</span> <span class="n">differences</span><span class="p">})</span>
</pre></div>
<pre class="example">
2020-10-01 19:38:55,370 graeae.timers.timer start: Started: 2020-10-01 19:38:55.370038
2020-10-01 19:39:31,437 graeae.timers.timer end: Ended: 2020-10-01 19:39:31.437364
2020-10-01 19:39:31,438 graeae.timers.timer end: Elapsed: 0:00:36.067326
</pre>
<p>Plot the distribution.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">differences</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s2">"Point Estimate"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Null Distribution of Point Estimate"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"null_distribution"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/cpr-and-blood-thinners/null_distribution.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Now we want to try a two-sided hypothesis test.</p>
<div class="highlight">
<pre><span></span><span class="n">right_side</span> <span class="o">=</span> <span class="p">(</span><span class="n">differences</span> <span class="o">&gt;=</span> <span class="n">TEST_STATISTIC</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">right_side</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"One-Sided p-value: </span><span class="si">{</span><span class="p">(</span><span class="n">right_side</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">differences</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Two-sided p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
One-Sided p-value: 0.129026
Two-sided p-value: 0.258052
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"We reject the Null Hypothesis: </span><span class="si">{</span><span class="n">p_value</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ALPHA</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
We reject the Null Hypothesis: False
</pre>
<p>Even a single-sided test wouldn't have provided enough evidence to reject the null hypothesis, but with the two-sided version it looks really like the difference was from chance.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org53b8aad">
<h2 id="org53b8aad">End</h2>
<div class="outline-text-2" id="text-org53b8aad">
<p>Although it initially looked like the use of blood thinners after someone has been given CPR helped survival rates our data does not contain evidence to say that it does.</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="/categories/inference/" rel="tag">inference</a></li>
<li><a class="tag p-category" href="/categories/simulation/" rel="tag">simulation</a></li>
<li><a class="tag p-category" href="/categories/statistics/" rel="tag">statistics</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="/posts/opportunity-cost-neglect/" rel="prev" title="Opportunity Cost Neglect">Previous post</a></li>
<li class="next"><a href="/posts/think-complexity/" rel="next" title="Bibliography for Think Complexity">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents Â© 2023 <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="/assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script> 
</body>
</html>
