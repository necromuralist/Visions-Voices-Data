<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Visions, Voices, Data (Posts about pyviz)</title><link>https://necromuralist.github.io/Visions-Voices-Data/</link><description></description><atom:link href="https://necromuralist.github.io/Visions-Voices-Data/categories/pyviz.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2019 &lt;a href="mailto:necromuralist@protonmail.com"&gt;Cloistered Monkey&lt;/a&gt; </copyright><lastBuildDate>Sat, 16 Mar 2019 07:35:59 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Walking Through the Pyviz Workflow Example</title><link>https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/</link><dc:creator>Cloistered Monkey</dc:creator><description>&lt;div id="table-of-contents"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/#orgbb0c300"&gt;Beginning&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/#orgb1b5cf8"&gt;Set Up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/#orgb09cf35"&gt;Middle&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/#org0a5d50a"&gt;Looking at Measles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/#org3d89007"&gt;Bar Chart&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgbb0c300" class="outline-2"&gt;
&lt;h2 id="orgbb0c300"&gt;Beginning&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgbb0c300"&gt;
&lt;p&gt;
This is a replication of (most of) the &lt;a href="http://pyviz.org/tutorial/01_Workflow_Introduction.html"&gt;pyviz workflow introduction&lt;/a&gt; to see if I can replicate it. Nothing new here.
&lt;/p&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgb1b5cf8" class="outline-3"&gt;
&lt;h3 id="orgb1b5cf8"&gt;Set Up&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgb1b5cf8"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org598847e" class="outline-4"&gt;
&lt;h4 id="org598847e"&gt;Imports&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org598847e"&gt;
&lt;p&gt;
From Python.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;from functools import partial
from pathlib import Path
import os
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
From PyPi.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;from bokeh.models import CrosshairTool, HoverTool
from dotenv import load_dotenv
from tabulate import tabulate

import holoviews
import hvplot.pandas
import numpy
import pandas
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
My Stuff.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;from graeae.visualization import EmbedBokeh
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org3b1b45b" class="outline-4"&gt;
&lt;h4 id="org3b1b45b"&gt;Presets&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org3b1b45b"&gt;
&lt;p&gt;
Load the dotenv.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;load_dotenv(".env")
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Set up the bokeh.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;OUTPUT_FOLDER = Path("../../files/posts/libraries/walking-through-the-pyviz-workflow-example/")
Embed = partial(EmbedBokeh, folder_path=OUTPUT_FOLDER)
holoviews.extension("bokeh", width=800)
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Set up the table printer.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;TABLE = partial(tabulate, tablefmt="orgtbl", headers="keys", showindex=False)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orga4cdf98" class="outline-4"&gt;
&lt;h4 id="orga4cdf98"&gt;Load Some Data&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-orga4cdf98"&gt;
&lt;p&gt;
Measles and pertusis by state.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;diseases = pandas.read_csv(Path(os.environ.get("DISEASES")))
&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;print(TABLE(diseases.head()))
&lt;/pre&gt;&lt;/div&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-left"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th scope="col" class="org-right"&gt;Year&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;Week&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;State&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;measles&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;pertussis&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="org-right"&gt;1928&lt;/td&gt;
&lt;td class="org-right"&gt;1&lt;/td&gt;
&lt;td class="org-left"&gt;Alabama&lt;/td&gt;
&lt;td class="org-right"&gt;3.67&lt;/td&gt;
&lt;td class="org-right"&gt;nan&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-right"&gt;1928&lt;/td&gt;
&lt;td class="org-right"&gt;2&lt;/td&gt;
&lt;td class="org-left"&gt;Alabama&lt;/td&gt;
&lt;td class="org-right"&gt;6.25&lt;/td&gt;
&lt;td class="org-right"&gt;nan&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-right"&gt;1928&lt;/td&gt;
&lt;td class="org-right"&gt;3&lt;/td&gt;
&lt;td class="org-left"&gt;Alabama&lt;/td&gt;
&lt;td class="org-right"&gt;7.95&lt;/td&gt;
&lt;td class="org-right"&gt;nan&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-right"&gt;1928&lt;/td&gt;
&lt;td class="org-right"&gt;4&lt;/td&gt;
&lt;td class="org-left"&gt;Alabama&lt;/td&gt;
&lt;td class="org-right"&gt;12.58&lt;/td&gt;
&lt;td class="org-right"&gt;nan&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-right"&gt;1928&lt;/td&gt;
&lt;td class="org-right"&gt;5&lt;/td&gt;
&lt;td class="org-left"&gt;Alabama&lt;/td&gt;
&lt;td class="org-right"&gt;8.03&lt;/td&gt;
&lt;td class="org-right"&gt;nan&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org06f885c" class="outline-4"&gt;
&lt;h4 id="org06f885c"&gt;Constants&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org06f885c"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;class Plots:
    width = 800
    height = 600
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgb09cf35" class="outline-2"&gt;
&lt;h2 id="orgb09cf35"&gt;Middle&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgb09cf35"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org0a5d50a" class="outline-3"&gt;
&lt;h3 id="org0a5d50a"&gt;Looking at Measles&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org0a5d50a"&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgf2610d9" class="outline-4"&gt;
&lt;h4 id="orgf2610d9"&gt;By Year&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-orgf2610d9"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hover = HoverTool(
    tooltips=[
	("Measles", "@measles{0,0}"),
	("Year", "@Year"),
    ],
    formatters={"measles": "numeral"},
    mode="vline",
)

measles_by_year = diseases[["Year", "measles"]].groupby("Year").agg(numpy.sum)
plot = measles_by_year.hvplot(title="Measles In the U.S. by Year", 
			      xlabel="Year", 
			      ylabel="Cases", 
			      width=1000,
			      tools=[hover])
Embed(plot, "measles_by_year")()
&lt;/pre&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/measles_by_year.js" id="0c1bd4a3-5b3c-4fcb-ac1d-a58707c55220"&gt;&lt;/script&gt;

&lt;p&gt;
You can see from the plot that cases of measles have dropped dramatically over the years, with a particularly sharp drop in the 1960's.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org08f2c54" class="outline-4"&gt;
&lt;h4 id="org08f2c54"&gt;Vaccines Enter The Picture&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org08f2c54"&gt;
&lt;p&gt;
According to the &lt;a href="https://www.cdc.gov/measles/about/history.html"&gt;CDC&lt;/a&gt;, the Edmonston-D vaccine was released in the United States in 1963 and the Edmonston-Enders vaccine (which is still currently in use) was released in 1968.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;first = holoviews.VLine(1963).opts(color="black", alpha=0.5)
first_label = holoviews.Text(1963 - 1, 27000, "Vaccine Introduced", halign="right")
current = holoviews.VLine(1968).opts(color="black", alpha=0.5)
current_label = holoviews.Text(1968 + 1, 27000, "Newer Vaccine", halign="left")
highest = holoviews.VLine(int(measles_by_year.idxmax())).opts(color="red")
highest_label = holoviews.Text(int(measles_by_year.idxmax()) + 1, 27000, "Year of the Most Cases", halign="left")
lowest = holoviews.VLine(int(measles_by_year.idxmin())).opts(color="blue", alpha=0.5)
lowest_label = holoviews.Text(int(measles_by_year.idxmin()) - 1, 27000, "Zero Cases", halign="right")

plot_2 = (plot 
	  * first * first_label 
	  * current * current_label 
	  * highest * highest_label 
	  * lowest * lowest_label)
Embed(plot_2, "measles_with_landmarks")()
&lt;/pre&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/measles_with_landmarks.js" id="332e76e1-349f-46d7-980d-2436faa41ad9"&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org9865249" class="outline-4"&gt;
&lt;h4 id="org9865249"&gt;Measles By State&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org9865249"&gt;
&lt;p&gt;
This creates a dropdown menu so we can see the states' measles cases separately. It doesn't work in this template so I'm saving it as a separate page.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;measles_by_state = diseases.groupby(["Year", "State"])["measles"].sum()
states_plot = measles_by_state.hvplot(x="Year", groupby="State", width=800, dynamic=False)
file_name = "measles_by_state.html"
holoviews.save(states_plot, OUTPUT_FOLDER.joinpath(file_name))
print("[[file:{}][Link to plot]]".format(file_name))
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
&lt;a href="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/measles_by_state.html"&gt;Link to plot&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org4668cc5" class="outline-4"&gt;
&lt;h4 id="org4668cc5"&gt;Oregon Vs Hawaii&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org4668cc5"&gt;
&lt;p&gt;
The addition sign is used to make plots next to each other.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;oregon_plot = states_plot["Oregon"].relabel("Oregon")
hawaii_plot = states_plot["Hawaii"].relabel("Hawaii")
plot = (oregon_plot * first * first_label * current * current_label
	+ hawaii_plot * first * first_label * current * current_label)
Embed(plot, "oregon_vs_hawaii")()
&lt;/pre&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/oregon_vs_hawaii.js" id="a5948eff-5cd0-4d97-89b6-53601ea84509"&gt;&lt;/script&gt;

&lt;p&gt;
I don't know why but the labels don't work. Surprisingly (to me), Hawaii had more cases and with huge swings. Perhaps since it's an island the sailors and other travelers introduced epidemics. Or maybe they weren't as good at keeping records back then.
&lt;/p&gt;

&lt;p&gt;
According to the &lt;a href="https://en.wikipedia.org/wiki/List_of_U.S._states_and_territories_by_historical_population"&gt;Census Count&lt;/a&gt; Oregon was quite a bit more populous than Hawaii.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org95b2ac3" class="outline-4"&gt;
&lt;h4 id="org95b2ac3"&gt;Four States&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org95b2ac3"&gt;
&lt;p&gt;
The four states nearest to Hawaii in population are (in descending order):
&lt;/p&gt;
&lt;ul class="org-ul"&gt;
&lt;li&gt;Montana&lt;/li&gt;
&lt;li&gt;Idaho&lt;/li&gt;
&lt;li&gt;Hawaii&lt;/li&gt;
&lt;li&gt;North Dakota&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hover = HoverTool(
    tooltips=[
	("Measles", "@measles{0,0}"),
	("Year", "@Year"),
	("State", "@State"),
    ],
    formatters={"measles": "numeral"},
)

states = ["Montana", "Idaho", "Hawaii", "North Dakota"]
start_year, end_year = 1930, 2005
plot = (measles_by_state.loc[start_year:end_year, states].hvplot(
    by="State",
    title="Measles 1930 - 2005",
    tools=[hover],
    width=800) 
	* first * first_label 
	* current * current_label)
Embed(plot, "four_states_measles")()
&lt;/pre&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/four_states_measles.js" id="0b88e38d-e38c-40b0-81ca-02eca28f6273"&gt;&lt;/script&gt;

&lt;p&gt;
Surprisingly Hawaii had the highest values in 1951 and 1955.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org30bd243" class="outline-4"&gt;
&lt;h4 id="org30bd243"&gt;Faceting&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org30bd243"&gt;
&lt;p&gt;
Another way to compare the states is to plot them side-by side.
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hover = HoverTool(
    tooltips=[
	("Measles", "@measles{0,0}"),
	("Year", "@Year"),
    ],
    formatters={"measles": "numeral"},
)

crosshairs = CrosshairTool()
plot = (measles_by_state.loc[start_year:end_year, states].hvplot(
    title="Measles By Year",
    x="Year", col="State", width=300, height=200, rot=90, tools=[crosshairs])
	* first * first_label * current * current_label)
Embed(plot, "faceted_measles_states")()
&lt;/pre&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/faceted_measles_states.js" id="cfb60145-6b0a-4e8b-b461-ea75dcdb8397"&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org3d89007" class="outline-3"&gt;
&lt;h3 id="org3d89007"&gt;Bar Chart&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org3d89007"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;plot = measles_by_state.loc[1960:1970, states].hvplot.bar(
    "Year",
    height=500,
    by="State", 
    rot=90)
Embed(plot, "measles_bar_chart")()
&lt;/pre&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/measles_bar_chart.js" id="7f9bdc94-8a69-4a66-b39c-50cecdf70d15"&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;div id="outline-container-org8377c53" class="outline-4"&gt;
&lt;h4 id="org8377c53"&gt;Nationwide Mean With Error Bars&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org8377c53"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;error = diseases.groupby("Year").agg({"measles": [numpy.mean, numpy.std]}).xs(
    "measles", axis=1)
plot = (error.hvplot(y="mean", title="Mean National Measles Cases By Year") 
	* holoviews.ErrorBars(error, "Year").redim.range(mean=(0, None)) 
	* first * first_label * current * current_label)
Embed(plot, "error_bars")()
&lt;/pre&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/error_bars.js" id="8078fe82-39bb-44e9-9f24-79d8ddb8ee1b"&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>pyviz</category><category>tutorial</category><guid>https://necromuralist.github.io/Visions-Voices-Data/posts/libraries/walking-through-the-pyviz-workflow-example/</guid><pubDate>Thu, 14 Mar 2019 19:48:04 GMT</pubDate></item></channel></rss>