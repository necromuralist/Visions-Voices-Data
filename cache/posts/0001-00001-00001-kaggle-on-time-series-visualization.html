<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org38558d3">Introduction</a></li>
<li><a href="#org79b9799">Set Up</a></li>
<li><a href="#orgc6d464f">The Data</a></li>
<li><a href="#orgf3030b0">Grouping</a></li>
<li><a href="#org4677b7c">Lag Plots</a></li>
<li><a href="#org46aa489">Autcorrelation Plot</a></li>
<li><a href="#orgc24f798">Cryptocurrency</a></li>
</ul>
</div>
</div>
<div id="outline-container-org38558d3" class="outline-2">
<h2 id="org38558d3">Introduction</h2>
<div class="outline-text-2" id="text-org38558d3">
<p>
This is a walk-through of the kaggle notebook on <a href="https://www.kaggle.com/residentmario/time-series-plotting-optional">Time-Series Plotting</a> by Aleksey Bilogur.
</p>
</div>
</div>
<div id="outline-container-org79b9799" class="outline-2">
<h2 id="org79b9799">Set Up</h2>
<div class="outline-text-2" id="text-org79b9799">
</div>
<div id="outline-container-orgf55cbd9" class="outline-3">
<h3 id="orgf55cbd9">Imports</h3>
<div class="outline-text-3" id="text-orgf55cbd9">
</div>
<div id="outline-container-org57addaf" class="outline-4">
<h4 id="org57addaf">From Python</h4>
<div class="outline-text-4" id="text-org57addaf">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
<div id="outline-container-orga5a7ed6" class="outline-4">
<h4 id="orga5a7ed6">From PyPi</h4>
<div class="outline-text-4" id="text-orga5a7ed6">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span><span class="p">,</span> <span class="n">lag_plot</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org3244ebc" class="outline-3">
<h3 id="org3244ebc">Plotting</h3>
<div class="outline-text-3" id="text-org3244ebc">
<div class="highlight"><pre><span></span><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span>
<span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s2">&quot;InlineBackend.figure_format = &#39;retina&#39;&quot;</span><span class="p">)</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span>
	    <span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;axes.grid&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
		<span class="s2">&quot;font.family&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sans-serif&quot;</span><span class="p">],</span>
		<span class="s2">&quot;font.sans-serif&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Open Sans&quot;</span><span class="p">,</span> <span class="s2">&quot;Latin Modern Sans&quot;</span><span class="p">,</span> <span class="s2">&quot;Lato&quot;</span><span class="p">],</span>
		<span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)},</span>
	    <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgf117d0f" class="outline-3">
<h3 id="orgf117d0f">Setup Libraries</h3>
<div class="outline-text-3" id="text-orgf117d0f">
<div class="highlight"><pre><span></span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;orgtbl&quot;</span><span class="p">)</span>
<span class="n">kaggle_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KAGGLE&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">kaggle_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orgc6d464f" class="outline-2">
<h2 id="orgc6d464f">The Data</h2>
<div class="outline-text-2" id="text-orgc6d464f">
</div>
<div id="outline-container-org0eb4cc2" class="outline-3">
<h3 id="org0eb4cc2">New York Stock Exchange Prices</h3>
<div class="outline-text-3" id="text-org0eb4cc2">
<div class="highlight"><pre><span></span><span class="n">nyse_path</span> <span class="o">=</span> <span class="n">kaggle_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;nyse/prices.csv&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">nyse_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<span class="n">nyse</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">nyse_path</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">nyse</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

<pre class="example">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 851264 entries, 0 to 851263
Data columns (total 7 columns):
date      851264 non-null datetime64[ns]
symbol    851264 non-null object
open      851264 non-null float64
close     851264 non-null float64
low       851264 non-null float64
high      851264 non-null float64
volume    851264 non-null float64
dtypes: datetime64[ns](1), float64(5), object(1)
memory usage: 45.5+ MB
</pre>

<div class="highlight"><pre><span></span><span class="n">nyse</span> <span class="o">=</span> <span class="n">nyse</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">nyse</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">date</th>
<th scope="col" class="org-left">symbol</th>
<th scope="col" class="org-right">open</th>
<th scope="col" class="org-right">close</th>
<th scope="col" class="org-right">low</th>
<th scope="col" class="org-right">high</th>
<th scope="col" class="org-right">volume</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">2016-01-05 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">123.43</td>
<td class="org-right">125.84</td>
<td class="org-right">122.31</td>
<td class="org-right">126.25</td>
<td class="org-right">2.1636e+06</td>
</tr>

<tr>
<td class="org-left">2016-01-06 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">125.24</td>
<td class="org-right">119.98</td>
<td class="org-right">119.94</td>
<td class="org-right">125.54</td>
<td class="org-right">2.3864e+06</td>
</tr>

<tr>
<td class="org-left">2016-01-07 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">116.38</td>
<td class="org-right">114.95</td>
<td class="org-right">114.93</td>
<td class="org-right">119.74</td>
<td class="org-right">2.4895e+06</td>
</tr>

<tr>
<td class="org-left">2016-01-08 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">115.48</td>
<td class="org-right">116.62</td>
<td class="org-right">113.5</td>
<td class="org-right">117.44</td>
<td class="org-right">2.0063e+06</td>
</tr>

<tr>
<td class="org-left">2016-01-11 00:00:00</td>
<td class="org-left">WLTW</td>
<td class="org-right">117.01</td>
<td class="org-right">114.97</td>
<td class="org-right">114.09</td>
<td class="org-right">117.33</td>
<td class="org-right">1.4086e+06</td>
</tr>
</tbody>
</table>

<p>
The notebook describes this as an example of a "strong" date case because the dates act as an explicit index for the data and are, in this case, an aggregate for a day of trading.
</p>
</div>

<div id="outline-container-org07c5094" class="outline-4">
<h4 id="org07c5094">UPS</h4>
<div class="outline-text-4" id="text-org07c5094">
<p>
Some of the correlational plots don't show anything meaningful when you use the market as a whole (I guess because different stocks are moving in different directions) so I'm going to pull out the UPS stock information to use later.
</p>

<div class="highlight"><pre><span></span><span class="n">ups</span> <span class="o">=</span> <span class="n">nyse</span><span class="p">[</span><span class="n">nyse</span><span class="o">.</span><span class="n">symbol</span><span class="o">==</span><span class="s2">&quot;UPS&quot;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">ups</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

<pre class="example">
(1762, 6)

</pre>
</div>
</div>
</div>

<div id="outline-container-org23c6883" class="outline-3">
<h3 id="org23c6883">Shelter Outcomes</h3>
<div class="outline-text-3" id="text-org23c6883">
<div class="highlight"><pre><span></span><span class="n">shelter_path</span> <span class="o">=</span> <span class="n">kaggle_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
    <span class="s2">&quot;austin-animal-center-shelter-outcomes/aac_shelter_outcomes.csv&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">shelter_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<span class="n">shelter</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">shelter_path</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;date_of_birth&quot;</span><span class="p">])</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">shelter</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

<pre class="example">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 78256 entries, 0 to 78255
Data columns (total 12 columns):
age_upon_outcome    78248 non-null object
animal_id           78256 non-null object
animal_type         78256 non-null object
breed               78256 non-null object
color               78256 non-null object
date_of_birth       78256 non-null datetime64[ns]
datetime            78256 non-null datetime64[ns]
monthyear           78256 non-null object
name                54370 non-null object
outcome_subtype     35963 non-null object
outcome_type        78244 non-null object
sex_upon_outcome    78254 non-null object
dtypes: datetime64[ns](2), object(10)
memory usage: 7.2+ MB
</pre>

<p>
Some of the columns are only identifiers (like a name) so we'll drop them to make it easier to inspect the data (although we aren't really going to do anything with it here anyway).
</p>

<div class="highlight"><pre><span></span><span class="n">shelter</span> <span class="o">=</span> <span class="n">shelter</span><span class="p">[[</span><span class="s2">&quot;outcome_type&quot;</span><span class="p">,</span> <span class="s2">&quot;age_upon_outcome&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
		   <span class="s2">&quot;animal_type&quot;</span><span class="p">,</span> <span class="s2">&quot;breed&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;sex_upon_outcome&quot;</span><span class="p">,</span>
		   <span class="s2">&quot;date_of_birth&quot;</span><span class="p">]]</span>
<span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">shelter</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">&#xa0;</th>
<th scope="col" class="org-left">outcome_type</th>
<th scope="col" class="org-left">age_upon_outcome</th>
<th scope="col" class="org-left">datetime</th>
<th scope="col" class="org-left">animal_type</th>
<th scope="col" class="org-left">breed</th>
<th scope="col" class="org-left">color</th>
<th scope="col" class="org-left">sex_upon_outcome</th>
<th scope="col" class="org-left">date_of_birth</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">Transfer</td>
<td class="org-left">2 weeks</td>
<td class="org-left">2014-07-22 16:04:00</td>
<td class="org-left">Cat</td>
<td class="org-left">Domestic Shorthair Mix</td>
<td class="org-left">Orange Tabby</td>
<td class="org-left">Intact Male</td>
<td class="org-left">2014-07-07 00:00:00</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">Transfer</td>
<td class="org-left">1 year</td>
<td class="org-left">2013-11-07 11:47:00</td>
<td class="org-left">Dog</td>
<td class="org-left">Beagle Mix</td>
<td class="org-left">White/Brown</td>
<td class="org-left">Spayed Female</td>
<td class="org-left">2012-11-06 00:00:00</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Adoption</td>
<td class="org-left">1 year</td>
<td class="org-left">2014-06-03 14:20:00</td>
<td class="org-left">Dog</td>
<td class="org-left">Pit Bull</td>
<td class="org-left">Blue/White</td>
<td class="org-left">Neutered Male</td>
<td class="org-left">2013-03-31 00:00:00</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">Transfer</td>
<td class="org-left">9 years</td>
<td class="org-left">2014-06-15 15:50:00</td>
<td class="org-left">Dog</td>
<td class="org-left">Miniature Schnauzer Mix</td>
<td class="org-left">White</td>
<td class="org-left">Neutered Male</td>
<td class="org-left">2005-06-02 00:00:00</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">Euthanasia</td>
<td class="org-left">5 months</td>
<td class="org-left">2014-07-07 14:04:00</td>
<td class="org-left">Other</td>
<td class="org-left">Bat Mix</td>
<td class="org-left">Brown</td>
<td class="org-left">Unknown</td>
<td class="org-left">2014-01-07 00:00:00</td>
</tr>
</tbody>
</table>

<p>
The notebook describes this as an example of a "weak" date case because the dates are only there for record-keeping and, while they might be significant for modeling, aren't acting as an index for the records.
</p>
</div>
</div>
<div id="outline-container-org11e0ceb" class="outline-3">
<h3 id="org11e0ceb">Cryptocurrency</h3>
<div class="outline-text-3" id="text-org11e0ceb">
<div class="highlight"><pre><span></span><span class="n">currency_path</span> <span class="o">=</span> <span class="n">kaggle_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;all-crypto-currencies/crypto-markets.csv&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">currency_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<span class="n">currency</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">currency_path</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
<span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orgf3030b0" class="outline-2">
<h2 id="orgf3030b0">Grouping</h2>
<div class="outline-text-2" id="text-orgf3030b0">
</div>
<div id="outline-container-org29089df" class="outline-3">
<h3 id="org29089df">Birth Dates</h3>
<div class="outline-text-3" id="text-org29089df">
<p>
Here's a plot of the birth dates of the animals in the shelter.
</p>

<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Count of Births By Date&quot;</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date of Birth&quot;</span><span class="p">)</span>
<span class="n">births</span> <span class="o">=</span> <span class="n">shelter</span><span class="o">.</span><span class="n">date_of_birth</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/births.png" alt="births.png" />
</p>
</div>


<div class="figure">
<p><img src="births.png" alt="births.png" />
</p>
</div>

<p>
It lools like there was an upward trend until about 2016 when it started to taper off, but since we're counting by days there's a lot of variance so we're going to group the data using pandas' <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.resample.html">resample</a> method. 
</p>

<p>
There's a couple of different ways to do this, but the simplest way is to take the count for each date using <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.value_counts.html">value_counts</a>. This will leave us with a <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.html">Series</a> with the dates in the index and the counts as values. Once we have this we can aggregate the dates by year and then count how many births there were per year.
</p>


<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">shelter</span><span class="o">.</span><span class="n">date_of_birth</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

<p>
2014-05-05    112
2015-09-01    110
2014-04-21    105
2015-04-28    104
2016-05-01    102
</p>

<div class="highlight"><pre><span></span><span class="n">year_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">year_counts</span><span class="p">)</span>
</pre></div>

<pre class="example">
DatetimeIndexResampler [freq=&lt;YearEnd: month=12&gt;, axis=0, closed=right, label=right, convention=start, base=0]

</pre>

<p>
Note that this is an aggregator, we don't get what we want until we call a method (like <code>count</code>) on it. In this case since we have value counts we want to sum all of the counts for a year (so we need <code>sum</code>).
</p>

<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sums</span> <span class="o">=</span> <span class="n">year_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">last</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Births Per Year ({} - {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
						   <span class="n">last</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
		<span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">))</span>
<span class="n">peak</span> <span class="o">=</span> <span class="n">sums</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">axe</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">peak</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>

<span class="n">plotted</span> <span class="o">=</span> <span class="n">sums</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">lim</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/births_by_year.png" alt="births_by_year.png" />
</p>
</div>


<div class="figure">
<p><img src="births_by_year.png" alt="births_by_year.png" />
</p>
</div>

<p>
An alternative way to look at this would be a lollipop plot.
</p>

<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Births Per Year ({} - {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
						   <span class="n">last</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
		<span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">x_labels</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">year</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sums</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
<span class="n">peak_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_labels</span><span class="p">[</span><span class="n">x_labels</span><span class="o">==</span><span class="n">peak</span><span class="o">.</span><span class="n">year</span><span class="p">])</span>
<span class="n">axe</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">peak_index</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;{} (Peak Year)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peak</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
<span class="n">stems</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x_labels</span><span class="p">,</span> <span class="n">sums</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">figure</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/births_lollipop.png" alt="births_lollipop.png" />
</p>
</div>


<div class="figure">
<p><img src="births_lollipop.png" alt="births_lollipop.png" />
</p>
</div>

<p>
There's something funny going on with the dates, passing in the index instead of a list of years shifts all the years to the left by one (what's 2015 on the plot above would be 2016). I don't know what's doing this.
</p>
</div>
</div>

<div id="outline-container-org464ceae" class="outline-3">
<h3 id="org464ceae">Outcomes</h3>
<div class="outline-text-3" id="text-org464ceae">
<p>
While knowing the birthdates of the animals in the shelter is interesting, what about the dates when their cases were resolved?
</p>

<div class="highlight"><pre><span></span><span class="n">outcome_counts</span> <span class="o">=</span> <span class="n">shelter</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">outcomes</span> <span class="o">=</span> <span class="n">outcome_counts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">outcome_counts</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

<pre class="example">
2016-04-18    39
2015-08-11    25
2017-10-17    25
2015-11-17    22
2015-07-02    22
Name: datetime, dtype: int64

</pre>


<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">x_labels</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">year</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sums</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Outcomes Per Year&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">stems</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">outcomes</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Outcome&quot;</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">sums</span><span class="p">,</span> <span class="s2">&quot;r.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Births&quot;</span><span class="p">)</span>
<span class="c1"># axe.set_xticklabels(x_labels)</span>
<span class="n">figure</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/outcomes.png" alt="outcomes.png" />
</p>
</div>


<div class="figure">
<p><img src="outcomes.png" alt="outcomes.png" />
</p>
</div>

<p>
So, we've re-introduced the messed up dates on the x-axis (I kind of tried to fix it but gave up), but, ignoring the actual years you can see that there are only six years of adoption outcomes although there are sixteen years of birth dates.
</p>
</div>
</div>

<div id="outline-container-org5e0a223" class="outline-3">
<h3 id="org5e0a223">Trading Volume</h3>
<div class="outline-text-3" id="text-org5e0a223">
<p>
The previous plot was a count-plot. You can also use other summary-statistics like a mean to see how things changed over time.
</p>

<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">nyse</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Mean NYSE Trading Volume Per Year&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">stem</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">means</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">means</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/volume.png" alt="volume.png" />
</p>
</div>


<div class="figure">
<p><img src="volume.png" alt="volume.png" />
</p>
</div>

<p>
I tried putting standard deviations in there too but the values are so big it squashed the means.
</p>
</div>
</div>
</div>

<div id="outline-container-org4677b7c" class="outline-2">
<h2 id="org4677b7c">Lag Plots</h2>
<div class="outline-text-2" id="text-org4677b7c">
<p>
The <a href="https://pandas.pydata.org/pandas-docs/stable/visualization.html#lag-plot">Lag Plot</a> helps you check if there is a significance to the ordering of the data. You are plotting the value in the inputs vs the next value (e.g. one day against the following day). If there is no significance to the ordering then the plot will look random.
</p>

<div class="highlight"><pre><span></span><span class="n">volume</span> <span class="o">=</span> <span class="n">nyse</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;NYSE Volume Lag Plot&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">subplot</span> <span class="o">=</span> <span class="n">lag_plot</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">365</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/lag_plot.png" alt="lag_plot.png" />
</p>
</div>


<div class="figure">
<p><img src="lag_plot.png" alt="lag_plot.png" />
</p>
</div>

<p>
So, the center points do seem to show a relationship, as the next-days volume goes up along with the previous day's volume, but I don't know what those bands around 0 are. One thing I noticed is that there are holidays in the data.
</p>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">])</span>
</pre></div>

<pre class="example">
2016-12-25 00:00:00

</pre>

<p>
And there are also weekends in there.
</p>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%a&quot;</span><span class="p">))</span>
</pre></div>

<pre class="example">
Sun

</pre>

<p>
So it's likely that there are days in there where there was no trading and so they won't correlate with the days that preceded the start of a break or the ones that followed the end of a break. I think. I don't really know if there's trading all year round.
</p>

<div class="highlight"><pre><span></span><span class="n">volume_sums</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">volume_sums</span><span class="p">[</span><span class="n">volume_sums</span><span class="o">==</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">day</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%a&quot;</span><span class="p">),</span> <span class="n">day</span><span class="p">))</span>
</pre></div>

<pre class="example">
Sat 2016-12-03 00:00:00
Sun 2016-12-04 00:00:00
Sat 2016-12-10 00:00:00
Sun 2016-12-11 00:00:00
Sat 2016-12-17 00:00:00
Sun 2016-12-18 00:00:00
Sat 2016-12-24 00:00:00
Sun 2016-12-25 00:00:00
Mon 2016-12-26 00:00:00

</pre>

<p>
So it does look like the zeros are weekends and holidays.
</p>
</div>

<div id="outline-container-org0bd1ebe" class="outline-3">
<h3 id="org0bd1ebe">UPS</h3>
<div class="outline-text-3" id="text-org0bd1ebe">
<p>
Here's what just the UPS trading volumes look like.
</p>
<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;UPS Trading Volume Lag Plot&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">subplot</span> <span class="o">=</span> <span class="n">lag_plot</span><span class="p">(</span><span class="n">ups</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/ups_lag_plot.png" alt="ups_lag_plot.png" />
</p>
</div>


<div class="figure">
<p><img src="ups_lag_plot.png" alt="ups_lag_plot.png" />
</p>
</div>

<p>
I don't know why but that makes it look better. I guess the market as a whole doesn't move quite so well together day by day as a single stock does.
</p>
</div>
</div>
</div>
<div id="outline-container-org46aa489" class="outline-2">
<h2 id="org46aa489">Autcorrelation Plot</h2>
<div class="outline-text-2" id="text-org46aa489">
<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;UPS Trading Volume Daily Autocorrelation&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">subplot</span> <span class="o">=</span> <span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">ups</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/autocorrelation.png" alt="autocorrelation.png" />
</p>
</div>


<div class="figure">
<p><img src="autocorrelation.png" alt="autocorrelation.png" />
</p>
</div>

<p>
This plot shows the lag in relationship to correlation over different lag intervals. It looks like up to about 500 days of lag the correlation is positive but it starts to become more negative after that.  The horizontal lines are the confidence intervals - the solid grey lines are the 95 % interval and the dashed grey lines are the 99% interval. The points that fall outside of these intervals are statistically significant.
</p>
</div>
</div>
<div id="outline-container-orgc24f798" class="outline-2">
<h2 id="orgc24f798">Cryptocurrency</h2>
<div class="outline-text-2" id="text-orgc24f798">
</div>
<div id="outline-container-org85fcc31" class="outline-3">
<h3 id="org85fcc31">Lag Plot</h3>
<div class="outline-text-3" id="text-org85fcc31">
<div class="highlight"><pre><span></span><span class="n">crypto_daily</span> <span class="o">=</span> <span class="n">currency</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Cryptocurrency Volume Lag Plot&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">subplot</span> <span class="o">=</span> <span class="n">lag_plot</span><span class="p">(</span><span class="n">crypto_daily</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/crypto_lag.png" alt="crypto_lag.png" />
</p>
</div>


<div class="figure">
<p><img src="crypto_lag.png" alt="crypto_lag.png" />
</p>
</div>

<p>
Unlike the stock-exchange, the cryptocurrencies seem to move together.
</p>
</div>
</div>

<div id="outline-container-org526529a" class="outline-3">
<h3 id="org526529a">Autocorrelation Plot</h3>
<div class="outline-text-3" id="text-org526529a">
<div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Cryptocurrency Auto Correlation&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">dogecoin</span> <span class="o">=</span> <span class="n">currency</span><span class="p">[</span><span class="n">currency</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s2">&quot;Dogecoin&quot;</span><span class="p">]</span>
<span class="n">subplot</span> <span class="o">=</span> <span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">dogecoin</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="../files/posts/kaggle-on-time-series-visualization/currency_autocorrelation.png" alt="currency_autocorrelation.png" />
</p>
</div>


<div class="figure">
<p><img src="currency_autocorrelation.png" alt="currency_autocorrelation.png" />
</p>
</div>

<p>
If my understanding of how this plot works is correct, there is some kind of significance to lags of 125 and 250 days. Is this really true? I don't know.
</p>
</div>
</div>
</div>
