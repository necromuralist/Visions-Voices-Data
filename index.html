<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Adumbrations of data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Visions, Voices, Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Visions-Voices-Data/" rel="canonical">
<link href="index-8.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script><!--
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"
</script>
-->
<script async src="javascript/p5.min.js" type="text/javascript"></script>
<link href="/posts/geopandas-and-portland-neighborhoods/" rel="prefetch" type="text/html">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="/"><span id="blog-title">Visions, Voices, Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Pages</a>
<div class="dropdown-menu"><a class="dropdown-item active" href="/">Cloistered Monkey <span class="sr-only">(active)</span></a> <a class="dropdown-item" href="/pages/giss/giss-yearly-anomalies-by-climate-zone">GISS Anomalies</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Visions-Voices-Data/"> <input name="k8" type="hidden" value="#444444"> <input name="k9" type="hidden" value="#D51920"> <input name="kt" type="hidden" value="h"> <input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"> <input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/geopandas-and-portland-neighborhoods/">GeoPandas and Portland Neighborhoods</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/geopandas-and-portland-neighborhoods/" rel="bookmark"><time class="published dt-published" datetime="2021-12-29T12:57:26-08:00" itemprop="datePublished" title="2021-12-29 12:57">2021-12-29 12:57</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#orgc5bed39">Prelude: The Lastest GeoPandas Debacle</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org28c903a">Beginning</a>
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org82b906d">Imports</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org4decd36">Set Up</a>
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org24c9a26">Plotting</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#orgdadf6ef">Configurations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org42af186">The Neighborhoods</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#orge057bf7">Plot</a>
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org9717a84">Try Altair</a></li>
</ul>
</li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#orgf462553">Some Stuff To Check Out</a>
<ul>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org676453f">Portland Open Data</a></li>
<li><a href="/posts/geopandas-and-portland-neighborhoods/#org57e9d07">Other Interesting Sites</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgc5bed39">
<h2 id="orgc5bed39">Prelude: The Lastest GeoPandas Debacle</h2>
<div class="outline-text-2" id="text-orgc5bed39">
<p>As I noted in a <a href="/posts/geopandas-revisited/">previous post</a> you can't just install <a href="https://geopandas.org/">geopandas</a> and <a href="https://geoviews.org/#">geoviews</a> you also need to install <a href="https://scitools.org.uk/cartopy/docs/v0.17/index.html">cartopy</a>, but <code>cartopy</code> <a href="https://github.com/SciTools/cartopy/issues/1879">currently requires version 8</a> of <a href="https://proj.org/">proj</a> while the stable versions of <code>debian</code> and <code>ubuntu</code> both have version 7.2. I originally tried to download the (unstable) <code>.deb</code> files and install them, but <code>libproj-dev</code> requires <code>libproj22</code> which requires a newer version of the C++ libraries than is currently in debian-stable… and at that point I decided to give up on it and run everything on <a href="https://wiki.debian.org/DebianBookworm">debian bookworm</a> (currently in testing) which has the newer versions of the stuff you need for cartopy.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org28c903a">
<h2 id="org28c903a">Beginning</h2>
<div class="outline-text-2" id="text-org28c903a">
<p>This is going to be a simple plot of Portland neighborhods using GeoPandas/GeoJSON. I started doing this post to get Portland Crime Data mapped to the neighborhoods, which is what they (the Portland Police Bureau) uses, but it wasn't as straightforward as I though it'd be so I'm pulling it out here to see if I can keep it simpler for future reference.</p>
</div>
<div class="outline-3" id="outline-container-org82b906d">
<h3 id="org82b906d">Imports</h3>
<div class="outline-text-3" id="text-org82b906d">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">geoviews</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org4decd36">
<h3 id="org4decd36">Set Up</h3>
<div class="outline-text-3" id="text-org4decd36"></div>
<div class="outline-4" id="outline-container-org24c9a26">
<h4 id="org24c9a26">Plotting</h4>
<div class="outline-text-4" id="text-org24c9a26">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"geopandas-and-portland-neighborhoods"</span>
<span class="n">OUTPUT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">OUTPUT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgdadf6ef">
<h4 id="orgdadf6ef">Configurations</h4>
<div class="outline-text-4" id="text-orgdadf6ef">
<p>This holds were the data files are (or their URLs).</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"configurations/data.yaml"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">configuration</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">reader</span><span class="p">)[</span><span class="s2">"portland"</span><span class="p">][</span><span class="s2">"neighborhoods"</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org42af186">
<h2 id="org42af186">The Neighborhoods</h2>
<div class="outline-text-2" id="text-org42af186">
<p>Now we can load the data.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">configuration</span><span class="p">[</span><span class="s2">"folder"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">geojson_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="n">configuration</span><span class="p">[</span><span class="s2">"geojson"</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

<span class="k">if</span> <span class="n">geojson_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
    <span class="n">neighborhoods</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geojson_file</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">neighborhoods</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">configuration</span><span class="p">[</span><span class="s2">"geojson-url"</span><span class="p">])</span>
    <span class="n">neighborhoods</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">geojson_file</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">"GeoJSON"</span><span class="p">)</span>
</pre></div>
<p>Since I'm going to use the names of the neighborhoods I'll rename the column that holds them to something clearer (to me).</p>
<div class="highlight">
<pre><span></span><span class="n">neighborhoods</span> <span class="o">=</span> <span class="n">neighborhoods</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">MAPLABEL</span><span class="o">=</span><span class="s2">"Neighborhood"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orge057bf7">
<h2 id="orge057bf7">Plot</h2>
<div class="outline-text-2" id="text-orge057bf7">
<p>Now we'll do the actual plot.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">neighborhoods</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">hover_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">"Neighborhood"</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Portland Neighborhoods"</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">"hover"</span><span class="p">])</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"neighborhood_plot"</span><span class="p">)()</span>
</pre></div>
<object data="/posts/geopandas-and-portland-neighborhoods/neighborhood_plot.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
<div class="outline-3" id="outline-container-org9717a84">
<h3 id="org9717a84">Try Altair</h3>
<div class="outline-text-3" id="text-org9717a84">
<p>This was taken from <a href="https://stackoverflow.com/questions/55923300/how-can-i-make-a-map-using-geojson-data-in-altair">this Stack Overflow post</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">configuration</span><span class="p">[</span><span class="s2">"geojson-url"</span><span class="p">],</span>
                   <span class="nb">format</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">(</span><span class="nb">property</span><span class="o">=</span><span class="s2">"features"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"json"</span><span class="p">))</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">neighborhoods</span><span class="p">)</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Neighborhood:N"</span>
 <span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span> <span class="n">reflectY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
     <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
     <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
     <span class="n">title</span><span class="o">=</span><span class="s2">"Portland Neighborhoods (Altair)"</span><span class="p">,</span>
 <span class="p">)</span>

<span class="n">chart</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">OUTPUT</span><span class="o">/</span><span class="s2">"portland_neighborhoods_altair.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/geopandas-and-portland-neighborhoods/portland_neighborhoods_altair.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Looking at <a href="https://github.com/altair-viz/altair/issues/679">this bug report</a> for altair, it appears that vega-lite doesn't support an interactive map so it seems like it'd be better to stick with GeoPandas for now.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf462553">
<h2 id="orgf462553">Some Stuff To Check Out</h2>
<div class="outline-text-2" id="text-orgf462553">
<p>I ran into these while looking for the neighborhood data, maybe I'll check them out later.</p>
</div>
<div class="outline-3" id="outline-container-org676453f">
<h3 id="org676453f">Portland Open Data</h3>
<div class="outline-text-3" id="text-org676453f">
<p>To get the boundary information, click on the Boundaries Icon and find the dataset you want in the list that comes up. Once you're on the map, to get the dataset you need to click on a little bar at the bottom-left that says "I want to use this" which will change the user-interface. Click on the "View API Resources" tab and it will bring up two URLs, one of which is a GeoJSON link.</p>
<ul class="org-ul">
<li><a href="https://gis-pdx.opendata.arcgis.com/">Portland Open Data</a>: has the links to different map data.</li>
<li><a href="https://gis-pdx.opendata.arcgis.com/datasets/PDX::pbot-equity-index/about">Portland Equity Index</a>: Has census population, income, and ethnicity information.</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org57e9d07">
<h3 id="org57e9d07">Other Interesting Sites</h3>
<div class="outline-text-3" id="text-org57e9d07">
<ul class="org-ul">
<li><a href="https://guides.library.pdx.edu/c.php?g=271294&amp;p=1811001">PSU Library's Page With Links</a> to Statistical and Census Data</li>
<li><a href="https://www.pdx.edu/population-research/census-data-oregon">PSU's Population Research Census Data</a></li>
</ul>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/looking-at-portland-crime-data/">Looking at Portland Crime Data</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/looking-at-portland-crime-data/" rel="bookmark"><time class="published dt-published" datetime="2021-12-25T17:53:29-08:00" itemprop="datePublished" title="2021-12-25 17:53">2021-12-25 17:53</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/looking-at-portland-crime-data/#orgd727be9">Beginning</a>
<ul>
<li><a href="/posts/looking-at-portland-crime-data/#org284687a">Imports</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#orgc41ad0b">Set Up</a>
<ul>
<li><a href="/posts/looking-at-portland-crime-data/#org31c8c04">The Plot Path</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org6163e14">The Table Printer</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org200ec18">The Configuration</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org2c5e1ea">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/looking-at-portland-crime-data/#org1902f15">The Metadata</a></li>
</ul>
</li>
<li><a href="/posts/looking-at-portland-crime-data/#org57e129c">The Data</a>
<ul>
<li><a href="/posts/looking-at-portland-crime-data/#org3dfcffe">Dates and Times</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org57c2326">Times</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org78d30f4">Address</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org1d03557">Case Number</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#orgffa9a9c">By Category</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org73878f6">Offense Type</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org05cdd00">Neighborhood</a></li>
<li><a href="/posts/looking-at-portland-crime-data/#org02ea18e">By Date</a>
<ul>
<li><a href="/posts/looking-at-portland-crime-data/#org3b5e8dd">By Year</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/looking-at-portland-crime-data/#orgfd213e2">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgd727be9">
<h2 id="orgd727be9">Beginning</h2>
<div class="outline-text-2" id="text-orgd727be9"></div>
<div class="outline-3" id="outline-container-org284687a">
<h3 id="org284687a">Imports</h3>
<div class="outline-text-3" id="text-org284687a">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc41ad0b">
<h3 id="orgc41ad0b">Set Up</h3>
<div class="outline-text-3" id="text-orgc41ad0b"></div>
<div class="outline-4" id="outline-container-org31c8c04">
<h4 id="org31c8c04">The Plot Path</h4>
<div class="outline-text-4" id="text-org31c8c04">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/pathlib.html">pathlib</a></li>
<li><a href="https://docs.python.org/3/library/pathlib.html">Path.is_dir</a></li>
<li><a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.mkdir">Path.mkdir</a></li>
</ul>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"looking-at-portland-crime-data"</span>
<span class="n">PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">PATH</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">PATH</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org6163e14">
<h4 id="org6163e14">The Table Printer</h4>
<div class="outline-text-4" id="text-org6163e14">
<ul class="org-ul">
<li><a href="https://pypi.org/project/tabulate/">tabulate</a></li>
</ul>
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_table</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org200ec18">
<h4 id="org200ec18">The Configuration</h4>
<div class="outline-text-4" id="text-org200ec18">
<ul class="org-ul">
<li><a href="https://pyyaml.org/">pyyaml</a></li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"configurations/data.yaml"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">configuration</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>

<span class="n">portland</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">[</span><span class="s2">"portland"</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org2c5e1ea">
<h4 id="org2c5e1ea">Set Up</h4>
<div class="outline-text-4" id="text-org2c5e1ea">
<div class="highlight">
<pre><span></span><span class="n">COUNT_COLUMN</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"CaseNumber"</span><span class="p">:</span> <span class="s2">"Count"</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org1902f15">
<h3 id="org1902f15">The Metadata</h3>
<div class="outline-text-3" id="text-org1902f15">
<ul class="org-ul">
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_html.html">pandas.read_html()</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html">pandas.read_csv</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html">pandas.to_csv</a></li>
</ul>
<div class="highlight">
<pre><span></span><span class="n">metadata_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">portland</span><span class="p">[</span><span class="s2">"crime-metadata"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">metadata_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">portland</span><span class="p">[</span><span class="s2">"crime-metadata-url"</span><span class="p">],</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s2">"Column Description"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"Description"</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Description</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">print_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column</th>
<th class="org-left" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Case Number</td>
<td class="org-left">The case year and number for the reported incident (YY-######).Sensitive cases have been randomly assigned a case number and are denoted by an X following the case year (YY-X######).</td>
</tr>
<tr>
<td class="org-left">Occur Month Year</td>
<td class="org-left">The Month and Year that the incident occured.</td>
</tr>
<tr>
<td class="org-left">Occur Date</td>
<td class="org-left">Date the incident occurred. The exact occur date is sometimes unknown. In most situations, the first possible date the crime could have occurred is used as the occur date.&nbsp;(For example, victims return home from a week-long vacation to find their home burglarized. The burglary could have occurred at any point during the week. The first date of their vacation would be listed as the occur date.)</td>
</tr>
<tr>
<td class="org-left">Occur Time</td>
<td class="org-left">Time the incident occured. The exact occur time is sometimes unknown. In most situations, the first possible time the crime could have occured is used as the occur time.The time is reported in the 24-hour clock format, with the first two digits representing hour (ranges from 00 to 23) and the second two digits representing minutes (ranges from 00 to 59).Note: By default, Microsoft Excel removes leading zeroes when importing data. For more help with this issue, refer to&nbsp;Microsoft's help page.</td>
</tr>
<tr>
<td class="org-left">Address</td>
<td class="org-left">Address of reported incident at the 100 block level (e.g.: 1111 SW 2nd Ave would be 1100 Block SW 2nd Ave).To protect the identity of victims and other privacy concerns, the address location of certain case types are not released.</td>
</tr>
<tr>
<td class="org-left">Open Data X / Y</td>
<td class="org-left">Generalized XY point of the reported incident. For offenses that occurred at a specific address, the point is mapped to the block's midpoint. Offenses that occurred at an intersection is mapped to the intersection centroid.&nbsp;To protect the identity of victims and other privacy concerns, the points of certain case types are not released.XY points use the Oregon State Plane North (3601), NAD83 HARN, US International Feet&nbsp;coordinate system.</td>
</tr>
<tr>
<td class="org-left">Open Data Lat / Lon</td>
<td class="org-left">Generalized Latitude / Longitude of the reported incident.&nbsp;For offenses that occurred at a specific address, the point is mapped to the block's midpoint. Offenses that occurred at an intersection is mapped to the intersection centroid.&nbsp;To protect the identity of victims and other privacy concerns, the points of certain case types are not released.</td>
</tr>
<tr>
<td class="org-left">Neighborhood</td>
<td class="org-left">Neighborhood where incident occurred.If the neighborhood name is missing, the incident occurred outside of the boundaries of the Portland neighborhoods or at a location that could not be assigned to a specific address in the system (e.g., Portland, near Washington Park, on the streetcar, etc.). Note: Neighborhood boundaries and designations vary slightly from those found on the Office of Community & Civic Life website.</td>
</tr>
<tr>
<td class="org-left">Crime Against</td>
<td class="org-left">Crime against category (Person, Property, or Society)</td>
</tr>
<tr>
<td class="org-left">Offense Category</td>
<td class="org-left">Category of offense (for example, Assault Offenses)</td>
</tr>
<tr>
<td class="org-left">Offense Type</td>
<td class="org-left">Type of offense (for example, Aggravated Assault)Note: The statistic for Homicide Offenses has been updated in the Group A Crimes report to align with the 2019 FBI NIBRS definitions. The statistic for Homicide Offenses includes (09A) Murder & Non-negligent Manslaughter and (09B) Negligent Manslaughter. As of January 1, 2019, the FBI expanded the definition of negligent manslaughter to include traffic fatalities that result in an arrest for driving under the influence, distracted driving, or reckless driving. The change in definition impacts the 2019 homicide offenses statistic and the comparability of 2019 homicide statistics to prior year.</td>
</tr>
<tr>
<td class="org-left">Offense Count</td>
<td class="org-left">Number of offenses&nbsp;per incident. Offenses (i.e. this field)&nbsp;are summed for counting purposes.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org57e129c">
<h2 id="org57e129c">The Data</h2>
<div class="outline-text-2" id="text-org57e129c">
<ul class="org-ul">
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html">Path.expanduser</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html">Path.glob</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html">pandas.concat</a></li>
</ul>
<div class="highlight">
<pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">portland</span><span class="p">[</span><span class="s2">"crime"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">data_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">portland</span><span class="p">[</span><span class="s2">"crime-glob"</span><span class="p">]))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">print_table</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Address</th>
<th class="org-right" scope="col">CaseNumber</th>
<th class="org-left" scope="col">CrimeAgainst</th>
<th class="org-left" scope="col">Neighborhood</th>
<th class="org-left" scope="col">OccurDate</th>
<th class="org-right" scope="col">OccurTime</th>
<th class="org-left" scope="col">OffenseCategory</th>
<th class="org-left" scope="col">OffenseType</th>
<th class="org-right" scope="col">OpenDataLat</th>
<th class="org-right" scope="col">OpenDataLon</th>
<th class="org-left" scope="col">ReportDate</th>
<th class="org-right" scope="col">OffenseCount</th>
<th class="org-right" scope="col">OpenDataX</th>
<th class="org-right" scope="col">OpenDataY</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">nan</td>
<td class="org-right">21-X5543818</td>
<td class="org-left">Person</td>
<td class="org-left">Concordia</td>
<td class="org-left">12/31/2020</td>
<td class="org-right">1230</td>
<td class="org-left">Assault Offenses</td>
<td class="org-left">Aggravated Assault</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
<td class="org-left">1/1/2021</td>
<td class="org-right">1</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">nan</td>
<td class="org-right">21-X5543818</td>
<td class="org-left">Property</td>
<td class="org-left">Concordia</td>
<td class="org-left">12/31/2020</td>
<td class="org-right">1230</td>
<td class="org-left">Larceny Offenses</td>
<td class="org-left">All Other Larceny</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
<td class="org-left">1/1/2021</td>
<td class="org-right">1</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">nan</td>
<td class="org-right">21-X5543827</td>
<td class="org-left">Person</td>
<td class="org-left">Pearl</td>
<td class="org-left">1/1/2021</td>
<td class="org-right">715</td>
<td class="org-left">Assault Offenses</td>
<td class="org-left">Simple Assault</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
<td class="org-left">1/1/2021</td>
<td class="org-right">1</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">nan</td>
<td class="org-right">21-X5543859</td>
<td class="org-left">Person</td>
<td class="org-left">Centennial</td>
<td class="org-left">1/1/2021</td>
<td class="org-right">2013</td>
<td class="org-left">Assault Offenses</td>
<td class="org-left">Aggravated Assault</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
<td class="org-left">1/1/2021</td>
<td class="org-right">1</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-right">nan</td>
<td class="org-right">21-X5543864</td>
<td class="org-left">Person</td>
<td class="org-left">Powellhurst-Gilbert</td>
<td class="org-left">1/1/2021</td>
<td class="org-right">816</td>
<td class="org-left">Assault Offenses</td>
<td class="org-left">Simple Assault</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
<td class="org-left">1/1/2021</td>
<td class="org-right">1</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
390,824
</pre></div>
<div class="outline-3" id="outline-container-org3dfcffe">
<h3 id="org3dfcffe">Dates and Times</h3>
<div class="outline-text-3" id="text-org3dfcffe">
<p>Although these columns aren't the first ones, since they might be useful when looking at the other columns I thought I'd parse them first.</p>
<ul class="org-ul">
<li>Python Time Formats: <a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior">https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior</a></li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org57c2326">
<h3 id="org57c2326">Times</h3>
<div class="outline-text-3" id="text-org57c2326">
<p>Our first problem is that there's a bunch of times labeled "0" which doesn't match the formatting of the rest of the times. This might represent missing data, unknown data, or 0-o'clock (midnight). The documentation doesn't really say, although it does say that when the time isn't known it uses the earliest possible time, which would seem to be midnight, so that's what I'll assume it is.</p>
<div class="highlight">
<pre><span></span><span class="n">TIME</span> <span class="o">=</span> <span class="s2">"%H%M"</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"OccurTime"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">OccurTime</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">time</span><span class="p">:</span> <span class="s2">"0000"</span> <span class="k">if</span> <span class="n">time</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">time</span><span class="si">:</span><span class="s2">04</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">"Occured At"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OccurTime</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">TIME</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">crime_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"Occured At"</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">crime_time</span> <span class="o">=</span> <span class="n">crime_time</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">COUNT_COLUMN</span><span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">crime_time</span><span class="p">[[</span><span class="s2">"Occured At"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">]])</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Occured At"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Occured At"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Time of Crime"</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">chart</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"crime_time.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/crime_time.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Since the times are mostly self-reported I'd assume that the spikes at midnight and noon are just convenient pegs for guessing the time.</p>
<div class="highlight">
<pre><span></span><span class="n">DATE</span> <span class="o">=</span> <span class="s2">"%m/</span><span class="si">%d</span><span class="s2">/%Y"</span>

<span class="n">data</span><span class="p">[</span><span class="s2">"Occurred"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OccurDate</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">DATE</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"Reported"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ReportDate</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">DATE</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s2">"Year Occured"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Occurred</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"Year Reported"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Reported</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">crime_year</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"Year Reported"</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">crime_year</span> <span class="o">=</span> <span class="n">crime_year</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">COUNT_COLUMN</span><span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">crime_year</span><span class="p">[[</span><span class="s2">"Year Reported"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">]])</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Year Reported"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Year Reported"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Crime by Year"</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">chart</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"crime_year.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/crime_year.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org78d30f4">
<h3 id="org78d30f4">Address</h3>
<div class="outline-text-3" id="text-org78d30f4">
<p>Not all addresses are given, some are omitted if the case is considered sensitive. I'll look at those in the next section on "Case Number", but since we're here, let's look at what type of crime, based on who the victim is, is considered too sensitive to report the address.</p>
<p>The method to force a side-by-side bar plot came from this <a href="https://github.com/altair-viz/altair/issues/2002">github bug report</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"Addressed"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">"Addressed"</span><span class="p">],</span> <span class="s2">"Addressed"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Missing"</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">"Addressed"</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"Missing"</span><span class="p">,</span> <span class="s2">"Addressed"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Has Address"</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span> <span class="s2">"Addressed"</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">COUNT_COLUMN</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[[</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span> <span class="s2">"Addressed"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">]]</span>
<span class="n">addressed_chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>

<span class="n">crime_against</span> <span class="o">=</span> <span class="n">addressed_chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span>
                         <span class="n">spacing</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                         <span class="n">header</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Header</span><span class="p">(</span><span class="n">labelOrient</span><span class="o">=</span><span class="s2">"bottom"</span><span class="p">)),</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Addressed:N"</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="s2">"Missing"</span><span class="p">,</span> <span class="s2">"Has Address"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Addressed:N"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Victim of a Crime with an Address"</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">275</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">crime_against</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"addressed_crime_against.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/addressed_crime_against.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org1d03557">
<h3 id="org1d03557">Case Number</h3>
<div class="outline-text-3" id="text-org1d03557">
<p>This is a unique identifier for each case. It doesn't seem like this would be interesting unless you wanted to look up a specific incident, but one possibly useful bit is that the case numbers are given a prefix of "X" if they are sensitive (by case number I mean just the number section - i.e. <code>&lt;year&gt;-X&lt;case number&gt;</code>), which might be useful in figuring out the reason for missing location data.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">"CaseNumber"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">CaseNumber</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"string"</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"Sensitive"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">CaseNumber</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"Sensitive"</span><span class="p">,</span> <span class="s2">"Year Reported"</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">COUNT_COLUMN</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">grouped</span><span class="p">[[</span><span class="s2">"Count"</span><span class="p">,</span> <span class="s2">"Sensitive"</span><span class="p">,</span> <span class="s2">"Year Reported"</span><span class="p">]])</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sensitive:O"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">"Year Reported:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Sensitive"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">,</span> <span class="s2">"Year Reported"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Count of Sensitive Cases"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">600</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">chart</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"sensitive_case_count.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/sensitive_case_count.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-orgffa9a9c">
<h3 id="orgffa9a9c">By Category</h3>
<div class="outline-text-3" id="text-orgffa9a9c">
<div class="highlight">
<pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span> <span class="s2">"OffenseCategory"</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">COUNT_COLUMN</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">grouped</span><span class="p">)</span>

<span class="n">categories</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"CrimeAgainst:O"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"OffenseCategory"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">,</span> <span class="s2">"OffenseCategory"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Crime Category by Victim Type"</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">categories</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"category_crime_against.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/category_crime_against.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org73878f6">
<h3 id="org73878f6">Offense Type</h3>
<div class="outline-text-3" id="text-org73878f6">
<div class="highlight">
<pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span> <span class="s2">"OffenseCategory"</span><span class="p">,</span> <span class="s2">"OffenseType"</span><span class="p">]</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"CaseNumber"</span><span class="p">:</span> <span class="s2">"Count"</span><span class="p">})</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">grouped</span><span class="p">[</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"Count"</span><span class="p">]])</span>

<span class="n">categories</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"OffenseCategory:O"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"OffenseType"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span> <span class="s2">"Count"</span><span class="p">,</span> <span class="s2">"OffenseCategory"</span><span class="p">,</span> <span class="s2">"OffenseType"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Crime Type by Offense Category"</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">categories</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"category_type_crime_against.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/category_type_crime_against.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org05cdd00">
<h3 id="org05cdd00">Neighborhood</h3>
<div class="outline-text-3" id="text-org05cdd00">
<p><a href="https://www.usgs.gov/faqs/what-state-plane-coordinate-system-can-gps-provide-coordinates-these-values">https://www.usgs.gov/faqs/what-state-plane-coordinate-system-can-gps-provide-coordinates-these-values</a></p>
<div class="highlight">
<pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"CrimeAgainst"</span><span class="p">,</span> <span class="s2">"Neighborhood"</span><span class="p">,</span> <span class="s2">"OffenseType"</span><span class="p">]</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"CaseNumber"</span><span class="p">:</span> <span class="s2">"Count"</span><span class="p">})</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">grouped</span><span class="p">[</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"Count"</span><span class="p">]])</span>

<span class="n">categories</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Neighborhood:O"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"OffenseType"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Neighborhood"</span><span class="p">,</span>
             <span class="s2">"CrimeAgainst"</span><span class="p">,</span>
             <span class="s2">"Count"</span><span class="p">,</span>
             <span class="s2">"OffenseType"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Crime Type by Neighborhood"</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">categories</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"neighborhood_type_crime_against.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/neighborhood_type_crime_against.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<ul class="org-ul">
<li><a href="https://geopandas.org/en/stable/docs/user_guide/io.html">GeoPandas Read File</a></li>
</ul>
<div class="highlight">
<pre><span></span><span class="n">GEOJSON_URL</span> <span class="o">=</span> <span class="s2">"https://opendata.arcgis.com/datasets/1ef75e34b8504ab9b14bef0c26cade2c_3.geojson"</span>
<span class="n">neighborhoods</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">GEOJSON_URL</span><span class="p">)</span>

<span class="n">background</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">neighborhoods</span><span class="p">)</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"MAPLABEL"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span><span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span><span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">"type"</span><span class="p">,</span> <span class="s2">"geometry"</span><span class="p">])</span>

<span class="n">background</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"neighborhood_crime.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/neighborhood_crime.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org02ea18e">
<h3 id="org02ea18e">By Date</h3>
<div class="outline-text-3" id="text-org02ea18e">
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"when"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OccurDate</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
<pre class="example">
1971-01-01 00:00:00
</pre>
<p>What?</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">when</span><span class="o">==</span><span class="n">data</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span>
</pre></div>
<pre class="example">
     Address   CaseNumber CrimeAgainst Neighborhood OccurDate  OccurTime  \
3770     NaN  20-X5515843       Person    Concordia  1/1/1971          0   

     OffenseCategory OffenseType  OpenDataLat  OpenDataLon  ReportDate  \
3770    Sex Offenses    Fondling          NaN          NaN  10/14/2020   

      OffenseCount  OpenDataX  OpenDataY       when  
3770             2        NaN        NaN 1971-01-01  
</pre>
<p>So, there might be some mistakes in there… or maybe some people wait a long time to report a crime?</p>
</div>
<div class="outline-4" id="outline-container-org3b5e8dd">
<h4 id="org3b5e8dd">By Year</h4>
<div class="outline-text-4" id="text-org3b5e8dd">
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">date</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"year"</span><span class="p">,</span> <span class="s2">"OffenseType"</span><span class="p">]</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"CaseNumber"</span><span class="p">:</span> <span class="s2">"Count"</span><span class="p">})</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">grouped</span><span class="p">[</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"Count"</span><span class="p">]])</span>

<span class="n">categories</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"year:N"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"OffenseType"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"year"</span><span class="p">,</span>
             <span class="s2">"Count"</span><span class="p">,</span>
             <span class="s2">"OffenseType"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Crime Type by Year"</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">categories</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"year_type.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/year_type.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span><span class="n">monthly</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">"OccurDate"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
<p>It's only supposed to go back to 2015, what's with the older rows?</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"reported"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ReportDate</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"report_year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reported</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>

<span class="n">older</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">year</span><span class="o">&lt;</span> <span class="mi">2015</span><span class="p">]</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"report_year"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">,</span> <span class="s2">"OffenseType"</span><span class="p">]</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">older</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"CaseNumber"</span><span class="p">:</span> <span class="s2">"Count"</span><span class="p">})</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">grouped</span><span class="p">[</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"Count"</span><span class="p">]])</span>
<span class="n">categories</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"report_year"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"OffenseType"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"year"</span><span class="p">,</span> <span class="s2">"report_year"</span><span class="p">,</span>
             <span class="s2">"Count"</span><span class="p">,</span>
             <span class="s2">"OffenseType"</span><span class="p">])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Crime Type by Year/Reporting"</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">categories</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"year_reported_type.html"</span><span class="p">))</span>
</pre></div>
<object data="/posts/looking-at-portland-crime-data/year_reported_type.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgfd213e2">
<h2 id="orgfd213e2">Sources</h2>
<div class="outline-text-2" id="text-orgfd213e2">
<ul class="org-ul">
<li><a href="https://www.portlandoregon.gov/police/71673">Portland Police Bureau's Open Data</a>: This is where you can get data from the PPB.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/bureau-of-labor-statistics-employment-data-march-2021/">Bureau of Labor Statistics Employment Data (March 2021)</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/" rel="bookmark"><time class="published dt-published" datetime="2021-04-02T17:02:47-07:00" itemprop="datePublished" title="2021-04-02 17:02">2021-04-02 17:02</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#orgc027ad5">Beginning</a>
<ul>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#org677c753">Imports</a></li>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#org4a4c331">Some Setup</a>
<ul>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#orgbec3ab8">A Table Printer</a></li>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#org6002850">The Environment</a></li>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#org57545d2">Plotting</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#org648b8fa">Middle</a>
<ul>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#org1e6c756">The Data</a>
<ul>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#org2dfa0e6">Employment</a></li>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#org127752c">Earnings</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/bureau-of-labor-statistics-employment-data-march-2021/#orgca478ae">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgc027ad5">
<h2 id="orgc027ad5">Beginning</h2>
<div class="outline-text-2" id="text-orgc027ad5"></div>
<div class="outline-3" id="outline-container-org677c753">
<h3 id="org677c753">Imports</h3>
<div class="outline-text-3" id="text-org677c753">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org4a4c331">
<h3 id="org4a4c331">Some Setup</h3>
<div class="outline-text-3" id="text-org4a4c331"></div>
<div class="outline-4" id="outline-container-orgbec3ab8">
<h4 id="orgbec3ab8">A Table Printer</h4>
<div class="outline-text-4" id="text-orgbec3ab8">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org6002850">
<h4 id="org6002850">The Environment</h4>
<div class="outline-text-4" id="text-org6002850">
<div class="highlight">
<pre><span></span><span class="n">env_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"~/.env"</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">env_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">env_path</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org57545d2">
<h4 id="org57545d2">Plotting</h4>
<div class="outline-text-4" id="text-org57545d2">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"bureau-of-labor-statistics-employment-data-march-2021"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">Plot</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Plot"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"width"</span><span class="p">,</span> <span class="s2">"height"</span><span class="p">,</span> <span class="s2">"fontscale"</span><span class="p">,</span>
                           <span class="s2">"tan"</span><span class="p">,</span> <span class="s2">"blue"</span><span class="p">,</span>
                           <span class="s2">"red"</span><span class="p">])</span>
<span class="n">PLOT</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
 <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org648b8fa">
<h2 id="org648b8fa">Middle</h2>
<div class="outline-text-2" id="text-org648b8fa"></div>
<div class="outline-3" id="outline-container-org1e6c756">
<h3 id="org1e6c756">The Data</h3>
<div class="outline-text-3" id="text-org1e6c756">
<p>The data comes from the <a href="https://www.bls.gov/ces/">U.S. Bureau of Labor Statistics</a> Current Employment Statistics (CES) page.</p>
</div>
<div class="outline-4" id="outline-container-org2dfa0e6">
<h4 id="org2dfa0e6">Employment</h4>
<div class="outline-text-4" id="text-org2dfa0e6">
<p>The first set is the seasonally adjusted employment employment for all employees in the united states.</p>
<div class="highlight">
<pre><span></span><span class="n">employment_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"SEASONALLY_ADJUSTED_EMPLOYMENT"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">employment_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">employment</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">employment_path</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">employment</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Rows: </span><span class="si">{</span><span class="n">rows</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> Columns: </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Rows: 360,008 Columns: 5
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">employment</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">series_id</th>
<th class="org-right" scope="col">year</th>
<th class="org-left" scope="col">period</th>
<th class="org-right" scope="col">value</th>
<th class="org-right" scope="col">footnote_codes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">CES0000000001</td>
<td class="org-right">1939</td>
<td class="org-left">M01</td>
<td class="org-right">29923</td>
<td class="org-right">nan</td>
</tr>
<tr>
<td class="org-left">CES0000000001</td>
<td class="org-right">1939</td>
<td class="org-left">M02</td>
<td class="org-right">30100</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">employment</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">series_id</th>
<th class="org-right" scope="col">year</th>
<th class="org-left" scope="col">period</th>
<th class="org-right" scope="col">value</th>
<th class="org-left" scope="col">footnote_codes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">CES9093299901</td>
<td class="org-right">2021</td>
<td class="org-left">M01</td>
<td class="org-right">943.3</td>
<td class="org-left">nan</td>
</tr>
<tr>
<td class="org-left">CES9093299901</td>
<td class="org-right">2021</td>
<td class="org-left">M02</td>
<td class="org-right">945.3</td>
<td class="org-left">P</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">employment</span><span class="o">.</span><span class="n">footnote_codes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
<pre class="example">
P    1047
Name: footnote_codes, dtype: int64
</pre>
<p>Our data set runs from january 1939 through February 2021, but looking at the values it seems they must have changed the way that they calculate it, or else there was a lot more employment in 1939. The "series" referred to in the <code>series_id</code> column is a time series. The <code>period</code> is the month and the "P" footnote code means preliminary (which seems odd given that there are 1,047).</p>
<p>They provide some files to map the more obscure values to names so I guess I'll take advantage of that.</p>
<div class="highlight">
<pre><span></span><span class="n">notes_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"CES_FOOTNOTES"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">notes_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="k">with</span> <span class="n">notes_path</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="c1"># get rid of the header</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

    <span class="c1"># get the map</span>
    <span class="n">CODE</span><span class="p">,</span> <span class="n">TEXT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">)</span>
    <span class="n">notes_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">line</span><span class="p">[</span><span class="n">CODE</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="n">line</span><span class="p">[</span><span class="n">TEXT</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">}</span>

<span class="n">notes_map</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"none"</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">employment</span><span class="p">[</span><span class="s2">"notes"</span><span class="p">]</span> <span class="o">=</span> <span class="n">employment</span><span class="o">.</span><span class="n">footnote_codes</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">notes_map</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">employment</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">series_id</th>
<th class="org-right" scope="col">year</th>
<th class="org-left" scope="col">period</th>
<th class="org-right" scope="col">value</th>
<th class="org-left" scope="col">footnote_codes</th>
<th class="org-left" scope="col">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">CES9093299901</td>
<td class="org-right">2021</td>
<td class="org-left">M01</td>
<td class="org-right">943.3</td>
<td class="org-left">nan</td>
<td class="org-left">none</td>
</tr>
<tr>
<td class="org-left">CES9093299901</td>
<td class="org-right">2021</td>
<td class="org-left">M02</td>
<td class="org-right">945.3</td>
<td class="org-left">P</td>
<td class="org-left">preliminary</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">del</span><span class="p">(</span><span class="n">employment</span><span class="p">[</span><span class="s2">"footnote_codes"</span><span class="p">])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">period_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"CES_PERIODS"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">period_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="k">with</span> <span class="n">period_path</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">PERIOD</span><span class="p">,</span> <span class="n">SHORT_MONTH</span><span class="p">,</span> <span class="n">LONG_MONTH</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">)</span>
    <span class="n">period_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">line</span><span class="p">[</span><span class="n">PERIOD</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="n">line</span><span class="p">[</span><span class="n">LONG_MONTH</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">}</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">employment</span><span class="p">[</span><span class="s2">"month"</span><span class="p">]</span> <span class="o">=</span> <span class="n">employment</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">period_map</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">employment</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">series_id</th>
<th class="org-right" scope="col">year</th>
<th class="org-left" scope="col">period</th>
<th class="org-right" scope="col">value</th>
<th class="org-left" scope="col">notes</th>
<th class="org-left" scope="col">month</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">CES9093299901</td>
<td class="org-right">2021</td>
<td class="org-left">M01</td>
<td class="org-right">943.3</td>
<td class="org-left">none</td>
<td class="org-left">January</td>
</tr>
<tr>
<td class="org-left">CES9093299901</td>
<td class="org-right">2021</td>
<td class="org-left">M02</td>
<td class="org-right">945.3</td>
<td class="org-left">preliminary</td>
<td class="org-left">February</td>
</tr>
</tbody>
</table>
<p>Actualy, now that I think about it I want a datetime object, not a string anyway.</p>
<div class="highlight">
<pre><span></span><span class="n">month_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">period</span><span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">period_map</span><span class="p">))}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">month_map</span><span class="p">)</span>
</pre></div>
<pre class="example">
{'M01': 1, 'M02': 2, 'M03': 3, 'M04': 4, 'M05': 5, 'M06': 6, 'M07': 7, 'M08': 8, 'M09': 9, 'M10': 10, 'M11': 11, 'M12': 12, 'M13': 13}
</pre>
<p>What's M13?</p>
<p>According to the data element dictionary it means "Annual Average", but this particular data set doesn't have it.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">employment</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
<pre class="example">
['M01' 'M02' 'M03' 'M04' 'M05' 'M06' 'M07' 'M08' 'M09' 'M10' 'M11' 'M12']
</pre>
<div class="highlight">
<pre><span></span><span class="n">APPLY_TO_ROWS</span> <span class="o">=</span> <span class="s2">"columns"</span>

<span class="n">employment</span><span class="p">[</span><span class="s2">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="n">employment</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">month_map</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">period</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">APPLY_TO_ROWS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">employment</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">series_id</th>
<th class="org-right" scope="col">year</th>
<th class="org-left" scope="col">period</th>
<th class="org-right" scope="col">value</th>
<th class="org-left" scope="col">notes</th>
<th class="org-left" scope="col">month</th>
<th class="org-left" scope="col">date</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">CES9093299901</td>
<td class="org-right">2021</td>
<td class="org-left">M01</td>
<td class="org-right">943.3</td>
<td class="org-left">none</td>
<td class="org-left">January</td>
<td class="org-left">2021-01-01 00:00:00</td>
</tr>
<tr>
<td class="org-left">CES9093299901</td>
<td class="org-right">2021</td>
<td class="org-left">M02</td>
<td class="org-right">945.3</td>
<td class="org-left">preliminary</td>
<td class="org-left">February</td>
<td class="org-left">2021-02-01 00:00:00</td>
</tr>
</tbody>
</table>
<p>There's a lot of data there, maybe we can start by aggregating by year.</p>
<div class="highlight">
<pre><span></span><span class="n">employment</span> <span class="o">=</span> <span class="n">employment</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">yearly</span> <span class="o">=</span> <span class="n">employment</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"AS"</span><span class="p">)</span>
<span class="n">sums</span> <span class="o">=</span> <span class="n">yearly</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">date</th>
<th class="org-right" scope="col">year</th>
<th class="org-right" scope="col">value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">2020-01-01 00:00:00</td>
<td class="org-right">2.1113e+07</td>
<td class="org-right">1.37505e+07</td>
</tr>
<tr>
<td class="org-left">2021-01-01 00:00:00</td>
<td class="org-right">3.87628e+06</td>
<td class="org-right">3.28994e+06</td>
</tr>
</tbody>
</table>
<p>So the year becomes nonsense, and since I'm using the seasonally adjusted the values might not make sense either, but this is just an exploration so let's see what we have.</p>
<div class="highlight">
<pre><span></span><span class="n">limit</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sums</span> <span class="o">=</span> <span class="n">sums</span><span class="p">[</span><span class="n">sums</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">]</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">sums</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"value"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">blue</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Seasonally Adjusted Yearly Employment Totals"</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"yearly_employment_sums"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<object data="/posts/bureau-of-labor-statistics-employment-data-march-2021/yearly_employment_sums.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-4" id="outline-container-org127752c">
<h4 id="org127752c">Earnings</h4>
<div class="outline-text-4" id="text-org127752c">
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"BLS_EARNINGS"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">earnings</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgca478ae">
<h2 id="orgca478ae">End</h2>
<div class="outline-text-2" id="text-orgca478ae">
<ul class="org-ul">
<li>Triggered by listening to a "The Indicator" episode from December 8, 2017: <a href="https://www.npr.org/2017/12/08/569461387/wheres-my-raise">Where's My Raise?</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/geopandas-revisited/">Geopandas Revisited</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/geopandas-revisited/" rel="bookmark"><time class="published dt-published" datetime="2021-03-07T11:41:22-08:00" itemprop="datePublished" title="2021-03-07 11:41">2021-03-07 11:41</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/geopandas-revisited/#org52ec96b">Beginning</a>
<ul>
<li><a href="/posts/geopandas-revisited/#orgb6ef575">Dependencies</a></li>
<li><a href="/posts/geopandas-revisited/#org365439e">Imports</a></li>
<li><a href="/posts/geopandas-revisited/#org3af170e">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/geopandas-revisited/#orgb79df7c">Middle</a>
<ul>
<li><a href="/posts/geopandas-revisited/#org93518e8">Loading the Data</a></li>
<li><a href="/posts/geopandas-revisited/#org91e10da">Maybe Just Portland</a></li>
<li><a href="/posts/geopandas-revisited/#orgda90346">What About All of Oregon</a></li>
<li><a href="/posts/geopandas-revisited/#org48ff7a8">Portland Again</a></li>
</ul>
</li>
<li><a href="/posts/geopandas-revisited/#org840dc61">End</a>
<ul>
<li><a href="/posts/geopandas-revisited/#org7dfb26d">Source</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org52ec96b">
<h2 id="org52ec96b">Beginning</h2>
<div class="outline-text-2" id="text-org52ec96b">
<p>This is a look at the U.S. Census zip-code mapping data.</p>
</div>
<div class="outline-3" id="outline-container-orgb6ef575">
<h3 id="orgb6ef575">Dependencies</h3>
<div class="outline-text-3" id="text-orgb6ef575">
<p>Besides <a href="https://geopandas.org/">geopandas</a> this also requires <a href="https://geoviews.org/#">geoviews</a> which in turn requires <a href="https://scitools.org.uk/cartopy/docs/v0.17/index.html">cartopy</a> but if you use pypi you have to install <a href="https://proj.org/">proj</a> first. You also need the python header files (so with debian it's <code>sudo apt install python3-dev</code>, note that <code>python-dev</code> will install the python-2 headers for some reason)… Oy.</p>
<p>Take two.</p>
<pre class="example">
sudo apt install python3-dev
sudo apt install proj-bin
sudo apt install libgeos-dev
sudo apt install libproj-dev
</pre>
<p>I'm not 100% sure about <code>proj-bin</code>, but, the rest are needed to build cartopy.</p>
<p><b>Note:</b> I tested it without <code>proj-bin</code> and the <code>cartopy</code> installation fails. Also, as of December 29, 2021 cartopy requires a newer version of <code>proj</code> than is in the stable releases for ubuntu and debian.</p>
<pre class="example">
pip install cartopy
pip install geopandas
pip install geoviews
</pre>
<p>The apt stuff has to come before the pip installs, but the actual ordering within each set doesn't matter. You can install geopandas by itself, it will just complain that geoviews isn't installed.</p>
<p><b>Another Note:</b> Geoviews will install cartopy so you don't need to install it separately (and maybe you shouldn't since this will keep the versions matched).</p>
<p>Additionally, because I'm the plot file is so huge I'm using <a href="https://datashader.org/index.html">datashader</a> (which I don't recall explicitly installing, I think holoviews pulled it in) we'll also need <a href="https://github.com/holoviz/spatialpandas">Spatial Pandas</a>. Hokey smokes.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org365439e">
<h3 id="org365439e">Imports</h3>
<div class="outline-text-3" id="text-org365439e">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">seaborn</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org3af170e">
<h3 id="org3af170e">Set Up</h3>
<div class="outline-text-3" id="text-org3af170e">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/.env"</span><span class="p">)</span>
<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"geopandas-revisited"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb79df7c">
<h2 id="orgb79df7c">Middle</h2>
<div class="outline-text-2" id="text-orgb79df7c"></div>
<div class="outline-3" id="outline-container-org93518e8">
<h3 id="org93518e8">Loading the Data</h3>
<div class="outline-text-3" id="text-org93518e8">
<div class="highlight">
<pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"US_ZIP_CODE_SHAPEFILE"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
</pre></div>
<p>First, let's find the <i>Coordinate Reference System</i> being used.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
<pre class="example">
epsg:4269
</pre>
<p>According to <a href="https://epsg.io/4269">map tiler</a> it's a North America specific reference system. I don't know if that's good or bad so let's try it as is first.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
  ZCTA5CE10 GEOID10 CLASSFP10 MTFCC10 FUNCSTAT10    ALAND10  AWATER10  \
0     43451   43451        B5   G6350          S   63484189    157689   
1     43452   43452        B5   G6350          S  121525288  13721740   
2     43456   43456        B5   G6350          S    9320978   1003775   
3     43457   43457        B5   G6350          S   48004678         0   
4     43458   43458        B5   G6350          S    2573816     39915   

    INTPTLAT10    INTPTLON10  \
0  +41.3183193  -083.6150363   
1  +41.5202297  -082.9770334   
2  +41.6318300  -082.8393923   
3  +41.2673301  -083.4274872   
4  +41.5304461  -083.2133648   

                                            geometry  
0  POLYGON ((-83.70873 41.32733, -83.70815 41.327...  
1  POLYGON ((-83.08698 41.53780, -83.08256 41.537...  
2  MULTIPOLYGON (((-82.83558 41.71082, -82.83515 ...  
3  POLYGON ((-83.49650 41.25371, -83.48382 41.253...  
4  POLYGON ((-83.22229 41.53102, -83.22228 41.532...  
</pre>
<div class="highlight">
<pre><span></span><span class="n">ZIP_COLUMN</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
<p>Unfortunately this makes a huge plot so I'll have to use datashade with it (which isn't necessarily a bad thing, it just isn't what I prefer).</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">hover_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">"ZCTASCE10"</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">datashade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"UNITED States Census Zip Codes"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"us_zip_codes"</span><span class="p">)()</span>
</pre></div>
<p>Well, after all that there seems to be a bug in there somewhere. Datashader is doing something with numpy that raises an exception.</p>
<pre class="example">
/usr/local/lib/python3.8/dist-packages/numpy/core/numerictypes.py in issubdtype(arg1, arg2)
    386     """
    387     if not issubclass_(arg1, generic):
--&gt; 388         arg1 = dtype(arg1).type
    389     if not issubclass_(arg2, generic):
    390         arg2 = dtype(arg2).type

TypeError: Cannot interpret 'MultiPolygonDtype(float64)' as a data type
</pre></div>
</div>
<div class="outline-3" id="outline-container-org91e10da">
<h3 id="org91e10da">Maybe Just Portland</h3>
<div class="outline-text-3" id="text-org91e10da">
<p>There's a site called <a href="https://www.zipdatamaps.com/index.php">zipdatamaps</a> that has listings of zip codes (among other things) which I'll use to get the zip codes for Portland, Oregon. I'm going to use pandas' <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_html.html">read_html</a> function which also requires you to install <a href="https://lxml.de/">lxml</a>.</p>
<p>According to the pandas documentation you can't use https, but that seems to give me a 403 (Forbidden) error so I'll pull the HTML with requests first instead of having pandas pull it directly. The table also has a title above the column headers so we have to skip the first row to avoid a MultiIndex (or fix it later).</p>
<div class="highlight">
<pre><span></span><span class="n">URL</span> <span class="o">=</span> <span class="s2">"https://www.zipdatamaps.com/zipcodes-portland-or"</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tables</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
<p><code>read_html</code> returns a list so I'll pull out the first frame and do a little clean up (dropping the empty rows with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dropna.html">dropna</a>).</p>
<div class="highlight">
<pre><span></span><span class="n">zips</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">zips</span> <span class="o">=</span> <span class="n">zips</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">zips</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
  ZIP Code ZIP Code Name Population        Type
     97034   Lake Oswego      18905  Non-Unique
0  97035.0   Lake Oswego    23912.0  Non-Unique
1  97080.0       Gresham    40888.0  Non-Unique
2  97086.0  Happy Valley    26010.0  Non-Unique
3  97201.0      Portland    15484.0  Non-Unique
4  97202.0      Portland    38762.0  Non-Unique
</pre>
<p>So we still have a problem in that it used the first zip-code as part of the header… I'll just pull the row out and add it back in. One thing to note is that the header values are all strings so to be able to append the row we'll have to do some conversion.</p>
<div class="highlight">
<pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="n">zips</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">column</span><span class="p">:</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">first_row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">zips</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">column</span><span class="p">:</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">POPULATION_COLUMN</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">first_row</span><span class="p">[</span><span class="n">POPULATION_COLUMN</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">first_row</span><span class="p">[</span><span class="n">POPULATION_COLUMN</span><span class="p">])</span>

<span class="n">zips</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>

<span class="n">zips</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"ZIP Code"</span><span class="p">]</span> <span class="o">=</span> <span class="n">zips</span><span class="p">[</span><span class="s2">"ZIP Code"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">zips</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"Population"</span><span class="p">]</span> <span class="o">=</span> <span class="n">zips</span><span class="p">[</span><span class="s2">"Population"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">zips</span> <span class="o">=</span> <span class="n">zips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">first_row</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">zips</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
  ZIP Code ZIP Code Name  Population        Type
0    97035   Lake Oswego       23912  Non-Unique
1    97080       Gresham       40888  Non-Unique
2    97086  Happy Valley       26010  Non-Unique
3    97201      Portland       15484  Non-Unique
4    97202      Portland       38762  Non-Unique
</pre>
<p>I converted the zip codes into strings instead of integers because there are zip-codes with leading zeros, although not in Portland so I guess it could go either way.</p>
<p>Now we'll pare down the original data set.</p>
<div class="highlight">
<pre><span></span><span class="n">ZIPS_COLUMN</span> <span class="o">=</span> <span class="s2">"ZIP Code"</span>
<span class="n">expression</span> <span class="o">=</span> <span class="s2">"|"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zips</span><span class="p">[</span><span class="n">ZIPS_COLUMN</span><span class="p">])</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="n">ZIP_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zips</span><span class="p">)))</span>
</pre></div>
<pre class="example">
(35, 10)
</pre>
<p>Once again with feeling. I'll add the population too, for no real good reason using <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.join.html">join</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">sub</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">ZIP_COLUMN</span><span class="p">:</span> <span class="n">ZIPS_COLUMN</span><span class="p">})</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">zips</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">ZIPS_COLUMN</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plotter</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zips</span><span class="p">)))</span>
</pre></div>
<p>I don't know why but when setting the hover columns for the plot if you put the zip-code column first it doesn't show up but it does if you put it second. Mysterious.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">hover_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">"Population"</span><span class="p">,</span> <span class="n">ZIPS_COLUMN</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Portland by Zip Code"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>    
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"portland_zip_codes"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/geopandas-revisited/portland_zip_codes.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-orgda90346">
<h3 id="orgda90346">What About All of Oregon</h3>
<div class="outline-text-3" id="text-orgda90346">
<div class="highlight">
<pre><span></span><span class="n">URL</span> <span class="o">=</span> <span class="s2">"https://www.zip-codes.com/state/or.asp"</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
<pre class="example">
0        ZIP Code      City  County      Type
1  ZIP Code 97001  Antelope   Wasco  P.O. Box
2  ZIP Code 97002    Aurora  Marion  Standard
</pre>
<div class="highlight">
<pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">ZIP_COLUMN</span><span class="p">:</span> <span class="n">ZIPS_COLUMN</span><span class="p">})</span>
<span class="n">oregon</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">ZIPS_COLUMN</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oregon</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
<pre class="example">
ZIP Code                                                  97824
GEOID10                                                   97824
CLASSFP10                                                    B5
MTFCC10                                                   G6350
FUNCSTAT10                                                    S
ALAND10                                               565896585
AWATER10                                                  20851
INTPTLAT10                                          +45.3543012
INTPTLON10                                         -117.7564700
geometry      POLYGON ((-117.993812 45.369603, -117.993632 4...
City                                                       Cove
County                                                    Union
Type                                                   Standard
Name: 0, dtype: object
</pre>
<p>This turns out to work, but the file it creates is 29 Megabytes, so maybe not a great idea to use it with holoviews. I'll just do a regular PNG with no annotations.</p>
<div class="highlight">
<pre><span></span><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'matplotlib'</span><span class="p">,</span> <span class="s1">'inline'</span><span class="p">)</span>
<span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'config'</span><span class="p">,</span> <span class="s2">"InlineBackend.figure_format = 'retina'"</span><span class="p">)</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">,</span> <span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">"axes.grid"</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<span class="n">FIGURE_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">oregon</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"images/oregon_zip_codes.png"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><a alt="Oregon Zip Codes" class="reference" href="/images/oregon_zip_codes.webp"><img alt="Oregon Zip Codes" class="reference" src="/images/oregon_zip_codes.thumbnail.png"></a></p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org48ff7a8">
<h3 id="org48ff7a8">Portland Again</h3>
<div class="outline-text-3" id="text-org48ff7a8">
<div class="highlight">
<pre><span></span><span class="n">counties</span> <span class="o">=</span> <span class="s2">"Clackamas|Multnomah|Washington"</span>
<span class="n">portland</span> <span class="o">=</span> <span class="n">oregon</span><span class="p">[[</span><span class="n">ZIPS_COLUMN</span><span class="p">,</span> <span class="s2">"City"</span><span class="p">,</span> <span class="s2">"County"</span><span class="p">]]</span>
<span class="n">portland</span> <span class="o">=</span> <span class="n">portland</span><span class="p">[</span><span class="n">portland</span><span class="o">.</span><span class="n">County</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">counties</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
<span class="n">portland</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">portland</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">ZIPS_COLUMN</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>
<span class="n">portland</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">portland</span><span class="p">,</span> <span class="n">zips</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">ZIPS_COLUMN</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>

<span class="n">portland</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">portland</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">portland</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">hover_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">"Population"</span><span class="p">,</span> <span class="s2">"City"</span><span class="p">,</span> <span class="s2">"County"</span><span class="p">,</span> <span class="n">ZIPS_COLUMN</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Clackamas, Multnomah, and Washington Counties"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>    
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"portland_with_city"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/geopandas-revisited/portland_with_city.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>This one looks a little better. The gray-areas are the cities that weren't in the first zip-code set. I guess they only count Portland, as Portland, not the Portland Metropolitan area altogether.</p>
<p>It's kind of surprising that the zip code with the highest population is on the West side (the darkest blue area). I guess because it encompasses a larger area than the ones further east (Rock Creek, Cedar Mill, and Bethany, according to Google). It's odd, though, but some of the cities that come up (like Mollala, the furthest south) are listed on the <a href="https://www.oregonmetro.gov/regional-leadership/what-metro/cities-and-counties-region">Portland Metro list of cities</a>, maybe now there's too many cities.</p>
<p>Okay, I just checked out the metro's <a href="https://www.oregonmetro.gov/jurisdictional-boundaries-maps">maps</a> page and it looks like the metro area does cut through the outer counties instead of just taking them all in. To get just the metro area would take more work.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org840dc61">
<h2 id="org840dc61">End</h2>
<div class="outline-text-2" id="text-org840dc61">
<p>Well, that was a little harder than I thought it would be. The main thing to remember, I suppose, is that the maps quickly grow too big for holoviews, so if you want to do an overview it's better to do it in matplotlib and save the interactivity for a smaller section.</p>
</div>
<div class="outline-3" id="outline-container-org7dfb26d">
<h3 id="org7dfb26d">Source</h3>
<div class="outline-text-3" id="text-org7dfb26d">
<ul class="org-ul">
<li>TIGER/Line Shapefiles [Internet]. [cited 2021 Mar 7]. Available from: <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html">https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html</a></li>
<li>Listing of all Zip Codes in the state of Oregon [Internet]. [cited 2021 Mar 7]. Available from: <a href="https://www.zip-codes.com/state/or.asp">https://www.zip-codes.com/state/or.asp</a></li>
<li>Map of All ZIP Codes in Portland, Oregon - Updated March 2021 [Internet]. Zipdatamaps.com. [cited 2021 Mar 7]. Available from: <a href="https://www.zipdatamaps.com/">https://www.zipdatamaps.com/</a></li>
</ul>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/openintro-statistics/">OpenIntro Statistics</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/openintro-statistics/" rel="bookmark"><time class="published dt-published" datetime="2021-03-05T18:04:07-08:00" itemprop="datePublished" title="2021-03-05 18:04">2021-03-05 18:04</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org5213a6e">
<h2 id="org5213a6e">Cite</h2>
<div class="outline-text-2" id="text-org5213a6e">
<ul class="org-ul">
<li>1. Diez DM, Barr CD, Çetinkaya-Rundel M. OpenIntro statistics. 2012.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/t-confidence-intervals/">t Confidence Intervals</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/t-confidence-intervals/" rel="bookmark"><time class="published dt-published" datetime="2021-03-05T16:30:52-08:00" itemprop="datePublished" title="2021-03-05 16:30">2021-03-05 16:30</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/t-confidence-intervals/#orgb2a5183">Imports</a></li>
<li><a href="/posts/t-confidence-intervals/#org66b1161">Whale Mercury</a>
<ul>
<li><a href="/posts/t-confidence-intervals/#orgb0b099d">Beginning</a>
<ul>
<li><a href="/posts/t-confidence-intervals/#org33d1326">Checking the Skew</a></li>
</ul>
</li>
<li><a href="/posts/t-confidence-intervals/#org3c483d8">Middle</a>
<ul>
<li><a href="/posts/t-confidence-intervals/#org8d78626">Standard Error</a></li>
<li><a href="/posts/t-confidence-intervals/#org9a58aa5">t Star</a></li>
<li><a href="/posts/t-confidence-intervals/#org0b334b1">Margin Of Error</a></li>
<li><a href="/posts/t-confidence-intervals/#org9b2f92b">The Confidence Interval</a></li>
</ul>
</li>
<li><a href="/posts/t-confidence-intervals/#org7e6de24">End</a></li>
</ul>
</li>
<li><a href="/posts/t-confidence-intervals/#org6cd9b68">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgb2a5183">
<h2 id="orgb2a5183">Imports</h2>
<div class="outline-text-2" id="text-orgb2a5183">
<div class="highlight">
<pre><span></span><span class="c1"># from python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org66b1161">
<h2 id="org66b1161">Whale Mercury</h2>
<div class="outline-text-2" id="text-org66b1161"></div>
<div class="outline-3" id="outline-container-orgb0b099d">
<h3 id="orgb0b099d">Beginning</h3>
<div class="outline-text-3" id="text-orgb0b099d">
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">n</th>
<th class="org-right" scope="col">\(\overline{x}\)</th>
<th class="org-right" scope="col"><i>s</i></th>
<th class="org-right" scope="col"><i>min</i></th>
<th class="org-right" scope="col"><i>max</i></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">19</td>
<td class="org-right">4.4</td>
<td class="org-right">2.3</td>
<td class="org-right">1.7</td>
<td class="org-right">9.2</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">WhaleMercury</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"WhaleMercury"</span><span class="p">,</span>
                          <span class="p">[</span><span class="s2">"n"</span><span class="p">,</span>
                           <span class="s2">"mean"</span><span class="p">,</span>
                           <span class="s2">"standard_deviation"</span><span class="p">,</span>
                           <span class="s2">"minimum"</span><span class="p">,</span>
                           <span class="s2">"maximum"</span><span class="p">])</span>

<span class="n">WHALES</span> <span class="o">=</span> <span class="n">WhaleMercury</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
                      <span class="n">mean</span><span class="o">=</span><span class="mf">4.4</span><span class="p">,</span>
                      <span class="n">standard_deviation</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span>
                      <span class="n">minimum</span><span class="o">=</span><span class="mf">1.7</span><span class="p">,</span>
                      <span class="n">maximum</span><span class="o">=</span><span class="mf">9.2</span><span class="p">)</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org33d1326">
<h4 id="org33d1326">Checking the Skew</h4>
<div class="outline-text-4" id="text-org33d1326">
<div class="highlight">
<pre><span></span><span class="n">scalar</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">WHALES</span><span class="o">.</span><span class="n">standard_deviation</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="n">WHALES</span><span class="o">.</span><span class="n">mean</span> <span class="o">-</span> <span class="n">scalar</span><span class="si">:</span><span class="s2"> 0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">WHALES</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="n">scalar</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</pre></div>
<pre class="example">
(-1.35, 10.15)
</pre>
<p>Our minimum and maximum are within two-and a half standard deviations from the mean so we'll judge that there isn't a skew.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org3c483d8">
<h3 id="org3c483d8">Middle</h3>
<div class="outline-text-3" id="text-org3c483d8">
<p>\[ \textrm{Confidence Interval} = \overline{x} \pm t^*_{df} SE \]</p>
</div>
<div class="outline-4" id="outline-container-org8d78626">
<h4 id="org8d78626">Standard Error</h4>
<div class="outline-text-4" id="text-org8d78626">
<p>\[ SE = \frac{s}{\sqrt{n}} \]</p>
<div class="highlight">
<pre><span></span><span class="n">standard_error</span> <span class="o">=</span> <span class="n">WHALES</span><span class="o">.</span><span class="n">standard_deviation</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">WHALES</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Standard Error: </span><span class="si">{</span><span class="n">standard_error</span><span class="si">:</span><span class="s2"> 0.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Standard Error:  0.53
</pre></div>
</div>
<div class="outline-4" id="outline-container-org9a58aa5">
<h4 id="org9a58aa5">t Star</h4>
<div class="outline-text-4" id="text-org9a58aa5">
<p>To get the \(t^*_{18}\) value we can use the <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.t.html">scipy t</a> module which has a <code>ppf</code> (percent point function) that will get it for us. We're going to calculate the 95 % confidence error so we would need to pass in <i>1 - 0.95</i> (because we want the area in the tail), but the function actually gives you the one-tailed value so we need to divide this value by two \(\frac{1 - 0.95}{2}\) to get the two-tailed value.</p>
<div class="highlight">
<pre><span></span><span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">two_tailed</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">degrees_of_freedom</span> <span class="o">=</span> <span class="n">WHALES</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>

<span class="n">t_star_18</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">two_tailed</span><span class="p">,</span> <span class="n">degrees_of_freedom</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"t: </span><span class="si">{</span><span class="n">t_star_18</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
t: 2.101
</pre></div>
</div>
<div class="outline-4" id="outline-container-org0b334b1">
<h4 id="org0b334b1">Margin Of Error</h4>
<div class="outline-text-4" id="text-org0b334b1">
<p>\[ \textrm{Margin of Error} = t^*_{18} SE \]</p>
<div class="highlight">
<pre><span></span><span class="n">margin_of_error</span> <span class="o">=</span> <span class="n">t_star_18</span> <span class="o">*</span> <span class="n">standard_error</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Margin of Error: </span><span class="si">{</span><span class="n">margin_of_error</span><span class="si">:</span><span class="s2"> 0.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Margin of Error:  1.11
</pre></div>
</div>
<div class="outline-4" id="outline-container-org9b2f92b">
<h4 id="org9b2f92b">The Confidence Interval</h4>
<div class="outline-text-4" id="text-org9b2f92b">
<div class="highlight">
<pre><span></span><span class="n">lower</span> <span class="o">=</span> <span class="n">WHALES</span><span class="o">.</span><span class="n">mean</span> <span class="o">-</span> <span class="n">margin_of_error</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">WHALES</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="n">margin_of_error</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Confidence Interval = </span><span class="si">{</span><span class="n">WHALES</span><span class="o">.</span><span class="n">mean</span><span class="si">}</span><span class="s2"> +- </span><span class="si">{</span><span class="n">t_star_18</span><span class="si">:</span><span class="s2"> 0.2f</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="n">standard_error</span><span class="si">:</span><span class="s2"> 0.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="n">lower</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">upper</span><span class="si">:</span><span class="s2"> 0.3f</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Confidence Interval = 4.4 +-  2.10 x  0.53
(3.291,  5.509)
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7e6de24">
<h3 id="org7e6de24">End</h3>
<div class="outline-text-3" id="text-org7e6de24">
<p>We can say with 91% confidence that the mean Methyl-Mercury levels for Pilot Whale red meat in Taiji is within 3.291 and 5.509 \(\frac{\mu g}{\textrm{wet g}}\) (the FDA suggested limit is \(1.0 \frac{\mu g}{\textit{wet g}}\).</p>
<p>There's a couple of things to note. One is that although the original paper is behind a paywall so I can't read it, the abstract is available through <a href="https://www.researchgate.net/publication/40833219_High_mercury_levels_in_hair_samples_from_residents_of_Taiji_a_Japanese_whaling_town">Research Gate</a> (and Elsevier) and in it the mean is given as 5.9, not 4.4. In addition, the book that I got the values from (OpenIntro Statistics) had the wrong values <i>(3.87, 4.93)</i> when they calculated the confidence interval, so I don't know how accurate the starting numbers are. Also, if you poke around the web there are other researchers who've found that there is a lot of variation in mercury levels found by different researchers.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org6cd9b68">
<h2 id="org6cd9b68">Sources</h2>
<div class="outline-text-2" id="text-org6cd9b68">
<ul class="org-ul">
<li><a href="/posts/openintro-statistics/">OpenIntro Statistics</a></li>
<li>Endo T, Haraguchi K. High mercury levels in hair samples from residents of Taiji, a Japanese whaling town. Marine Pollution Bulletin. 2010 May 1;60(5):743-7.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/galton-pearson-and-the-peas/">Galton, Pearson, and the Peas</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/galton-pearson-and-the-peas/" rel="bookmark"><time class="published dt-published" datetime="2021-03-03T14:59:36-08:00" itemprop="datePublished" title="2021-03-03 14:59">2021-03-03 14:59</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/galton-pearson-and-the-peas/#org2e8e5f7">Abstract Summary</a></li>
<li><a href="/posts/galton-pearson-and-the-peas/#org37334f1">Bullets</a></li>
<li><a href="/posts/galton-pearson-and-the-peas/#org4dfb983">The Sweet Peas</a></li>
<li><a href="/posts/galton-pearson-and-the-peas/#orge80c4bc">Galton and Correlation</a></li>
<li><a href="/posts/galton-pearson-and-the-peas/#orgd343483">Other Stuff</a></li>
<li><a href="/posts/galton-pearson-and-the-peas/#org26ca136">So, what again?</a></li>
<li><a href="/posts/galton-pearson-and-the-peas/#orgd71914d">Source</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org2e8e5f7">
<h2 id="org2e8e5f7">Abstract Summary</h2>
<div class="outline-text-2" id="text-org2e8e5f7">
<p>Most textbooks explain correlation before linear regression, but the publications of <a href="https://en.wikipedia.org/wiki/Francis_Galton">Francis Galton</a> and <a href="https://en.wikipedia.org/wiki/Karl_Pearson">Karl Pearson</a> indicate that Galton's work studying the inheritance of <a href="https://en.wikipedia.org/wiki/Sweet_pea">sweet pea</a> characteristics lead to his initial concept of linear regression first and the development of correlation and multiple regression came from later work by Galton and Pearson. So this paper gives a history of how Galton came up with linear regression which instructors can use to introduce linear regression.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org37334f1">
<h2 id="org37334f1">Bullets</h2>
<div class="outline-text-2" id="text-org37334f1">
<ul class="org-ul">
<li>Galton came up with the concepts of linear regression and correlation (he wasn't the first, but this is about Galton and Pearson's discoveries) but Pearson developed it mathematically so it is commonly known as the <a href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient">Pearson Correlation Coefficient</a> (or some variant of that), leading many students to think that Pearson came up with it (see also <a href="https://en.wikipedia.org/wiki/Auguste_Bravais">Auguste Bravais</a>).</li>
<li>Galton's Question: How much influence does a generation have on the characteristics of the next?</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org4dfb983">
<h2 id="org4dfb983">The Sweet Peas</h2>
<div class="outline-text-2" id="text-org4dfb983">
<ul class="org-ul">
<li>1875: Galton gave seven friends 700 sweet pea seeds. The friends planted the seeds, harvested the peas, and returned them to Galton.</li>
<li>Galton chose sweet peas because they can self-fertilize so he didn't have to deal with the influence of two parents.</li>
<li>Galton found that the median size of daughter seeds for each mother's seed size plotted a straight(ish) line with a positive slope less than one (0.33) - the first regression line</li>
<li>Galton: Slope &lt; 1 shows "Regression Towards Mediocrity" - daughter's sizes are closer to the mean than parent's sizes are to the mean</li>
<li>If slope had been 1, then parent and child means were the same</li>
<li>If slope had been horizontal, then child didn't inherit size from parent</li>
<li>Slope between 0 and 1 meant that there was some influence from parent</li>
<li>Since he had 700 seeds and no calculator (and maybe for other reasons too) Galton used the median and semi-interquartile range \(\left( \frac{\textrm{Inter Quartile Range}}{2} \right)\) instead of mean and deviation</li>
<li>Galton estimated the regression line using the scatterplot, not by calculating the slope</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge80c4bc">
<h2 id="orge80c4bc">Galton and Correlation</h2>
<div class="outline-text-2" id="text-orge80c4bc">
<ul class="org-ul">
<li>If the correlation for the characteristic between the parent and child are the same for different data but the slope is different then the variance is what is causing the difference</li>
<li>The more difference there is in the variance, the steeper the slope of the line</li>
<li>Believed he had found that correlation between generations was a constant even for different characteristics (not something that is currently believed)</li>
<li>Although he was wrong about the correlation being constant, thinking about it led him to develop his ideas about regression and correlation</li>
</ul>
<p>The equation he was working toward that Pearson eventually came up with was:</p>
\begin{align} y &amp;= mx \\ &amp;= \left(\frac{S_y}{S_x} \right) x \end{align}
<p>Where <i>r</i> is the correlation between the parent and child's size, \(S_y\) is the sample standard deviation of the Daughter seed-sizes and \(S_x\) is the sample standard deviation of the Parent seed-sizes. There's a slope intercept too, but the point of it was to show how the spread for the two data variables affects the slope. The less variance there is for the daughter seeds, the smaller the slope would be (of course the same is true of the correlation, but Galton thought this was a fixed value anyway).</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgd343483">
<h2 id="orgd343483">Other Stuff</h2>
<div class="outline-text-2" id="text-orgd343483">
<p>It also touches on the fact that Galton recognized that prior generations also affected the size of the daughter's seeds, giving rise to the idea of multiple regression. And there is a table of the original measurements that Galton gathered for the seeds.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org26ca136">
<h2 id="org26ca136">So, what again?</h2>
<div class="outline-text-2" id="text-org26ca136">
<p>Galton's <i>Regression Towards Mediocrity</i> - or <i>Regression to the Mean</i> as it's more commonly referred to nowadays shows why humans don't split up into giants and little people. A person who is much larger than the mean might have a child that's also larger than the mean, but that child is likely to be closer to the mean than the parent was, just as parents that are smaller than the mean will tend to have children that are larger than they are.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgd71914d">
<h2 id="orgd71914d">Source</h2>
<div class="outline-text-2" id="text-orgd71914d">
<ul class="org-ul">
<li>Stanton JM. Galton, Pearson, and the peas: A brief history of linear regression for statistics instructors. Journal of Statistics Education. 2001 Jan 1;9(3). (<a href="http://jse.amstat.org/v9n3/stanton.html">Link</a>)</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/galtons-sweet-pea-data/">Galton's Sweet Pea Data</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/galtons-sweet-pea-data/" rel="bookmark"><time class="published dt-published" datetime="2021-02-24T13:47:33-08:00" itemprop="datePublished" title="2021-02-24 13:47">2021-02-24 13:47</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/galtons-sweet-pea-data/#org4fe4cac">Beginning</a>
<ul>
<li><a href="/posts/galtons-sweet-pea-data/#org2cce41b">Imports</a></li>
<li><a href="/posts/galtons-sweet-pea-data/#org359a2f1">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/galtons-sweet-pea-data/#org16e1c86">Middle</a>
<ul>
<li><a href="/posts/galtons-sweet-pea-data/#org6f83718">The Data</a></li>
</ul>
</li>
<li><a href="/posts/galtons-sweet-pea-data/#orgff3d839">End</a>
<ul>
<li><a href="/posts/galtons-sweet-pea-data/#org33fec38">Source</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org4fe4cac">
<h2 id="org4fe4cac">Beginning</h2>
<div class="outline-text-2" id="text-org4fe4cac"></div>
<div class="outline-3" id="outline-container-org2cce41b">
<h3 id="org2cce41b">Imports</h3>
<div class="outline-text-3" id="text-org2cce41b">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org359a2f1">
<h3 id="org359a2f1">Set Up</h3>
<div class="outline-text-3" id="text-org359a2f1">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"galtons-sweet-pea-data"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">Plot</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Plot"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"width"</span><span class="p">,</span> <span class="s2">"height"</span><span class="p">,</span> <span class="s2">"fontscale"</span><span class="p">,</span>
                           <span class="s2">"tan"</span><span class="p">,</span> <span class="s2">"blue"</span><span class="p">,</span>
                           <span class="s2">"red"</span><span class="p">])</span>
<span class="n">PLOT</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
 <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org16e1c86">
<h2 id="org16e1c86">Middle</h2>
<div class="outline-text-2" id="text-org16e1c86"></div>
<div class="outline-3" id="outline-container-org6f83718">
<h3 id="org6f83718">The Data</h3>
<div class="outline-text-3" id="text-org6f83718">
<div class="highlight">
<pre><span></span><span class="n">URL</span> <span class="o">=</span> <span class="s2">"http://jse.amstat.org/v9n3/stanton.html#appendixa"</span>

<span class="n">frames</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
<p>There are two tables on the page, we want the second one.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Diameter of Parent Seed(0.01 inch)</th>
<th class="org-right" scope="col">Diameter of Daughter Seed(0.01 inch)</th>
<th class="org-right" scope="col">Frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">21</td>
<td class="org-right">14.67</td>
<td class="org-right">22</td>
</tr>
<tr>
<td class="org-right">21</td>
<td class="org-right">15.67</td>
<td class="org-right">8</td>
</tr>
<tr>
<td class="org-right">21</td>
<td class="org-right">16.67</td>
<td class="org-right">10</td>
</tr>
<tr>
<td class="org-right">21</td>
<td class="org-right">17.67</td>
<td class="org-right">18</td>
</tr>
<tr>
<td class="org-right">21</td>
<td class="org-right">18.67</td>
<td class="org-right">21</td>
</tr>
<tr>
<td class="org-right">21</td>
<td class="org-right">19.67</td>
<td class="org-right">13</td>
</tr>
<tr>
<td class="org-right">21</td>
<td class="org-right">20.67</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-right">21</td>
<td class="org-right">22.67</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">14.66</td>
<td class="org-right">23</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">15.66</td>
<td class="org-right">10</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">16.66</td>
<td class="org-right">12</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">17.66</td>
<td class="org-right">17</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">18.66</td>
<td class="org-right">20</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">19.66</td>
<td class="org-right">13</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">20.66</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">22.66</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">14.07</td>
<td class="org-right">35</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">15.07</td>
<td class="org-right">16</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">16.07</td>
<td class="org-right">12</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">17.07</td>
<td class="org-right">13</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">18.07</td>
<td class="org-right">11</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">19.07</td>
<td class="org-right">10</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">20.07</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">22.07</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">14.35</td>
<td class="org-right">34</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">15.35</td>
<td class="org-right">12</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">16.35</td>
<td class="org-right">13</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">17.35</td>
<td class="org-right">17</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">18.35</td>
<td class="org-right">16</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">19.35</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">20.35</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">13.92</td>
<td class="org-right">37</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">14.92</td>
<td class="org-right">16</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">15.92</td>
<td class="org-right">13</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">16.92</td>
<td class="org-right">16</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">17.92</td>
<td class="org-right">13</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">18.92</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">19.92</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">16</td>
<td class="org-right">14.28</td>
<td class="org-right">34</td>
</tr>
<tr>
<td class="org-right">16</td>
<td class="org-right">15.28</td>
<td class="org-right">15</td>
</tr>
<tr>
<td class="org-right">16</td>
<td class="org-right">16.28</td>
<td class="org-right">18</td>
</tr>
<tr>
<td class="org-right">16</td>
<td class="org-right">17.28</td>
<td class="org-right">16</td>
</tr>
<tr>
<td class="org-right">16</td>
<td class="org-right">18.28</td>
<td class="org-right">13</td>
</tr>
<tr>
<td class="org-right">16</td>
<td class="org-right">19.28</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">16</td>
<td class="org-right">20.28</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">13.77</td>
<td class="org-right">46</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">14.77</td>
<td class="org-right">14</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">15.77</td>
<td class="org-right">9</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">16.77</td>
<td class="org-right">11</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">17.77</td>
<td class="org-right">14</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">18.77</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">19.77</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>Note that the data is somewhat aggregated - the last column is the number of times that the parent/daughter diameter pairs occured in the original data.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Parent"</span><span class="p">,</span> <span class="s2">"Daughter"</span><span class="p">,</span> <span class="s2">"Frequency"</span><span class="p">]</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Parent"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Daughter"</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">Frequency</span><span class="p">,</span>
                           <span class="n">c</span><span class="o">=</span><span class="s2">"Frequency"</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">red</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="s2">"Sweet Pea Diameter (0.01 Inch)"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                               <span class="n">width</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                               <span class="n">fontscale</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
                           <span class="p">)</span>
<span class="n">embedder</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"scatter_plot"</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">embedder</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<object data="/posts/galtons-sweet-pea-data/scatter_plot.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span><span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="n">rows</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">row</span><span class="o">.</span><span class="n">Parent</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Daughter</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Frequency</span><span class="p">)])</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">"Parent Daughter"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Diameter Distribution"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">height</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">"Diameter"</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"histogram"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<object data="/posts/galtons-sweet-pea-data/histogram.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span><span class="n">parent_min</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">Parent</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">parent_max</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">Parent</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">y_1</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">Parent</span><span class="o">==</span><span class="n">parent_min</span><span class="p">]</span><span class="o">.</span><span class="n">Daughter</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">y_2</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">Parent</span><span class="o">==</span><span class="n">parent_max</span><span class="p">]</span><span class="o">.</span><span class="n">Daughter</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">dots</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Parent"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Daughter"</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">red</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="s2">"Sweet Pea Diameter (0.01 Inch)"</span><span class="p">)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Curve</span><span class="p">([(</span><span class="n">parent_min</span><span class="p">,</span> <span class="n">y_1</span><span class="p">),</span> <span class="p">(</span><span class="n">parent_max</span><span class="p">,</span> <span class="n">y_2</span><span class="p">)])</span>

<span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">dots</span> <span class="o">*</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">height</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"scatter_plot_with_means"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<object data="/posts/galtons-sweet-pea-data/scatter_plot_with_means.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgff3d839">
<h2 id="orgff3d839">End</h2>
<div class="outline-text-2" id="text-orgff3d839"></div>
<div class="outline-3" id="outline-container-org33fec38">
<h3 id="org33fec38">Source</h3>
<div class="outline-text-3" id="text-org33fec38">
<ul class="org-ul">
<li>Stanton JM. Galton, Pearson, and the peas: A brief history of linear regression for statistics instructors. Journal of Statistics Education. 2001 Jan 1;9(3). (<a href="http://jse.amstat.org/v9n3/stanton.html">Link</a>)</li>
</ul>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/zip-code-plotting/">Zip Code Plotting</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/zip-code-plotting/" rel="bookmark"><time class="published dt-published" datetime="2020-11-24T22:49:35-08:00" itemprop="datePublished" title="2020-11-24 22:49">2020-11-24 22:49</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/zip-code-plotting/#org750c18d">Beginning</a>
<ul>
<li><a href="/posts/zip-code-plotting/#orgb2b913d">Imports</a></li>
<li><a href="/posts/zip-code-plotting/#org179f37a">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/zip-code-plotting/#org42abbed">Middle</a>
<ul>
<li><a href="/posts/zip-code-plotting/#org3d25d75">Loading the Data</a></li>
</ul>
</li>
<li><a href="/posts/zip-code-plotting/#org31be4f9">End</a>
<ul>
<li><a href="/posts/zip-code-plotting/#orgb5ef35f">Sources</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org750c18d">
<h2 id="org750c18d">Beginning</h2>
<div class="outline-text-2" id="text-org750c18d">
<p>This is a quick test to see if I can plot some GeoJSON that defines a zipcode map for the state of Oregon. I got the file from <a href="https://github.com/OpenDataDE/State-zip-code-GeoJSON">GitHub</a> but the README indicates that the original source (see below) was the the U.S. Census Bureau. The files are from 2010, so they're a little old, but I don't imagine that zip codes update that often anyway. Maybe as a future exercise I'll try to replicated what was done with the <a href="https://www.census.gov/cgi-bin/geo/shapefiles/index.php">2019</a> update.</p>
</div>
<div class="outline-3" id="outline-container-orgb2b913d">
<h3 id="orgb2b913d">Imports</h3>
<div class="outline-text-3" id="text-orgb2b913d">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org179f37a">
<h3 id="org179f37a">Set Up</h3>
<div class="outline-text-3" id="text-org179f37a">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"zip-code-plotting"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org42abbed">
<h2 id="org42abbed">Middle</h2>
<div class="outline-text-2" id="text-org42abbed"></div>
<div class="outline-3" id="outline-container-org3d25d75">
<h3 id="org3d25d75">Loading the Data</h3>
<div class="outline-text-3" id="text-org3d25d75">
<p>This should be pretty straightforward. The documentation for <a href="https://geopandas.org/">GeoPandas</a> indicates that it can handle GeoJSON directly.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/.env"</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"OREGON_ZIP_CODES"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">geoframe</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
<p>Let's see what's there.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">geoframe</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
  STATEFP10 ZCTA5CE10  GEOID10 CLASSFP10 MTFCC10 FUNCSTAT10    ALAND10  \
0        41     97833  4197833        B5   G6350          S  228152974   
1        41     97840  4197840        B5   G6350          S  295777905   
2        41     97330  4197330        B5   G6350          S  199697439   
3        41     97004  4197004        B5   G6350          S  113398767   
4        41     97023  4197023        B5   G6350          S  330220870   

   AWATER10   INTPTLAT10    INTPTLON10 PARTFLG10  \
0         0  +44.9288886  -118.0148791         N   
1  10777783  +44.8847111  -116.9184395         N   
2    814864  +44.6424890  -123.2562655         N   
3     71994  +45.2549625  -122.4493774         N   
4   2345079  +45.2784758  -122.3231876         N   

                                            geometry  
0  MULTIPOLYGON (((-118.15748 44.99903, -118.1575...  
1  POLYGON ((-116.98971 44.88256, -116.98957 44.8...  
2  POLYGON ((-123.18294 44.64477, -123.18293 44.6...  
3  POLYGON ((-122.48691 45.22227, -122.48713 45.2...  
4  POLYGON ((-122.07580 45.10889, -122.07594 45.1...  
</pre>
<p>This next bit is a little slow.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">geoframe</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">hover_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">"ZCTA5CE10"</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">"hover"</span><span class="p">,</span> <span class="s2">"wheel_zoom"</span><span class="p">],)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Oregon Zip Codes"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"oregon_zip_codes"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="/posts/zip-code-plotting/oregon_zip_codes.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Well, on the one hand it kind of works, but it has a lot of weird holes and I can't get the tools to appear so you can zoom in. I also don't really want the zip-codes to be interpreted as a heat map. But I guess it's a start.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org31be4f9">
<h2 id="org31be4f9">End</h2>
<div class="outline-text-2" id="text-org31be4f9"></div>
<div class="outline-3" id="outline-container-orgb5ef35f">
<h3 id="orgb5ef35f">Sources</h3>
<div class="outline-text-3" id="text-orgb5ef35f">
<ul class="org-ul">
<li>The Zip Code GeoJSON comes from a GitHub repository created by <a href="/posts/state-zip-code-geojson-repository/">OpenDataDE</a>.</li>
<li><a href="https://geojson.org/">The Official GeoJSON page</a> (I think), not much there.</li>
<li><a href="https://en.wikipedia.org/wiki/GeoJSON">Wikipedia on GeoJSON</a></li>
<li><a href="https://geopandas.org/">GeoPandas Documentation</a></li>
</ul>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/state-zip-code-geojson-repository/">State Zip Code GeoJSON Repository</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/state-zip-code-geojson-repository/" rel="bookmark"><time class="published dt-published" datetime="2020-11-20T19:06:30-08:00" itemprop="datePublished" title="2020-11-20 19:06">2020-11-20 19:06</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org5f7cfaf">
<h2 id="org5f7cfaf">Citation</h2>
<div class="outline-text-2" id="text-org5f7cfaf">
<ol class="org-ol">
<li>GitHub - OpenDataDE/State-zip-code-GeoJSON: Zip code boundaries for each of the 50 states [Internet]. [cited 2020 Nov 20]. Available from: <a href="https://github.com/OpenDataDE/State-zip-code-GeoJSON">https://github.com/OpenDataDE/State-zip-code-GeoJSON</a></li>
</ol>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="next"><a href="/index-8.html" rel="next">Older posts</a></li>
</ul>
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
</script><!--End of body content-->
<footer id="footer">Contents © 2021 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script> </div>
</div>
</body>
</html>
